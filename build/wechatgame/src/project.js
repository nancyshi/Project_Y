window.__require=function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var h=s.split("/");if(h=h[h.length-1],!t[h]){var l="function"==typeof __require&&__require;if(!a&&l)return l(h,!0);if(r)return r(h,!0);throw new Error("Cannot find module '"+s+"'")}}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){return o(t[s][1][e]||e)},c,c.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)o(n[s]);return o}({bulletMgr:[function(e,t,i){"use strict";cc._RF.push(t,"2e7ebmG0o9A+INmyGAQ4snA","bulletMgr"),cc.Class({extends:cc.Component,properties:{bulletType:1,status:0,disFromBorder:10,moveSpeed:500,movingDirection:null,targetPosition:null,levelMgr:null,helper:null,_rayTestLength:3e3,pathWaysNode:cc.Node,pathWaysHeight:10,sliderFrame:cc.SpriteFrame},onLoad:function(){this.levelMgr=cc.find("Canvas").getComponent("levelMgr");var t=e("helper");this.helper=new t},start:function(){2==this.bulletType&&(this.node.getComponent(cc.Sprite).spriteFrame=this.sliderFrame)},move:function(e){},checkWhetherCanMove:function(e){},update:function(e){this.moveUpdate(e)},moveUpdate:function(e){if(1==this.status){this.movingDirection.normalizeSelf();var t=this.moveSpeed*this.movingDirection.x,i=this.moveSpeed*this.movingDirection.y,n=this.node.x+t*e,o=this.node.y+i*e;if(cc.v2(n-this.node.x,o-this.node.y).mag()>=cc.v2(this.targetPosition.x-this.node.x,this.targetPosition.y-this.node.y).mag())return n=this.targetPosition.x,o=this.targetPosition.y,this.node.x=n,this.node.y=o,void(this.status=0);this.node.x=n,this.node.y=o}},getNearestWallInfo:function(e){if(1==this.bulletType){var t=null,i=this.helper.makeRay(cc.v2(this.node.x,this.node.y),this._rayTestLength,e),n=this.levelMgr.walls,o=null,r=this.helper.getLinesOfOneNode(this.node);for(var s in r){var a=r[s];if(0!=(y=this.helper.rayTest(i,a))){o=y;break}}for(var h in n){var l=n[h],c=this.helper.getLinesOfOneNode(l);for(var s in c){a=c[s];if(0!=(y=this.helper.rayTest(i,a))&&(null==t||y<t.dis)){var u=this.disFromBorder+o;t={dis:y,suitablePosition:d=this.helper.getSuitablePoint(cc.v2(this.node.x,this.node.y),y,u,e)}}}}return t}if(2==this.bulletType){if(null==this.pathWaysNode||0==this.pathWaysNode.children.length)return{dis:0,suitablePosition:this.node.position};var v=null;for(var h in this.pathWaysNode.children){var g=this.pathWaysNode.children[h];0!=this.helper.isTwoNodeCross(this.node,g)&&((null==v||this.getMaxDisFromPathNode(g,e)>this.getMaxDisFromPathNode(v,e))&&(v=g))}i=this.helper.makeRay(this.node.position,3e3,e);var d,f=null,p=this.helper.getLinesOfOneNode(v);for(var s in p){var y;a=p[s];if(0!=(y=this.helper.rayTest(i,a))){f=y;break}}return{suitablePosition:d=this.helper.getSuitablePoint(this.node.position,f,this.pathWaysHeight/2,e),dis:y=cc.v2(d.x-this.node.x,d.y-this.node.y).mag()}}},getMaxDisFromPathNode:function(e,t){var i=this.helper.makeRay(this.node.position,3e3,t),n=this.helper.makeRay(this.node.position,3e3,cc.v2(-t.x,-t.y)),o=this.helper.getLinesOfOneNode(e),r=this,s=function(e){for(var t in o){var i=o[t],n=r.helper.rayTest(e,i);if(0!=n)return n}},a=s(i),h=s(n);return a>=h?a:h}}),cc._RF.pop()},{helper:"helper"}],helper:[function(e,t,i){"use strict";cc._RF.push(t,"fee26lOQ3NFBb7FR2MoK8sC","helper");var n=cc.Class({properties:{},segmentsIntr:function(e,t,i,n){var o=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x),r=(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x);if(o*r>=0)return!1;var s=(i.x-e.x)*(n.y-e.y)-(i.y-e.y)*(n.x-e.x);if(s*(s+o-r)>=0)return!1;var a=s/(r-o),h=a*(t.x-e.x),l=a*(t.y-e.y);return{x:e.x+h,y:e.y+l}},rotateSegment:function(e,t,i,n){return{p1:this.rotateOnePoint(e,i,n),p2:this.rotateOnePoint(t,i,n)}},rotateOnePoint:function(e,t,i){var n=i*Math.PI/180,o=cc.v2(e.x-t.x,e.y-t.y).rotate(n);return cc.v2(o.x+t.x,o.y+t.y)},rayTest:function(e,t){var i=this.segmentsIntr(e.p1,e.p2,t.p1,t.p2);return 0!=i&&cc.v2(i.x-e.p1.x,i.y-e.p1.y).mag()},getSuitablePoint:function(e,t,i,n){if(i>=t)return e;n.normalizeSelf();var o=t*n.x,r=t*n.y,s=(t-i)/t,a=e.x+s*o,h=e.y+s*r;return cc.v2(a,h)},makeRay:function(e,t,i){var n={p1:e,p2:null};1!=i.mag()&&i.normalizeSelf();var o=i.x*t,r=i.y*t,s=e.x+o,a=e.y+r;return n.p2=cc.v2(s,a),n},getLinesOfOneNode:function(e){var t=e.height/2,i=cc.v2(e.x-e.width/2,e.y-t),n=cc.v2(e.x+e.width/2,e.y-t),o=cc.v2(i.x,i.y+e.height),r=cc.v2(n.x,n.y+e.height),s=cc.v2(e.x-e.width/2,e.y+e.height/2),a=cc.v2(s.x,s.y-e.height),h=cc.v2(e.x+e.width/2,e.y+e.height/2),l=cc.v2(h.x,h.y-e.height),c={p1:i,p2:n},u={p1:o,p2:r},v={p1:s,p2:a},g={p1:h,p2:l};null!=e.angle&&void 0!=e.angle&&(c=this.rotateSegment(i,n,cc.v2(e.x,e.y),-e.angle),u=this.rotateSegment(o,r,cc.v2(e.x,e.y),-e.angle),v=this.rotateSegment(s,a,cc.v2(e.x,e.y),-e.angle),g=this.rotateSegment(h,l,cc.v2(e.x,e.y),-e.angle));var d={lowerLine:c,upperLine:u,leftLine:v,rightLine:g};return null!=c&&null!=u&&null!=v&&null!=g||cc.error("NOT INVALID LINES"),d},isTwoNodeCross:function(e,t){var i=this.getInfoOfOneNode(e),n=this.getInfoOfOneNode(t);return!(i.minY>n.maxY||n.minY>i.maxY||i.minX>n.maxX||n.minX>i.maxX)},getInfoOfOneNode:function(e){var t=cc.v2(e.x-e.width/2,e.y+e.height/2),i=cc.v2(e.x+e.width/2,t.y),n=cc.v2(t.x,e.y-e.height/2),o=cc.v2(i.x,n.y);null!=e.angle&&void 0!=e.angle&&(t=this.rotateOnePoint(t,cc.v2(e.x,e.y),-e.angle),i=this.rotateOnePoint(i,cc.v2(e.x,e.y),-e.angle),n=this.rotateOnePoint(n,cc.v2(e.x,e.y),-e.angle),o=this.rotateOnePoint(o,cc.v2(e.x,e.y),-e.angle));var r=t.x,s=o.x,a=n.y,h=i.y,l=[t,n,i,o];for(var c in l){var u=l[c];r>u.x&&(r=u.x),s<u.x&&(s=u.x),a>u.y&&(a=u.y),h<u.y&&(h=u.y)}return{minX:r,minY:a,maxX:s,maxY:h}},getDisToSelfBorder:function(e,t){var i=this.makeRay(cc.v2(e.x,e.y),1e3,t),n=this.getLinesOfOneNode(e);for(var o in n){var r=n[o],s=this.rayTest(i,r);if(0!=s)return s}},getPointsOfOneNode:function(e){var t=cc.v2(e.x-e.width/2,e.y+e.height/2),i=cc.v2(e.x+e.width/2,t.y),n=cc.v2(t.x,e.y-e.height/2),o=cc.v2(i.x,n.y);return null!=e.angle&&void 0!=e.angle&&(t=this.rotateOnePoint(t,cc.v2(e.x,e.y),-e.angle),i=this.rotateOnePoint(i,cc.v2(e.x,e.y),-e.angle),n=this.rotateOnePoint(n,cc.v2(e.x,e.y),-e.angle),o=this.rotateOnePoint(o,cc.v2(e.x,e.y),-e.angle)),{leftUpPoint:t,leftDownPoint:n,rightUpPoint:i,rightDownPoint:o}}});t.exports=n,cc._RF.pop()},{}],levelMgr:[function(e,t,i){"use strict";cc._RF.push(t,"e7e748p6atLdo2Z1e9yNR+E","levelMgr"),cc.Class({extends:cc.Component,properties:{bullets:[],minDis:100,maxOffsetDegree:30,directionTryto:null,flag:!1,helper:null,walls:[],targetsNum:{get:function(){return this._targetsNum},set:function(e){this._targetsNum=e,0==e&&this.onSuccess()}}},onLoad:function(){var t=e("helper");this.helper=new t},start:function(){this.node.on("touchstart",this.onTouchStart,this),this.node.on("touchmove",this.onTouchMove,this),this.node.on("touchend",this.onTouchEnd,this);var e=cc.find("Canvas/bullets");this.bullets=e.children;var t=cc.find("Canvas/walls");this.walls=t.children,this.targetsNum=cc.find("Canvas/targets").children.length;var i=cc.find("Canvas/fillNodes").getComponent(cc.Graphics),n=null,o=cc.find("Canvas/fillNodes").children;if(0!=o.length){for(var r in o){var s=o[r];null==n&&(i.moveTo(s.x,s.y),n=s),i.lineTo(s.x,s.y)}i.close(),i.stroke(),i.fill()}},onTouchStart:function(e){this.directionTryto=null,this.flag=!0},onTouchMove:function(e){if(0!=this.flag){var t=e.getDelta(),i=this.getPossiableDirection(t);if(-1!=i)if(null==this.directionTryto&&(this.directionTryto=i),0!=i.equals(this.directionTryto)){var n=e.getStartLocation();cc.v2(e.getLocationX()-n.x,e.getLocationY()-n.y).mag()>=this.minDis&&(this.flag=!1,this.moveBullets(this.directionTryto))}else this.flag=!1;else this.flag=!1}},onTouchEnd:function(e){},onDestroy:function(){this.node.off("touchstart",this.onTouchStart,this),this.node.off("touchmove",this.onTouchMove,this),this.node.off("touchend",this.onTouchEnd,this)},getPossiableDirection:function(e){return 1==this.isPossiableWithGivenDirection(e,cc.v2(1,0))?cc.v2(1,0):1==this.isPossiableWithGivenDirection(e,cc.v2(0,-1))?cc.v2(0,-1):1==this.isPossiableWithGivenDirection(e,cc.v2(-1,0))?cc.v2(-1,0):1==this.isPossiableWithGivenDirection(e,cc.v2(0,1))?cc.v2(0,1):-1},isPossiableWithGivenDirection:function(e,t){var i=e.signAngle(t)/Math.PI*180;return Math.abs(i)<=this.maxOffsetDegree},moveBullets:function(e){for(var t in this.bullets)if(0!=this.bullets[t].getComponent("bulletMgr").status)return;var i=[];for(var t in this.bullets){var n=this.bullets[t],o=n.getComponent("bulletMgr").getNearestWallInfo(e),r={x:o.suitablePosition.x,y:o.suitablePosition.y,width:n.width,height:n.height,dis:o.dis,originNode:n};i.push(r)}for(;0==this.resolveShadows(i,e););for(var t in i){var s=(r=i[t]).originNode;s.getComponent("bulletMgr").targetPosition=cc.v2(r.x,r.y),s.getComponent("bulletMgr").movingDirection=e,s.getComponent("bulletMgr").status=1}},onSuccess:function(){cc.log("YOU WIN")},resolveShadows:function(e,t){for(var i in e){var n=e[i];for(var o in e){var r=e[o];if(n!=r){var s=this._selectStaticShadowAndShaodwForResolved(n,r,t);if(0!=s){var a=s.staticShadow,h=s.shadowForResolved,l=this.helper.getLinesOfOneNode(a),c=null,u=this.helper.makeRay(cc.v2(a.x,a.y),1e3,cc.v2(-t.x,-t.y));for(var v in l){var g=l[v];if(0!=this.helper.rayTest(u,g)){c=g;break}}var d=this.helper.makeRay(c.p2,1e3,cc.v2(c.p2.x-c.p1.x,c.p2.y-c.p1.y)).p2;c={p1:this.helper.makeRay(c.p1,1e3,cc.v2(c.p1.x-c.p2.x,c.p1.y-c.p2.y)).p2,p2:d};var f=this.helper.makeRay(h.originNode.position,3e3,t),p=this.helper.rayTest(f,c),y=this.helper.getDisToSelfBorder(h.originNode,t)+h.originNode.getComponent("bulletMgr").disFromBorder,x=this.helper.getSuitablePoint(h.originNode.position,p,y,t),m=cc.v2(x.x-h.originNode.x,x.y-h.originNode.y).mag();return h.x=x.x,h.y=x.y,h.dis=m,!1}}}}return!0},_selectStaticShadowAndShaodwForResolved:function(e,t,i){var n=function(e,t,i,n,o){var r=n.helper.getPointsOfOneNode(e.originNode);for(var s in r.origin=cc.v2(e.originNode.x,e.originNode.y),r){var a=n.helper.makeRay(r[s],e.dis,i),h=null;for(var l in 1==o&&(h=n.helper.getLinesOfOneNode(t.originNode)),2==o&&(h=n.helper.getLinesOfOneNode(t)),h){var c=h[l];if(0!=n.helper.rayTest(a,c))return!0}}return!1};return 1==n(e,t,i,this,1)&&1==n(e,t,i,this,2)?{staticShadow:t,shadowForResolved:e}:1==n(t,e,i,this,1)&&1==n(t,e,i,this,2)&&{staticShadow:e,shadowForResolved:t}}}),cc._RF.pop()},{helper:"helper"}],targetMgr:[function(e,t,i){"use strict";cc._RF.push(t,"25f14lIIdZGX5Bxde5y1xJx","targetMgr"),cc.Class({extends:cc.Component,properties:{fatalTolerance:.01,bullets:null,flag:!1,helper:null},onLoad:function(){var t=e("helper");this.helper=new t},start:function(){this.bullets=cc.find("Canvas").getComponent("levelMgr").bullets},update:function(e){if(1!=this.flag)for(var t in this.bullets){var i=this.bullets[t],n=i.getComponent("bulletMgr");if(1==n.bulletType&&(0==n.status&&1==this.checkWhetherSatisfied(i))){this.onSatisfy(i);break}}},checkWhetherSatisfied:function(e){var t=this.helper.getPointsOfOneNode(this.node),i=this.helper.getPointsOfOneNode(e);for(var n in t){var o=t[n],r=i[n];if(cc.v2(r.x-o.x,r.y-o.y).mag()>this.fatalTolerance)return!1}return!0},onSatisfy:function(e){this.flag=!0,e.getComponent("bulletMgr").status=2;var t=this;cc.tween(e).to(.2,{opacity:0}).call(function(){e.destroy()}).start(),cc.tween(this.node).to(.2,{opacity:0}).call(function(){t.node.destroy()}).start()},onDestroy:function(){cc.find("Canvas").getComponent("levelMgr").targetsNum-=1}}),cc._RF.pop()},{helper:"helper"}]},{},["bulletMgr","helper","levelMgr","targetMgr"]);