{"version":3,"sources":["../../../../assets/scripts/assets/scripts/targetMgr.js"],"names":["cc","Class","extends","Component","properties","fatalTolerance","bullets","flag","helper","onLoad","Helper","require","start","find","getComponent","update","dt","index","bullet","bulletMgr","bulletType","status","checkWhetherSatisfied","onSatisfy","givenBulletNode","points","getPointsOfOneNode","node","bulletPoints","key","point","bulletCorrespondPoint","dis","v2","x","y","mag","givenBullet","self","tween","to","opacity","call","destroy","onDestroy","targetsNum"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,wBAAgB,IAhBR;AAiBRC,iBAAS,IAjBD;AAkBRC,cAAM,KAlBE;AAmBRC,gBAAQ;AAnBA,KAHP;;AAyBL;;AAEAC,UA3BK,oBA2BK;AACN,YAAIC,SAASC,QAAQ,QAAR,CAAb;AACA,aAAKH,MAAL,GAAc,IAAIE,MAAJ,EAAd;AACH,KA9BI;AAgCLE,SAhCK,mBAgCI;AACL,aAAKN,OAAL,GAAeN,GAAGa,IAAH,CAAQ,QAAR,EAAkBC,YAAlB,CAA+B,UAA/B,EAA2CR,OAA1D;AACH,KAlCI;AAoCLS,UApCK,kBAoCGC,EApCH,EAoCO;AACR,YAAI,KAAKT,IAAL,IAAa,IAAjB,EAAuB;AACnB;AACH;AACD,aAAK,IAAIU,KAAT,IAAkB,KAAKX,OAAvB,EAAgC;AAC5B,gBAAIY,SAAS,KAAKZ,OAAL,CAAaW,KAAb,CAAb;AACA,gBAAIE,YAAYD,OAAOJ,YAAP,CAAoB,WAApB,CAAhB;;AAEA,gBAAIK,UAAUC,UAAV,IAAwB,CAA5B,EAA+B;AAC3B;AACH;AACD,gBAAID,UAAUE,MAAV,IAAoB,CAAxB,EAA2B;AACvB;AACH;AACD,gBAAI,KAAKC,qBAAL,CAA2BJ,MAA3B,KAAsC,IAA1C,EAAgD;AAC5C,qBAAKK,SAAL,CAAeL,MAAf;AACA;AACH;AACJ;AACJ,KAvDI;AAyDLI,yBAzDK,iCAyDiBE,eAzDjB,EAyDkC;AACnC,YAAIC,SAAS,KAAKjB,MAAL,CAAYkB,kBAAZ,CAA+B,KAAKC,IAApC,CAAb;AACA,YAAIC,eAAe,KAAKpB,MAAL,CAAYkB,kBAAZ,CAA+BF,eAA/B,CAAnB;;AAEA,aAAK,IAAIK,GAAT,IAAgBJ,MAAhB,EAAwB;AACpB,gBAAIK,QAAQL,OAAOI,GAAP,CAAZ;AACA,gBAAIE,wBAAwBH,aAAaC,GAAb,CAA5B;;AAEA,gBAAIG,MAAMhC,GAAGiC,EAAH,CAAMF,sBAAsBG,CAAtB,GAA0BJ,MAAMI,CAAtC,EAAyCH,sBAAsBI,CAAtB,GAA0BL,MAAMK,CAAzE,EAA4EC,GAA5E,EAAV;AACA,gBAAIJ,MAAM,KAAK3B,cAAf,EAA+B;AAC3B,uBAAO,KAAP;AACH;AACJ;;AAED,eAAO,IAAP;AACH,KAxEI;AA0ELkB,aA1EK,qBA0EKc,WA1EL,EA0EkB;AACnB,aAAK9B,IAAL,GAAY,IAAZ;AACA8B,oBAAYvB,YAAZ,CAAyB,WAAzB,EAAsCO,MAAtC,GAA+C,CAA/C;AACA,YAAIiB,OAAO,IAAX;AACAtC,WAAGuC,KAAH,CAASF,WAAT,EACKG,EADL,CACQ,GADR,EACY,EAACC,SAAQ,CAAT,EADZ,EAEKC,IAFL,CAEU,YAAU;AACZL,wBAAYM,OAAZ;AACH,SAJL,EAKK/B,KALL;AAMAZ,WAAGuC,KAAH,CAAS,KAAKZ,IAAd,EACKa,EADL,CACQ,GADR,EACY,EAACC,SAAS,CAAV,EADZ,EAEKC,IAFL,CAEU,YAAU;AACZJ,iBAAKX,IAAL,CAAUgB,OAAV;AACH,SAJL,EAKK/B,KALL;AAMH,KA1FI;AA4FLgC,aA5FK,uBA4FO;AACR5C,WAAGa,IAAH,CAAQ,QAAR,EAAkBC,YAAlB,CAA+B,UAA/B,EAA2C+B,UAA3C,IAAyD,CAAzD;AACH;AA9FI,CAAT","file":"targetMgr.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        fatalTolerance: 0.01,\n        bullets: null,\n        flag: false,\n        helper: null\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var Helper = require(\"helper\")\n        this.helper = new Helper()\n    },\n\n    start () {\n        this.bullets = cc.find(\"Canvas\").getComponent(\"levelMgr\").bullets\n    },\n\n    update (dt) {\n        if (this.flag == true) {\n            return\n        }\n        for (var index in this.bullets) {\n            var bullet = this.bullets[index]\n            var bulletMgr = bullet.getComponent(\"bulletMgr\")\n            \n            if (bulletMgr.bulletType != 1) {\n                continue\n            }\n            if (bulletMgr.status != 0) {\n                continue\n            }\n            if (this.checkWhetherSatisfied(bullet) == true) {\n                this.onSatisfy(bullet)\n                break\n            }\n        }\n    },\n\n    checkWhetherSatisfied(givenBulletNode) {\n        var points = this.helper.getPointsOfOneNode(this.node)\n        var bulletPoints = this.helper.getPointsOfOneNode(givenBulletNode)\n\n        for (var key in points) {\n            var point = points[key]\n            var bulletCorrespondPoint = bulletPoints[key]\n\n            var dis = cc.v2(bulletCorrespondPoint.x - point.x, bulletCorrespondPoint.y - point.y).mag()\n            if (dis > this.fatalTolerance) {\n                return false\n            }\n        }\n\n        return true\n    },\n\n    onSatisfy(givenBullet) {\n        this.flag = true\n        givenBullet.getComponent(\"bulletMgr\").status = 2\n        var self = this\n        cc.tween(givenBullet)\n            .to(0.2,{opacity:0})\n            .call(function(){\n                givenBullet.destroy()\n            })\n            .start()\n        cc.tween(this.node)\n            .to(0.2,{opacity: 0})\n            .call(function(){\n                self.node.destroy()\n            })\n            .start()\n    },\n\n    onDestroy() {\n        cc.find(\"Canvas\").getComponent(\"levelMgr\").targetsNum -= 1\n    }\n});\n"]}