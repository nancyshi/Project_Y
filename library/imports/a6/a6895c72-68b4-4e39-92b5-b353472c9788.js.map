{"version":3,"sources":["assets/scripts/systems/signInSys/signInSysMgr.js"],"names":["cc","Class","Component","properties","ensureButtonNode","Node","cancelButtonNode","desLabelNode","Label","physicalPowerAddNum","heartAddNum","addRateForAd","sysName","start","setupData","setupUI","status","require","playerData","signInStatus","desStr","textConfig","getTextByIdAndLanguageType","getChildByName","getComponent","string","toString","delta","signInRefreshDelta","h","Math","floor","m","s","getFormatedString","active","x","log","config","onClickEnsureButton","advMgr","delegate","showVideoAd","closeSystem","onClickCancelButton","signIn","signInType","networkMgr","msgObj","makeMessageObj","message","playerId","id","self","successCallBack","xhr","response","responseText","JSON","parse","type","physicalPower","heart","onSignInSuccess","sendMessageByMsgObj","str","pushNoti","onVideoAdEnd"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        ensureButtonNode: cc.Node,\n        cancelButtonNode: cc.Node,\n        desLabelNode: cc.Label,\n        physicalPowerAddNum: 0,\n        heartAddNum: 0,\n        addRateForAd: 0,\n        sysName: \"signInSys\"\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n        this.setupData()\n        this.setupUI()\n    },\n    setupUI() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        //1 = not sign in\n        //2 = common in\n        //3 = ad sign in\n        var desStr = \"\"\n        var textConfig = require(\"textConfig\")\n        switch(status) {\n            case 1:\n                desStr = textConfig.getTextByIdAndLanguageType(115) + this.physicalPowerAddNum + textConfig.getTextByIdAndLanguageType(116) + this.heartAddNum +\", \"\n                desStr = desStr + textConfig.getTextByIdAndLanguageType(117)\n                this.cancelButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(118)\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(113)\n                break\n            case 2:\n                desStr = textConfig.getTextByIdAndLanguageType(119) + ((this.addRateForAd - 1) * this.physicalPowerAddNum).toString()\n                desStr = desStr + textConfig.getTextByIdAndLanguageType(116) + ((this.addRateForAd - 1) * this.heartAddNum).toString()\n                desStr = desStr + textConfig.getTextByIdAndLanguageType(120)\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(113)\n                this.cancelButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(114)\n                break\n            case 3:\n                var delta = require(\"dataMgr\").playerData.signInRefreshDelta\n                var h = Math.floor(delta / 3600)\n                var m = Math.floor(delta % 3600 / 60)\n                var s = h.toString() + \"h \" + m.toString() + \"m \" \n                desStr = textConfig.getFormatedString(121,[s])\n                this.cancelButtonNode.active = false\n                this.ensureButtonNode.x = 0\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(122)\n                break\n        }\n        if (desStr == \"\") {\n            cc.log(\"wrong signIn status\")\n            return\n        }\n\n        this.desLabelNode.getComponent(cc.Label).string = desStr\n\n    },\n\n    setupData() {\n        var config = require(\"signInSysConfig\")\n        this.physicalPowerAddNum = config.physicalPowerAddNum\n        this.heartAddNum = config.heartAddNum\n        this.addRateForAd = config.addRateForAd\n    },\n\n    onClickEnsureButton(){\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1:\n                var advMgr = require(\"advertisMgr\")\n                advMgr.delegate = this\n                advMgr.showVideoAd()\n                break\n            case 2:\n                var advMgr = require(\"advertisMgr\")\n                advMgr.delegate = this\n                advMgr.showVideoAd()\n                break\n            case 3:\n                require(\"systemsMgr\").closeSystem(this.sysName)\n                break\n        }\n    },\n\n    onClickCancelButton() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1: \n                this.signIn(1)\n                break\n            case 2:\n                require(\"systemsMgr\").closeSystem(this.sysName)\n                break\n            case 3:\n                // if status == 3, cancel button will not appear\n                cc.log(\"some wrong thing happen from onClickCancelButton\")\n                break\n        }\n    },\n\n    signIn(signInType) {\n        var networkMgr = require(\"networkMgr\")\n        var msgObj = networkMgr.makeMessageObj(\"signInModule\",\"signInMessageType\")\n        msgObj.message.signInType = signInType\n        msgObj.message.playerId = require(\"dataMgr\").playerData.id\n        var self = this\n        msgObj.successCallBack = function(xhr) {\n            var response = xhr.responseText\n            response = JSON.parse(response)\n            \n            if (response.type == \"success\") {\n                var physicalPower = response.physicalPower\n                var heart = response.heart\n                self.onSignInSuccess(signInType,physicalPower,heart)\n            }\n        }\n\n        networkMgr.sendMessageByMsgObj(msgObj)\n    },\n\n    onSignInSuccess(signInType,physicalPower,heart) {\n        switch(signInType){\n            case 1:\n                require(\"dataMgr\").playerData.signInStatus = 2\n                break\n            case 2:\n                require(\"dataMgr\").playerData.signInStatus = 3\n                break\n            case 3:\n                require(\"dataMgr\").playerData.signInStatus = 3\n                break\n        }\n\n        require(\"dataMgr\").playerData.physicalPower = physicalPower\n        require(\"dataMgr\").playerData.heart = heart\n        var str = require(\"textConfig\").getTextByIdAndLanguageType(164)\n        require(\"notificationMgr\").pushNoti(str)\n        require(\"systemsMgr\").closeSystem(this.sysName)\n    },\n\n    //advertis delegate\n    onVideoAdEnd() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1:\n                this.signIn(2)\n                break\n            case 2:\n                this.signIn(3)\n                break\n        }\n    }\n    // update (dt) {},\n});\n"]}