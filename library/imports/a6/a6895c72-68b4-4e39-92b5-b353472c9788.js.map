{"version":3,"sources":["../../../../../../assets/scripts/systems/signInSys/assets/scripts/systems/signInSys/signInSysMgr.js"],"names":["cc","Class","extends","Component","properties","ensureButtonNode","Node","cancelButtonNode","desLabelNode","Label","physicalPowerAddNum","heartAddNum","addRateForAd","sysName","start","setupData","setupUI","status","require","playerData","signInStatus","desStr","textConfig","getTextByIdAndLanguageType","getChildByName","getComponent","string","toString","active","x","log","config","onClickEnsureButton","advMgr","delegate","showVideoAd","closeSystem","onClickCancelButton","signIn","signInType","networkMgr","msgObj","makeMessageObj","message","playerId","id","self","successCallBack","xhr","response","responseText","JSON","parse","type","physicalPower","heart","onSignInSuccess","sendMessageByMsgObj","showNoti","onVideoAdEnd"],"mappings":"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","file":"signInSysMgr.js","sourceRoot":"../../../../../../assets/scripts/systems/signInSys","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        ensureButtonNode: cc.Node,\n        cancelButtonNode: cc.Node,\n        desLabelNode: cc.Label,\n        physicalPowerAddNum: 0,\n        heartAddNum: 0,\n        addRateForAd: 0,\n        sysName: \"signInSys\"\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n        this.setupData()\n        this.setupUI()\n    },\n    setupUI() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        //1 = not sign in\n        //2 = common in\n        //3 = ad sign in\n        var desStr = \"\"\n        var textConfig = require(\"textConfig\")\n        switch(status) {\n            case 1:\n                desStr = textConfig.getTextByIdAndLanguageType(115) + this.physicalPowerAddNum + textConfig.getTextByIdAndLanguageType(116) + this.heartAddNum +\", \"\n                desStr = desStr + textConfig.getTextByIdAndLanguageType(117)\n                this.cancelButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(118)\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(113)\n                break\n            case 2:\n                desStr = textConfig.getTextByIdAndLanguageType(119) + ((this.addRateForAd - 1) * this.physicalPowerAddNum).toString()\n                desStr = desStr + textConfig.getTextByIdAndLanguageType(116) + ((this.addRateForAd - 1) * this.heartAddNum).toString()\n                desStr = desStr + textConfig.getTextByIdAndLanguageType(120)\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(113)\n                this.cancelButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(114)\n                break\n            case 3:\n                desStr = textConfig.getTextByIdAndLanguageType(121)\n                this.cancelButtonNode.active = false\n                this.ensureButtonNode.x = 0\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(122)\n                break\n        }\n        if (desStr == \"\") {\n            cc.log(\"wrong signIn status\")\n            return\n        }\n\n        this.desLabelNode.getComponent(cc.Label).string = desStr\n\n    },\n\n    setupData() {\n        var config = require(\"signInSysConfig\")\n        this.physicalPowerAddNum = config.physicalPowerAddNum\n        this.heartAddNum = config.heartAddNum\n        this.addRateForAd = config.addRateForAd\n    },\n\n    onClickEnsureButton(){\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1:\n                var advMgr = require(\"advertisMgr\")\n                advMgr.delegate = this\n                advMgr.showVideoAd()\n                break\n            case 2:\n                var advMgr = require(\"advertisMgr\")\n                advMgr.delegate = this\n                advMgr.showVideoAd()\n                break\n            case 3:\n                require(\"systemsMgr\").closeSystem(this.sysName)\n                break\n        }\n    },\n\n    onClickCancelButton() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1: \n                this.signIn(1)\n                break\n            case 2:\n                require(\"systemsMgr\").closeSystem(this.sysName)\n                break\n            case 3:\n                // if status == 3, cancel button will not appear\n                cc.log(\"some wrong thing happen from onClickCancelButton\")\n                break\n        }\n    },\n\n    signIn(signInType) {\n        var networkMgr = require(\"networkMgr\")\n        var msgObj = networkMgr.makeMessageObj(\"signInModule\",\"signInMessageType\")\n        msgObj.message.signInType = signInType\n        msgObj.message.playerId = require(\"dataMgr\").playerData.id\n        var self = this\n        msgObj.successCallBack = function(xhr) {\n            var response = xhr.responseText\n            response = JSON.parse(response)\n            \n            if (response.type == \"success\") {\n                var physicalPower = response.physicalPower\n                var heart = response.heart\n                self.onSignInSuccess(signInType,physicalPower,heart)\n            }\n        }\n\n        networkMgr.sendMessageByMsgObj(msgObj)\n    },\n\n    onSignInSuccess(signInType,physicalPower,heart) {\n        switch(signInType){\n            case 1:\n                require(\"dataMgr\").playerData.signInStatus = 2\n                break\n            case 2:\n                require(\"dataMgr\").playerData.signInStatus = 3\n                break\n            case 3:\n                require(\"dataMgr\").playerData.signInStatus = 3\n                break\n        }\n\n        require(\"dataMgr\").playerData.physicalPower = physicalPower\n        require(\"dataMgr\").playerData.heart = heart\n        require(\"notificationMgr\").showNoti(\"签到成功\")\n        require(\"systemsMgr\").closeSystem(this.sysName)\n    },\n\n    //advertis delegate\n    onVideoAdEnd() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1:\n                this.signIn(2)\n                break\n            case 2:\n                this.signIn(3)\n                break\n        }\n    }\n    // update (dt) {},\n});\n"]}