{"version":3,"sources":["../../../../../assets/scripts/systems/assets/scripts/systems/signInSysMgr.js"],"names":["cc","Class","extends","Component","properties","ensureButtonNode","Node","cancelButtonNode","desLabelNode","Label","physicalPowerAddNum","heartAddNum","addRateForAd","sysName","start","setupData","setupUI","status","require","playerData","signInStatus","desStr","getChildByName","getComponent","string","toString","active","x","log","config","onClickEnsureButton","advMgr","delegate","showVideoAd","closeSystem","onClickCancelButton","signIn","signInType","networkMgr","msgObj","makeMessageObj","message","playerId","id","self","successCallBack","xhr","response","responseText","JSON","parse","type","physicalPower","heart","onSignInSuccess","sendMessageByMsgObj","onVideoAdEnd"],"mappings":"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","file":"signInSysMgr.js","sourceRoot":"../../../../../assets/scripts/systems","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        ensureButtonNode: cc.Node,\n        cancelButtonNode: cc.Node,\n        desLabelNode: cc.Label,\n        physicalPowerAddNum: 0,\n        heartAddNum: 0,\n        addRateForAd: 0,\n        sysName: \"signInSys\"\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n        this.setupData()\n        this.setupUI()\n    },\n    setupUI() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        //1 = not sign in\n        //2 = common in\n        //3 = ad sign in\n        var desStr = \"\"\n        switch(status) {\n            case 1:\n                desStr = \"每日签到可以获得体力 * \" + this.physicalPowerAddNum + \", 金币 * \" + this.heartAddNum +\", \"\n                desStr = desStr + \"您是否愿意观看视频广告，获得双倍奖励？\"\n                this.cancelButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = \"普通签到\"\n                break\n            case 2:\n                desStr = \"您还可以观看视频广告获取体力 * \" + ((this.addRateForAd - 1) * this.physicalPowerAddNum).toString()\n                desStr = desStr + \", \"\n                desStr = desStr + \"金币 * \" + ((this.addRateForAd - 1) * this.heartAddNum).toString()\n                desStr = desStr + \"， 是否观看？\"\n                break\n            case 3:\n                desStr = \"您今天已经签到过啦，明天再来吧~\"\n                this.cancelButtonNode.active = false\n                this.ensureButtonNode.x = 0\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = \"好的\"\n                break\n        }\n        if (desStr == \"\") {\n            cc.log(\"wrong signIn status\")\n            return\n        }\n\n        this.desLabelNode.getComponent(cc.Label).string = desStr\n\n    },\n\n    setupData() {\n        var config = require(\"signInSysConfig\")\n        this.physicalPowerAddNum = config.physicalPowerAddNum\n        this.heartAddNum = config.heartAddNum\n        this.addRateForAd = config.addRateForAd\n    },\n\n    onClickEnsureButton(){\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1:\n                var advMgr = require(\"advertisMgr\")\n                advMgr.delegate = this\n                advMgr.showVideoAd()\n                break\n            case 2:\n                var advMgr = require(\"advertisMgr\")\n                advMgr.delegate = this\n                advMgr.showVideoAd()\n                break\n            case 3:\n                require(\"systemsMgr\").closeSystem(this.sysName)\n                break\n        }\n    },\n\n    onClickCancelButton() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1: \n                this.signIn(1)\n                break\n            case 2:\n                require(\"systemsMgr\").closeSystem(this.sysName)\n                break\n            case 3:\n                // if status == 3, cancel button will not appear\n                cc.log(\"some wrong thing happen from onClickCancelButton\")\n                break\n        }\n    },\n\n    signIn(signInType) {\n        var networkMgr = require(\"networkMgr\")\n        var msgObj = networkMgr.makeMessageObj(\"signInModule\",\"signInMessageType\")\n        msgObj.message.signInType = signInType\n        msgObj.message.playerId = require(\"dataMgr\").playerData.id\n        var self = this\n        msgObj.successCallBack = function(xhr) {\n            var response = xhr.responseText\n            response = JSON.parse(response)\n            \n            if (response.type == \"success\") {\n                var physicalPower = response.physicalPower\n                var heart = response.heart\n                self.onSignInSuccess(signInType,physicalPower,heart)\n            }\n        }\n\n        networkMgr.sendMessageByMsgObj(msgObj)\n    },\n\n    onSignInSuccess(signInType,physicalPower,heart) {\n        switch(signInType){\n            case 1:\n                require(\"dataMgr\").playerData.signInStatus = 2\n                break\n            case 2:\n                require(\"dataMgr\").playerData.signInStatus = 3\n                break\n            case 3:\n                require(\"dataMgr\").playerData.signInStatus = 3\n                break\n        }\n\n        require(\"dataMgr\").playerData.physicalPower = physicalPower\n        require(\"dataMgr\").playerData.heart = heart\n        require(\"systemsMgr\").closeSystem(this.sysName)\n    },\n\n    //advertis delegate\n    onVideoAdEnd() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1:\n                this.signIn(2)\n                break\n            case 2:\n                this.signIn(3)\n                break\n        }\n    }\n    // update (dt) {},\n});\n"]}