{"version":3,"sources":["assets/scripts/mainScene/selectSectionElementMgr.js"],"names":["cc","Class","Component","properties","processBarNode","Node","processLabelNode","iconNode","iconLabelNode","nameLabelNode","lockedIconSpriteFrame","SpriteFrame","sectionKey","config","mailInfo","selectSectionUINode","onLoad","start","setupData","getComponent","Label","string","require","getTextByIdAndLanguageType","sectionTitleTextId","parseInt","playerData","currentSection","Sprite","spriteFrame","color","sendNum","toString","totalNum","ProgressBar","progress","sectionConfig","mailIdsShouldToSend","levels","mailSysConfig","tag","conditions","index","oneCondition","conditionType","conditionPara","indexOf","push","mailId","levelId","totalMailNum","length","sendMailNum","currentMailIds","Object","keys","mails","oneMailId","result","onClick","showNoti","mainSceneMgr","director","getScene","getChildByName","log","selectedSection","setupSectionPerformance","playBgm","closeSystem"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        processBarNode: cc.Node,\n        processLabelNode: cc.Node,\n        iconNode: cc.Node,\n        iconLabelNode: cc.Node,\n        nameLabelNode: cc.Node,\n        lockedIconSpriteFrame: cc.SpriteFrame,\n\n        sectionKey: null,\n        config: null,\n        mailInfo: null,\n\n        selectSectionUINode: null\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n    },\n\n    start () {\n        if (this.sectionKey == null) {\n            return\n        }\n\n        this.setupData()\n        // this.nameLabelNode.getComponent(cc.Label).string = this.config.sectionDescrip\n        this.nameLabelNode.getComponent(cc.Label).string = require(\"textConfig\").getTextByIdAndLanguageType(this.config.sectionTitleTextId)\n        this.iconLabelNode.getComponent(cc.Label).string = this.sectionKey\n\n        if (parseInt(this.sectionKey) > require(\"dataMgr\").playerData.currentSection) {\n            this.iconNode.getComponent(cc.Sprite).spriteFrame = this.lockedIconSpriteFrame\n            this.nameLabelNode.color = cc.color()\n        }\n\n        this.processLabelNode.getComponent(cc.Label).string = this.mailInfo.sendNum.toString() + \" / \" + this.mailInfo.totalNum.toString()\n        this.processBarNode.getComponent(cc.ProgressBar).progress = this.mailInfo.sendNum / this.mailInfo.totalNum\n    },\n\n    // update (dt) {},\n    setupData() {\n        var sectionConfig = require(\"sectionConfig\")\n        this.config = sectionConfig[this.sectionKey]\n        var mailIdsShouldToSend = []\n        var levels = this.config.levels\n        var mailSysConfig = require(\"mailSysConfig\")\n        for (var tag in mailSysConfig) {\n            var conditions = mailSysConfig[tag].conditions\n            for (var index in conditions) {\n                var oneCondition = conditions[index]\n                var conditionType = oneCondition.conditionType\n                var conditionPara = oneCondition.conditionPara\n                if (conditionType == 1 && levels.indexOf(conditionPara) != -1) {\n                    mailIdsShouldToSend.push(oneCondition.mailId)\n                }\n                else if (conditionType == 2 && levels.indexOf(conditionPara.levelId) != -1) {\n                    mailIdsShouldToSend.push(oneCondition.mailId)\n                }\n            }\n        }\n\n        var totalMailNum = mailIdsShouldToSend.length\n        var sendMailNum = 0\n        if (totalMailNum > 0) {\n            var currentMailIds = Object.keys(require(\"dataMgr\").playerData.mails)\n            for (var index in mailIdsShouldToSend) {\n                var oneMailId = mailIdsShouldToSend[index]\n                if (currentMailIds.indexOf(oneMailId.toString()) != -1) {\n                    sendMailNum += 1\n                }\n            }\n        }\n        var result = {\n            totalNum: totalMailNum,\n            sendNum: sendMailNum\n        }\n        this.mailInfo = result\n    },\n\n    onClick() {\n\n        if (parseInt(this.sectionKey) > require(\"dataMgr\").playerData.currentSection) {\n            require(\"notificationMgr\").showNoti(require(\"textConfig\").getTextByIdAndLanguageType(158))\n            return\n        }\n        else if (parseInt(this.sectionKey) <= require(\"dataMgr\").playerData.currentSection ) {\n            var mainSceneMgr = cc.director.getScene().getChildByName(\"Canvas\").getComponent(\"mainSceneMgr\")\n            if (mainSceneMgr == null) {\n                cc.log(\"现在不是主界面，无法选择章节，这种情况应该不会出现的才对！\")\n            }\n            else {\n                if(parseInt(this.sectionKey) != mainSceneMgr.selectedSection) {\n                    mainSceneMgr.selectedSection = parseInt(this.sectionKey)\n                    mainSceneMgr.setupSectionPerformance()\n                    mainSceneMgr.playBgm()\n                }\n            }\n        }\n\n        require(\"systemsMgr\").closeSystem(\"selectSectionSys\")\n    }\n});\n"]}