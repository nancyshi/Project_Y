{"version":3,"sources":["../../../../../assets/scripts/mainScene/assets/scripts/mainScene/selectSectionElementMgr.js"],"names":["cc","Class","extends","Component","properties","processBarNode","Node","processLabelNode","iconNode","iconLabelNode","nameLabelNode","lockedIconSpriteFrame","SpriteFrame","sectionKey","config","mailInfo","selectSectionUINode","onLoad","start","setupData","getComponent","Label","string","sectionDescrip","parseInt","require","playerData","currentSection","Sprite","spriteFrame","sendNum","toString","totalNum","ProgressBar","progress","sectionConfig","mailIdsShouldToSend","levels","mailSysConfig","tag","conditions","index","oneCondition","conditionType","conditionPara","indexOf","push","mailId","levelId","totalMailNum","length","sendMailNum","currentMailIds","Object","keys","mails","oneMailId","result","onClick","showNoti","mainSceneMgr","director","getScene","getChildByName","log","selectedSection","setupSectionPerformance","closeSystem"],"mappings":"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","file":"selectSectionElementMgr.js","sourceRoot":"../../../../../assets/scripts/mainScene","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        processBarNode: cc.Node,\n        processLabelNode: cc.Node,\n        iconNode: cc.Node,\n        iconLabelNode: cc.Node,\n        nameLabelNode: cc.Node,\n        lockedIconSpriteFrame: cc.SpriteFrame,\n\n        sectionKey: null,\n        config: null,\n        mailInfo: null,\n\n        selectSectionUINode: null\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n    },\n\n    start () {\n        if (this.sectionKey == null) {\n            return\n        }\n\n        this.setupData()\n        this.nameLabelNode.getComponent(cc.Label).string = this.config.sectionDescrip\n        this.iconLabelNode.getComponent(cc.Label).string = this.sectionKey\n\n        if (parseInt(this.sectionKey) > require(\"dataMgr\").playerData.currentSection) {\n            this.iconNode.getComponent(cc.Sprite).spriteFrame = this.lockedIconSpriteFrame\n        }\n\n        this.processLabelNode.getComponent(cc.Label).string = this.mailInfo.sendNum.toString() + \" / \" + this.mailInfo.totalNum.toString()\n        this.processBarNode.getComponent(cc.ProgressBar).progress = this.mailInfo.sendNum / this.mailInfo.totalNum\n    },\n\n    // update (dt) {},\n    setupData() {\n        var sectionConfig = require(\"sectionConfig\")\n        this.config = sectionConfig[this.sectionKey]\n        var mailIdsShouldToSend = []\n        var levels = this.config.levels\n        var mailSysConfig = require(\"mailSysConfig\")\n        for (var tag in mailSysConfig) {\n            var conditions = mailSysConfig[tag].conditions\n            for (var index in conditions) {\n                var oneCondition = conditions[index]\n                var conditionType = oneCondition.conditionType\n                var conditionPara = oneCondition.conditionPara\n                if (conditionType == 1 && levels.indexOf(conditionPara) != -1) {\n                    mailIdsShouldToSend.push(oneCondition.mailId)\n                }\n                else if (conditionType == 2 && levels.indexOf(conditionPara.levelId) != -1) {\n                    mailIdsShouldToSend.push(oneCondition.mailId)\n                }\n            }\n        }\n\n        var totalMailNum = mailIdsShouldToSend.length\n        var sendMailNum = 0\n        if (totalMailNum > 0) {\n            var currentMailIds = Object.keys(require(\"dataMgr\").playerData.mails)\n            for (var index in mailIdsShouldToSend) {\n                var oneMailId = mailIdsShouldToSend[index]\n                if (currentMailIds.indexOf(oneMailId.toString()) != -1) {\n                    sendMailNum += 1\n                }\n            }\n        }\n        var result = {\n            totalNum: totalMailNum,\n            sendNum: sendMailNum\n        }\n        this.mailInfo = result\n    },\n\n    onClick() {\n\n        if (parseInt(this.sectionKey) > require(\"dataMgr\").playerData.currentSection) {\n            require(\"notificationMgr\").showNoti(\"这个章节还没有解锁哦\")\n            return\n        }\n        else if (parseInt(this.sectionKey) <= require(\"dataMgr\").playerData.currentSection ) {\n            var mainSceneMgr = cc.director.getScene().getChildByName(\"Canvas\").getComponent(\"mainSceneMgr\")\n            if (mainSceneMgr == null) {\n                cc.log(\"现在不是主界面，无法选择章节，这种情况应该不会出现的才对！\")\n            }\n            else {\n                if(parseInt(this.sectionKey) != mainSceneMgr.selectedSection) {\n                    mainSceneMgr.selectedSection = parseInt(this.sectionKey)\n                    mainSceneMgr.setupSectionPerformance()\n                }\n            }\n        }\n\n        require(\"systemsMgr\").closeSystem(\"selectSectionSys\")\n    }\n});\n"]}