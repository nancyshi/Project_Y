{"version":3,"sources":["../../../../assets/scripts/assets/scripts/loginSceneMgr.js"],"names":["cc","Class","extends","Component","properties","dataMgr","loginMgr","networkMgr","isLogining","changeSceneAnimationTime","nameEnSpriteFrame","SpriteFrame","onLoad","node","on","onTouchStart","textConfig","require","languageType","getChildByName","getComponent","Sprite","spriteFrame","start","delegate","retryNode","find","tween","repeatForever","to","scale","login","onPlayerDataUpdated","initAds","Label","string","getTextByIdAndLanguageType","index","children","self","temp","i","opacity","delay","call","loadReses","startHeartBeat","director","loadScene","active","loginType","platform","sys","WECHAT_GAME","LoginType","WE_CHAT_GAME","DEVICE_ID","event","_debugLogin","playerData","id","name","physicalPower","maxPhysicalPower","heart","maxHeart","currentSection","currentLevel","physicalPowerCostedFlag","onDestroy","off","onAllRetryFailed","loginInfo","loginInfoLabel"],"mappings":"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","file":"loginSceneMgr.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        dataMgr: null,\n        loginMgr: null,\n        networkMgr: null,\n        isLogining: false,\n        changeSceneAnimationTime: 2,\n        nameEnSpriteFrame: cc.SpriteFrame,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.node.on(\"touchstart\",this.onTouchStart,this)\n        var textConfig = require(\"textConfig\")\n        if (textConfig.languageType != 1) {\n            this.node.getChildByName(\"name\").getComponent(cc.Sprite).spriteFrame = this.nameEnSpriteFrame\n        }\n    },\n\n    start () {\n        this.dataMgr = require(\"dataMgr\")\n        this.loginMgr = require(\"loginMgr\")\n        this.networkMgr = require(\"networkMgr\")\n        this.networkMgr.delegate = this\n        var retryNode = cc.find(\"Canvas/retry\")\n        cc.tween(retryNode)\n            .repeatForever(\n                cc.tween()\n                    .to(0.5,{scale: 1.2})\n                    .to(0.5,{scale: 0.8})\n            )\n            .start()\n\n        this.login()\n        //this._debugLogin()\n    },\n\n    onPlayerDataUpdated() {\n        require(\"advertisMgr\").initAds()\n        cc.find(\"Canvas/loginInfo/textNode\").getComponent(cc.Label).string = require(\"textConfig\").getTextByIdAndLanguageType(157)\n        //animation \n        for (var index in this.node.children) {\n            var self = this\n\n            var temp = function(i) {\n                var node = self.node.children[i]\n                cc.tween(node)\n                    .to(self.changeSceneAnimationTime, {opacity: 0})\n                    .start()\n            }\n            temp(index)\n        }\n\n        cc.tween(this.node)\n            .delay(this.changeSceneAnimationTime)\n            .call(function(){\n                require(\"resMgr\").loadReses(function(){\n                    require(\"networkMgr\").startHeartBeat()\n                    cc.director.loadScene(\"mainScene\")\n                })\n            })\n            .start()\n    },\n\n    login() {\n        this.isLogining = true\n        var retryNode = cc.find(\"Canvas/retry\")\n        retryNode.active = false\n        cc.find(\"Canvas/loginInfo/textNode\").getComponent(cc.Label).string = require(\"textConfig\").getTextByIdAndLanguageType(156)\n\n        var loginType = null\n        var platform = cc.sys.platform\n        if (platform == cc.sys.WECHAT_GAME) {\n            loginType = this.loginMgr.LoginType.WE_CHAT_GAME\n        }\n        else {\n            loginType = this.loginMgr.LoginType.DEVICE_ID\n        }\n\n        this.loginMgr.login(loginType)\n    },\n\n    onTouchStart(event) {\n        if (this.isLogining == false) {\n            this.login()\n        }\n    },\n    // update (dt) {},\n\n    _debugLogin() {\n        this.dataMgr.playerData = {\n            id: 100000001,\n            name: \"new Player\",\n            physicalPower: 10,\n            maxPhysicalPower: 10,\n            heart: 10,\n            maxHeart: 10,\n            currentSection: 1,\n            currentLevel: 2,\n            physicalPowerCostedFlag: 0\n        }\n        this.onPlayerDataUpdated()\n    },\n\n    onDestroy() {\n        this.node.off(\"touchstart\",this.onTouchStart,this)\n    },\n    onAllRetryFailed() {\n        var loginInfo = cc.find(\"Canvas/loginInfo\")\n        var loginInfoLabel = loginInfo.getChildByName(\"textNode\").getComponent(cc.Label)\n        loginInfoLabel.string = \"连接服务器失败，请点击重试\"\n        loginInfo.active = true\n        var retryNode = cc.find(\"Canvas/retry\")\n        retryNode.active = true\n        this.isLogining = false\n    }\n    \n});\n"]}