{"version":3,"sources":["../../../../../assets/scripts/systems/assets/scripts/systems/welfarySys.js"],"names":["WelfarySys","cc","Class","extends","Component","properties","ui","enterButtonNode","animated","start","show","setupUi","others","getChildByName","scale","parent","currentScene","director","getScene","addChild","active","tween","to","close","self","call","require","create","ensureNodeMgr","getComponent","canClose","ensureButtonWillAutoCloseUi","cancelButtonWillAutoCloseUi","flag","playerData","initAdWatchedFlag","desStr","desText","onCancleButtonClick","onEnsureButtonClick","advMgr","delegate","showVideoAd","isExsistCancelButton","onVideoAdEnd","commitBody","successCallBack","commitPlayerDataToServer","onVideoAdShowError","notificationSys","showNoti","sharedWelfarySys","module","exports"],"mappings":"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","file":"welfarySys.js","sourceRoot":"../../../../../assets/scripts/systems","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar WelfarySys = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        ui: null,\n        enterButtonNode: null,\n        animated: false\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n\n  \n\n    start () {\n        \n    },\n\n    // update (dt) {},\n    show() {\n        if (this.ui == null) {\n            this.setupUi()\n        }\n        var others = this.ui.getChildByName(\"others\")\n        others.scale = 0\n        if (this.ui.parent == null) {\n            var currentScene = cc.director.getScene()\n            currentScene.getChildByName(\"Canvas\").addChild(this.ui)\n        }\n        else {\n            this.ui.active = true\n        }\n        cc.tween(others)\n            .to(0.3,{scale: 1})\n            .start()\n    },\n    close() {\n        var others = this.ui.getChildByName(\"others\")\n        var self = this\n        cc.tween(others)\n            .to(0.3,{scale: 0})\n            .call(function(){\n                self.ui.active = false\n            })\n            .start()\n    },\n    \n    setupUi() {\n        if (this.ui == null) {\n            this.ui = require(\"ensureSystem\").create()\n        }\n        var ensureNodeMgr = this.ui.getComponent(\"ensureSystemNodeMgr\")\n        ensureNodeMgr.canClose = false\n        ensureNodeMgr.ensureButtonWillAutoCloseUi = false\n        ensureNodeMgr.cancelButtonWillAutoCloseUi = false\n        \n        var flag = require(\"dataMgr\").playerData.initAdWatchedFlag\n        if (this.enterButtonNode != null) {\n            if (flag == 1) {\n                this.enterButtonNode.active = false\n            }\n            else if (flag == 0) {\n                this.enterButtonNode.active = true\n            }\n        }\n        var self = this\n        if (flag == 0) {\n            var desStr = \"观看视频广告，挑战关卡消耗体力永久免费！您是否愿意观看？\"\n            ensureNodeMgr.desText = desStr\n            ensureNodeMgr.onCancleButtonClick = function() {\n                self.close()\n            }\n            ensureNodeMgr.onEnsureButtonClick = function() {\n                var advMgr = require(\"advertisMgr\")\n                advMgr.delegate = self\n                advMgr.showVideoAd()\n            }\n        }\n        else if (flag == 1) {\n            var desStr = \"嗯？ 这个界面不应该出现的，你已经领取过福利啦~\"\n            ensureNodeMgr.desText = desStr\n            ensureNodeMgr.isExsistCancelButton = false\n            ensureNodeMgr.onEnsureButtonClick = function () {\n                self.close()\n            }\n        }\n    },\n\n    //advertis mgr protocals\n    onVideoAdEnd() {\n        var commitBody = {\n            initAdWatchedFlag: 1\n        }\n        var self = this\n        var successCallBack = function() {\n            require(\"dataMgr\").playerData.initAdWatchedFlag = 1\n            self.setupUi()\n            self.close()\n        }\n        require(\"dataMgr\").commitPlayerDataToServer(commitBody,successCallBack)\n    },\n\n    onVideoAdShowError() {\n        var notificationSys = require(\"notificationMgr\")\n        notificationSys.showNoti(\"好像有点问题~\")\n    }\n\n});\n\nvar sharedWelfarySys = new WelfarySys()\nmodule.exports = sharedWelfarySys"]}