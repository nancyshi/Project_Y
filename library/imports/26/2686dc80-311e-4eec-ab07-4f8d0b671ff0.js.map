{"version":3,"sources":["../../../../../assets/scripts/systems/assets/scripts/systems/addHeartSys.js"],"names":["AddHeartSys","cc","Class","extends","Component","properties","ui","heartAddNum","show","setupUi","others","getChildByName","scale","parent","director","getScene","addChild","active","tween","to","start","close","self","call","require","create","ensureSystemNodeMgr","getComponent","ensureButtonWillAutoCloseUi","cancelButtonWillAutoCloseUi","canClose","desStr","toString","desText","onCancleButtonClick","onEnsureButtonClick","advertisMgr","delegate","showVideoAd","onVideoAdEnd","addedHeart","playerData","heart","commitBody","successCallBack","name","indexOf","commitPlayerDataToServer","onVideoAdShowError","notificationMgr","showNoti","sharedAddHeartSys","module","exports"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,cAAcC,GAAGC,KAAH,CAAS;AACvBC,aAASF,GAAGG,SADW;;AAGvBC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,YAAI,IAhBI;AAiBRC,qBAAa;AAjBL,KAHW;;AAuBvB;;;AAIA;AACAC,QA5BuB,kBA4BhB;AACH,YAAI,KAAKF,EAAL,IAAW,IAAf,EAAqB;AACjB,iBAAKG,OAAL;AACH;;AAED,YAAIC,SAAS,KAAKJ,EAAL,CAAQK,cAAR,CAAuB,QAAvB,CAAb;AACAD,eAAOE,KAAP,GAAe,CAAf;AACA,YAAI,KAAKN,EAAL,CAAQO,MAAR,IAAkB,IAAtB,EAA4B;AACxBZ,eAAGa,QAAH,CAAYC,QAAZ,GAAuBJ,cAAvB,CAAsC,QAAtC,EAAgDK,QAAhD,CAAyD,KAAKV,EAA9D;AACH,SAFD,MAGK;AACD,iBAAKA,EAAL,CAAQW,MAAR,GAAiB,IAAjB;AACH;;AAEDhB,WAAGiB,KAAH,CAASR,MAAT,EACKS,EADL,CACQ,GADR,EACY,EAACP,OAAO,CAAR,EADZ,EAEKQ,KAFL;AAGH,KA7CsB;AA8CvBC,SA9CuB,mBA8Cf;AACJ,YAAIX,SAAS,KAAKJ,EAAL,CAAQK,cAAR,CAAuB,QAAvB,CAAb;AACA,YAAIW,OAAO,IAAX;AACArB,WAAGiB,KAAH,CAASR,MAAT,EACKS,EADL,CACQ,GADR,EACY,EAACP,OAAO,CAAR,EADZ,EAEKW,IAFL,CAEU,YAAU;AACZD,iBAAKhB,EAAL,CAAQW,MAAR,GAAiB,KAAjB;AACH,SAJL,EAKKG,KALL;AAMH,KAvDsB;AAwDvBX,WAxDuB,qBAwDb;AACN,YAAI,KAAKH,EAAL,IAAW,IAAf,EAAqB;AACjB,iBAAKA,EAAL,GAAUkB,QAAQ,cAAR,EAAwBC,MAAxB,EAAV;AACH;AACD,YAAIH,OAAO,IAAX;AACA,YAAII,sBAAsB,KAAKpB,EAAL,CAAQqB,YAAR,CAAqB,qBAArB,CAA1B;AACAD,4BAAoBE,2BAApB,GAAkD,KAAlD;AACAF,4BAAoBG,2BAApB,GAAkD,KAAlD;AACAH,4BAAoBI,QAApB,GAA+B,KAA/B;AACA,YAAIC,SAAS,sBAAsB,KAAKxB,WAAL,CAAiByB,QAAjB,EAAnC;AACAD,iBAASA,SAAS,YAAlB;;AAEAL,4BAAoBO,OAApB,GAA8BF,MAA9B;AACAL,4BAAoBQ,mBAApB,GAA0C,YAAW;AACjDZ,iBAAKD,KAAL;AACH,SAFD;AAGAK,4BAAoBS,mBAApB,GAA0C,YAAW;AACjD,gBAAIC,cAAcZ,QAAQ,aAAR,CAAlB;AACAY,wBAAYC,QAAZ,GAAuBf,IAAvB;AACAc,wBAAYE,WAAZ;AACH,SAJD;AAKH,KA7EsB;AA+EvBC,gBA/EuB,0BA+ER;AACX,YAAIC,aAAahB,QAAQ,SAAR,EAAmBiB,UAAnB,CAA8BC,KAA9B,GAAsC,KAAKnC,WAA5D;AACA,YAAIoC,aAAa;AACbD,mBAAOF;AADM,SAAjB;AAGA,YAAIlB,OAAO,IAAX;AACA,YAAIsB,kBAAkB,SAAlBA,eAAkB,GAAW;AAC7BpB,oBAAQ,SAAR,EAAmBiB,UAAnB,CAA8BC,KAA9B,GAAsCF,UAAtC;AACA,gBAAIvC,GAAGa,QAAH,CAAYC,QAAZ,GAAuB8B,IAAvB,IAA+B,WAAnC,EAAgD;AAC5C5C,mBAAGa,QAAH,CAAYC,QAAZ,GAAuBJ,cAAvB,CAAsC,QAAtC,EAAgDgB,YAAhD,CAA6D,cAA7D,EAA6Ee,KAA7E,GAAqFF,UAArF;AACH,aAFD,MAGK,IAAIvC,GAAGa,QAAH,CAAYC,QAAZ,GAAuB8B,IAAvB,CAA4BC,OAA5B,CAAoC,OAApC,IAA+C,CAAC,CAApD,EAAuD;AACxD7C,mBAAGa,QAAH,CAAYC,QAAZ,GAAuBJ,cAAvB,CAAsC,QAAtC,EAAgDgB,YAAhD,CAA6D,UAA7D,EAAyEe,KAAzE,GAAiFF,UAAjF;AACH;AACJ,SARD;;AAUAhB,gBAAQ,SAAR,EAAmBuB,wBAAnB,CAA4CJ,UAA5C,EAAuDC,eAAvD;AACH,KAhGsB;AAkGvBI,sBAlGuB,gCAkGF;AACjB,YAAIC,kBAAkBzB,QAAQ,iBAAR,CAAtB;AACAyB,wBAAgBC,QAAhB,CAAyB,QAAzB;AACH;AArGsB,CAAT,CAAlB;;AA0GA,IAAIC,oBAAoB,IAAInD,WAAJ,EAAxB;AACAoD,OAAOC,OAAP,GAAiBF,iBAAjB","file":"addHeartSys.js","sourceRoot":"../../../../../assets/scripts/systems","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar AddHeartSys = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        ui: null,\n        heartAddNum: 10\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    \n\n    // update (dt) {},\n    show() {\n        if (this.ui == null) {\n            this.setupUi()\n        }\n\n        var others = this.ui.getChildByName(\"others\")\n        others.scale = 0\n        if (this.ui.parent == null) {\n            cc.director.getScene().getChildByName(\"Canvas\").addChild(this.ui)\n        }\n        else {\n            this.ui.active = true\n        }\n\n        cc.tween(others)\n            .to(0.3,{scale: 1})\n            .start()\n    },\n    close() {\n        var others = this.ui.getChildByName(\"others\")\n        var self = this\n        cc.tween(others)\n            .to(0.3,{scale: 0})\n            .call(function(){\n                self.ui.active = false\n            })\n            .start()\n    },\n    setupUi() {\n        if (this.ui == null) {\n            this.ui = require(\"ensureSystem\").create()\n        }\n        var self = this\n        var ensureSystemNodeMgr = this.ui.getComponent(\"ensureSystemNodeMgr\")\n        ensureSystemNodeMgr.ensureButtonWillAutoCloseUi = false\n        ensureSystemNodeMgr.cancelButtonWillAutoCloseUi = false\n        ensureSystemNodeMgr.canClose = false\n        var desStr = \"您可以观看视频广告，获得金币 * \" + this.heartAddNum.toString()\n        desStr = desStr + \" ，您是否愿意观看？\"\n\n        ensureSystemNodeMgr.desText = desStr\n        ensureSystemNodeMgr.onCancleButtonClick = function() {\n            self.close()\n        }\n        ensureSystemNodeMgr.onEnsureButtonClick = function() {\n            var advertisMgr = require(\"advertisMgr\")\n            advertisMgr.delegate = self\n            advertisMgr.showVideoAd()\n        }\n    },\n\n    onVideoAdEnd() {\n        var addedHeart = require(\"dataMgr\").playerData.heart + this.heartAddNum\n        var commitBody = {\n            heart: addedHeart\n        }\n        var self = this\n        var successCallBack = function() {\n            require(\"dataMgr\").playerData.heart = addedHeart\n            if (cc.director.getScene().name == \"mainScene\") {\n                cc.director.getScene().getChildByName(\"Canvas\").getComponent(\"mainSceneMgr\").heart = addedHeart\n            }\n            else if (cc.director.getScene().name.indexOf(\"level\") > -1) {\n                cc.director.getScene().getChildByName(\"Canvas\").getComponent(\"levelMgr\").heart = addedHeart\n            }\n        }\n\n        require(\"dataMgr\").commitPlayerDataToServer(commitBody,successCallBack)\n    },\n\n    onVideoAdShowError() {\n        var notificationMgr = require(\"notificationMgr\")\n        notificationMgr.showNoti(\"貌似有些问题\")\n    }\n    \n \n});\n\nvar sharedAddHeartSys = new AddHeartSys()\nmodule.exports = sharedAddHeartSys"]}