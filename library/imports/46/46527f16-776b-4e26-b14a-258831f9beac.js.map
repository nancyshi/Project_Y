{"version":3,"sources":["../../../../../../assets/scripts/systems/mailSys/assets/scripts/systems/mailSys/mailSysMgr.js"],"names":["cc","Class","extends","Component","properties","uibg","Node","closeButtonNode","tagSection","mailSection","notiSection","mailSectionContentNode","mailSectionEmptyLabelNode","mailSectionPrefab","Prefab","tagSectionPrefab","selectedTagEffectPrefab","opendMailPrefab","tags","mailsByTag","default","unReadedMailNums","selectedTag","get","_selectedTag","set","value","setupMailSection","setupNotiSection","selectedTagNode","_selectedTagNode","selectedTagEffect","parent","x","y","addChild","targetY","tween","to","start","_selectedTagEffect","effect","instantiate","tagSectionStartY","tagSectionDis","mailSectionStartPosition","v2","mailSectionNodeDis","mailSectionNodeReadedColor","_mailSectionNodeReadedColor","color","sysName","onLoad","self","on","require","closeSystem","setupData","setupUI","setupTagSection","index","oneTag","tagName","node","getComponent","Label","string","_forceUpdateRenderData","bindFunction","givenNode","givenTag","redPointShowCondition","mails","playerData","unReadNum","key","oneMail","tag","status","name","tagMails","mailIdsArry","Object","keys","destroyAllChildren","length","active","height","sortFunction","mailId1","mailId2","mail1","mail2","timeStamp1","timeStamp","timeStamp2","sort","mailConfig","totalHeight","mailId","mail","unReadIconNode","getChildByName","readedIconNode","titleLabelNode","seperateLineNode","title","nodeWidth","width","nodeHeight","toString","givenMailId","openOneMail","minHeight","unReadMailNum","str","mailConditionIndex","mailSysConfig","element","conditions","conditionType","level","conditionPara","result","_getSectionAndLevelNumOfSection","section","levelNumOfSection","levelId","minStepNum","givenLevelId","sectionConfig","levels","indexOf","stauts","_insertOneMail","mgr","relatedMailSectionNode","relatedMailSysMgr","setOneMailReaded","indexOfOptions","complete","log","networkMgr","messageObj","makeMessageObj","message","playerId","id","selectedOptionIndex","successCallBack","xhr","response","responseText","JSON","parse","type","sendMessageByMsgObj","dataMonitored"],"mappings":"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","file":"mailSysMgr.js","sourceRoot":"../../../../../../assets/scripts/systems/mailSys","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        uibg: cc.Node,\n        closeButtonNode: cc.Node,\n        tagSection: cc.Node,\n        mailSection: cc.Node,\n        notiSection: cc.Node,\n        mailSectionContentNode: cc.Node,\n        mailSectionEmptyLabelNode: cc.Node,\n\n        mailSectionPrefab: cc.Prefab,\n        tagSectionPrefab: cc.Prefab,\n        selectedTagEffectPrefab: cc.Prefab,\n        opendMailPrefab: cc.Prefab,\n        tags: null,\n        mailsByTag: {\n            default: {}\n        },\n\n        unReadedMailNums: {\n            default: {}\n        },\n\n        selectedTag: {\n            get() {\n                return this._selectedTag\n            }, \n            set(value) {\n                this._selectedTag = value\n                this.setupMailSection()\n                this.setupNotiSection()\n            }\n        },\n        selectedTagNode: {\n            get(){\n                return this._selectedTagNode\n            },\n            set(value) {\n                this._selectedTagNode = value\n                if (this.selectedTagEffect.parent == null) {\n                    this.selectedTagEffect.x = this.selectedTagNode.x\n                    this.selectedTagEffect.y = this.selectedTagNode.y\n                    this.tagSection.addChild(this.selectedTagEffect,0)\n                }\n                else {\n                    var targetY = this.selectedTagNode.y\n                    cc.tween(this.selectedTagEffect)\n                        .to(0.1,{y: targetY})\n                        .start()\n                }\n            }\n        },\n        selectedTagEffect: {\n            get() {\n                if (this._selectedTagEffect == null) {\n                    var effect = cc.instantiate(this.selectedTagEffectPrefab)\n                    this._selectedTagEffect = effect\n                }\n                return this._selectedTagEffect\n            },\n            set(value) {\n                this._selectedTagEffect = value\n            }\n        },\n        tagSectionStartY: -86.345,\n        tagSectionDis: 120,\n\n\n        mailSectionStartPosition: cc.v2(-125.788,373.356),\n        mailSectionNodeDis: 32,\n        mailSectionNodeReadedColor: {\n            get() {\n                if (this._mailSectionNodeReadedColor == null) {\n                    this._mailSectionNodeReadedColor = cc.color(102,102,102)\n                } \n                return this._mailSectionNodeReadedColor\n            },\n            set(value) {\n                this._mailSectionNodeReadedColor = value\n            }\n        },\n\n        sysName: \"mailSys\"\n        \n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var self = this\n        this.closeButtonNode.on(\"click\",function(){\n            require(\"systemsMgr\").closeSystem(self.sysName)\n        })\n        this.setupData()\n        this.setupUI()\n    },\n\n    start () {\n\n    },\n\n    setupTagSection() {\n        for (var index in this.tags) {\n            var oneTag = this.tags[index]\n            var tagName = require(\"mailSysConfig\")[oneTag].tagName\n            var node = cc.instantiate(this.tagSectionPrefab)\n            node.getComponent(cc.Label).string = tagName\n            node.getComponent(cc.Label)._forceUpdateRenderData()\n            var self = this\n            var bindFunction = function(givenNode, givenTag) {\n                givenNode.on(\"click\",function(){\n                    if (self.selectedTag != givenTag) {\n                        self.selectedTag = givenTag\n                    }\n                    if (self.selectedTagNode != givenNode) {\n                        self.selectedTagNode = givenNode\n                    }\n                })\n                givenNode.getComponent(\"redPointMgr\").redPointShowCondition = function(){\n                    var mails = require(\"dataMgr\").playerData.mails\n                    var unReadNum = 0\n                    for (var key in mails) {\n                        var oneMail = mails[key]\n                        if (oneMail.tag == givenTag && oneMail.status == 0) {\n                            unReadNum += 1\n                        }\n                    }\n                    if (unReadNum > 0) {\n                        return true\n                    }\n                    else {\n                        return false\n                    }\n                }\n            }\n            bindFunction(node,oneTag)\n            \n            node.y = this.tagSectionStartY - index * this.tagSectionDis\n            node.name = oneTag\n            this.tagSection.addChild(node,1)\n            if (index == 0) {\n                this.selectedTag = oneTag\n                this.selectedTagNode = node\n            }\n        }\n    },\n\n    setupMailSection() {\n        var tagMails = this.mailsByTag[this.selectedTag]\n        var mailIdsArry = Object.keys(tagMails)\n        this.mailSectionContentNode.destroyAllChildren()\n        if (mailIdsArry.length == 0) {\n            this.mailSectionEmptyLabelNode.active = true\n            this.mailSectionContentNode.height = 0\n            return\n        }\n        \n        this.mailSectionEmptyLabelNode.active = false\n        var self = this\n        var sortFunction = function(mailId1, mailId2) {\n            var mail1 = self.mailsByTag[self.selectedTag][mailId1]\n            var mail2 = self.mailsByTag[self.selectedTag][mailId2]\n            if (mail1.status == 0 && mail2.status == 1) {\n                return -1\n            }\n            else if (mail1.status == 1 && mail2.status == 0) {\n                return 1\n            }\n            else {\n                var timeStamp1 = mail1.timeStamp\n                var timeStamp2 = mail2.timeStamp\n                if (timeStamp1 < timeStamp2) {\n                    return 1\n                }\n                else {\n                    return -1\n                }\n            }\n        }\n        mailIdsArry = mailIdsArry.sort(sortFunction)\n        var mailConfig = require(\"mailConfig\")\n        var totalHeight = 0\n        for (var index in mailIdsArry) {\n            var mailId = mailIdsArry[index]\n            var mail = require(\"dataMgr\").playerData.mails[mailId]\n            var node = cc.instantiate(this.mailSectionPrefab)\n            var unReadIconNode = node.getChildByName(\"icon_unread\")\n            var readedIconNode = node.getChildByName(\"icon_readed\")\n            var titleLabelNode = node.getChildByName(\"titleLabel\")\n            var seperateLineNode = node.getChildByName(\"seperateLine\")\n\n            if (mail.status == 1) {\n                unReadIconNode.active = false\n                readedIconNode.active = true\n                titleLabelNode.color = this.mailSectionNodeReadedColor\n            }\n\n            titleLabelNode.getComponent(cc.Label).string = mailConfig[mailId].title\n            seperateLineNode.y = -titleLabelNode.height\n            node.y = -totalHeight\n            var nodeWidth = titleLabelNode.x + titleLabelNode.width / 2 - (unReadIconNode.x - unReadIconNode.width / 2)\n            var nodeHeight = titleLabelNode.height\n            node.width = nodeWidth\n            node.height = nodeHeight\n            node.name = mailId.toString()\n            totalHeight = totalHeight + titleLabelNode.height + 2\n            if (index != mailIdsArry.length - 1) {\n                totalHeight += this.mailSectionNodeDis\n            }\n            var self = this\n            var bindFunction = function(givenNode, givenMailId) {\n                givenNode.on(\"click\",function(){\n                    self.openOneMail(givenMailId,givenNode)\n                })\n            }\n            bindFunction(node,mailId)\n            this.mailSectionContentNode.addChild(node)\n        }\n        var minHeight = this.mailSectionContentNode.height\n        if (totalHeight > minHeight) {\n            this.mailSectionContentNode.height = totalHeight\n        }\n    },\n\n    setupNotiSection() {\n        var unReadMailNum = this.unReadedMailNums[this.selectedTag]\n        if (unReadMailNum > 0) {\n            var str = \"您还有未读邮件，请先查看完哦，心急不是好习惯 -.- \"\n            this.notiSection.getChildByName(\"notiLabel\").getComponent(cc.Label).string = str\n            return\n        }\n        \n        var mailConditionIndex = require(\"dataMgr\").playerData.mailConditionIndex\n        var index = mailConditionIndex[this.selectedTag]\n        var mailSysConfig = require(\"mailSysConfig\")\n        var element = mailSysConfig[this.selectedTag].conditions[index]\n\n        if (element.conditionType == 1) {\n            var level = element.conditionPara\n            var result = this._getSectionAndLevelNumOfSection(level)\n            if (result != false) {\n                var section = result[0]\n                var levelNumOfSection = result[1]\n                var str  = \"达到 \" + section.toString() + \" - \" + levelNumOfSection.toString()\n                str = str + \" ，会有新的邮件，加油吧少年！\"\n                this.notiSection.getChildByName(\"notiLabel\").getComponent(cc.Label).string = str\n            }\n        }\n\n        else if (element.conditionType == 2) {\n            //get minum step of one level\n            var levelId = element.conditionPara.levelId\n            var minStepNum = element.conditionPara.minStepNum\n\n            var result = this._getSectionAndLevelNumOfSection(levelId)\n            if (result != false) {\n                var section = result[0]\n                var level = result[1]\n\n                var str = \"在 \" + section.toString() + \" - \" + level.toString()\n                str = str + \" 用最多 \" + minStepNum + \" 步通关，会有新的邮件，加油吧少年！\"\n                this.notiSection.getChildByName(\"notiLabel\").getComponent(cc.Label).string = str\n            }\n        }\n    },\n    _getSectionAndLevelNumOfSection(givenLevelId) {\n        var section = null\n        var levelNumOfSection = null\n        var sectionConfig = require(\"sectionConfig\")\n        for (var key in sectionConfig) {\n            var levels = sectionConfig[key].levels\n            var index = levels.indexOf(givenLevelId)\n            if (index != -1) {\n                section = key\n                levelNumOfSection = index + 1\n                return [section, levelNumOfSection]\n            }\n        }\n        return false\n    },\n\n    setupData() {\n        var mails = require(\"dataMgr\").playerData.mails\n        this.tags = Object.keys(require(\"mailSysConfig\"))\n        for (var index in this.tags) {\n            var oneTag = this.tags[index]\n            this.mailsByTag[oneTag] = {}\n            this.unReadedMailNums[oneTag] = 0\n            for (var key in mails) {\n                var oneMail = mails[key]\n                if (oneMail.tag == oneTag) {\n                    this.mailsByTag[oneTag][key] = oneMail\n                    if (oneMail.stauts == 0) {\n                        this.unReadedMailNums[oneTag] += 1\n                    }\n                }\n            }\n        }\n    },\n\n    setupUI() {\n        this.setupTagSection()\n        this.setupMailSection()\n        this.setupNotiSection()\n    },\n\n    _insertOneMail(mailId, mail){\n        if (mail.tag == this.selectedTag) {\n            this.setupMailSection()\n            this.setupNotiSection()\n        }\n    },\n\n    openOneMail(givenMailId,givenNode) {\n        var node = cc.instantiate(this.opendMailPrefab)\n        var mgr = node.getComponent(\"mailSysMailMgr\")\n        mgr.mailId = givenMailId\n        mgr.relatedMailSectionNode = givenNode\n        mgr.relatedMailSysMgr = this\n        this.node.addChild(node)\n    },\n    setOneMailReaded(mailId,indexOfOptions, complete = function(){},relatedMailSectionNode) {\n        var mail = require(\"dataMgr\").playerData.mails[mailId]\n        if (mail.status == 1) {\n            cc.log(\"this mail is already readed\")\n            return\n        }\n        var networkMgr = require(\"networkMgr\")\n        var messageObj = networkMgr.makeMessageObj(\"mailModule\",\"readMailMessageType\")\n        messageObj.message.playerId = require(\"dataMgr\").playerData.id\n        messageObj.message.mailId = mailId\n        messageObj.message.selectedOptionIndex = indexOfOptions\n        var self = this\n        messageObj.successCallBack = function(xhr) {\n            var response = xhr.responseText\n            response = JSON.parse(response)\n            if (response.type == \"success\") {\n                mail.status = 1\n                mail.selectedOptionIndex = indexOfOptions\n                relatedMailSectionNode.getChildByName(\"icon_readed\").active = true\n                relatedMailSectionNode.getChildByName(\"icon_unread\").active = false\n                relatedMailSectionNode.getChildByName(\"titleLabel\").color = self.mailSectionNodeReadedColor\n                self.unReadedMailNums[mail.tag] -= 1\n                //self.setupRedPoint()\n                self.setupNotiSection()\n                complete()\n            }\n        }\n        networkMgr.sendMessageByMsgObj(messageObj)\n    },\n\n    dataMonitored(key,value) {\n        var mailConfig = require(\"mailConfig\")\n        if (Object.keys(mailConfig).indexOf(key) != -1) {\n            this.setupData()\n            this._insertOneMail(key,value)\n        }\n    }\n    // update (dt) {},\n});\n"]}