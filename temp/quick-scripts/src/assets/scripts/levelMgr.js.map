{"version":3,"sources":["assets/scripts/levelMgr.js"],"names":["cc","Class","Component","properties","bullets","minDis","maxOffsetDegree","directionTryto","flag","helper","walls","targetsNum","get","_targetsNum","set","value","onSuccess","linePrefab","Prefab","bulletPrefab","playerData","retryButton","Node","heartForRetryCost","_heartForRetryCostwe","getChildByName","getComponent","Label","string","toString","heart","_heart","find","Button","interactable","isMoved","maxHeart","_maxHeart","_isMoved","currentStepNum","_currentStepNum","currentStepNumLabel","node","require","getFormatedString","level","soundEffect","onLoad","textConfig","Helper","setupNodesByConfig","self","loader","loadRes","err","res","getTextByIdAndLanguageType","start","on","onTouchStart","onTouchMove","onTouchEnd","bulletsNode","children","currentLevel","delegate","wallsNode","length","graphic","Graphics","startPoint","pointNodes","index","point","moveTo","x","y","lineTo","close","stroke","fill","minStepNumLabel","minStepKey","minStepNum","minSteps","undefined","isGuilded","guildNode","instantiate","reses","addChild","playBgm","levelConfig","bgmPath","audioEngine","stopAll","play","event","startLocation","getStartLocation","tmpDirection","v2","getLocationX","getLocationY","dis","mag","direction","getPossiableDirection","moveBullets","onDestroy","off","delta","isPossiableWithGivenDirection","givenDirection","angle","signAngle","degree","Math","PI","abs","status","shadows","bullet","bulletMgr","nearestWallInfo","getNearestWallInfo","shadowNode","suitablePosition","width","height","originNode","push","maxTryTime","resolveShadows","willAddStepNum","isTwoPositionSimilarEqual","targetPosition","movingDirection","normalizeSelf","movingTime","v","vx","vy","movingSpeed","scheduleOnce","levels","currentSection","indexOf","newLevel","newSection","commitBody","newLevels","physicalPowerCostedFlag","preLevel","successCallBack","animatedToScene","commitPlayerDataToServer","oneShadow","i","anotherShadow","testResult","_selectStaticShadowAndShaodwForResolved","staticShadow","tempShadow","shadowForResolved","staticBorderLines","getLinesOfOneNode","staticLine","ray","makeRay","k","line","rayTest","newPoint2","p2","p1","newPoint1","ray1","position","currentDistance","targetDis","getDisToSelfBorder","disFromBorder","getSuitablePoint","updatedDis","shadow1","shadow2","temp","s1","s2","originCrossFlag","shadowCrossFlag","originLines","key","oneLine","isOneNodeWillCollidWithOneLineInDirection","shadowLines","result","generateWalls","config","wallPathes","onePath","points","realPoints","realPoint","currentPoint","lineWidth","offset","wallNodes","isClosed","directedLine","offsetDirection","rotate","bulletConfig","con","scale","onClickRetryButton","gameMgr","enterLevelScene","onAllRetryFailed","onClickBackButton","wallPrefab","targetPrefab","pathWayPrefab","levelSceneConfig","_setupFillNodes","_setupWalls","_setupTargets","_setupPathWaysNode","_setupBullets","_setupNodePropertyByConfig","givenNode","givenConfig","fillNodesConfig","fillNodes","oneNodeConfig","oneNode","wallsConfig","oneWallConfig","oneWallNode","targetsConfig","targets","oneTargetConfig","oneTargetNode","pathWaysConfig","pathWaysNode","onePathWayConfig","onePathWayNode","name","oneChildConfig","oneChildNode","bulletsConfig","oneBulletConfig","oneBulletNode","basicConfig","basic","mgrConfig","mgr","bulletType","Sprite","spriteFrame","sliderFrame","pathWaysNodeName","pathWaysNodePath","dataMonitored","levelId","slice","parseInt"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        bullets: [],\n        minDis: 50,\n        maxOffsetDegree: 45,\n        directionTryto: null,\n        flag: false,\n        helper: null,\n\n        walls: [],\n        targetsNum: {\n            get() {\n                return this._targetsNum\n            },\n            set(value) {\n                this._targetsNum = value\n                if (value == 0) {\n                    this.onSuccess()\n                }\n            }\n        },\n\n        linePrefab: cc.Prefab,\n        bulletPrefab: cc.Prefab,\n\n        playerData: null,\n        retryButton: cc.Node,\n        heartForRetryCost: {\n            get() {\n                return this._heartForRetryCostwe\n            },\n            set(value){\n                this._heartForRetryCostwe = value\n                this.retryButton.getChildByName(\"heartCostLabel\").getComponent(cc.Label).string = value.toString()\n            } \n        },\n\n        heart: {\n            get() {\n                return this._heart\n            },\n            set(value) {\n                this._heart = value\n                cc.find(\"Canvas/uiNode/heartLabel\").getComponent(cc.Label).string = value.toString()\n                if (value < this.heartForRetryCost) {\n                    this.retryButton.getComponent(cc.Button).interactable = false\n                }\n                else {\n                    if (this.isMoved == false) {\n                        return\n                    }\n                    this.retryButton.getComponent(cc.Button).interactable = true\n                }\n            }\n        },\n\n        maxHeart: {\n            get() {\n                return this._maxHeart\n            },\n            set(value) {\n                this._maxHeart = value\n            }\n        },\n\n        isMoved: {\n            get() {\n                if (this._isMoved == null) {\n                    this._isMoved = false\n                }\n                return this._isMoved\n            },\n            set(value) {\n                this._isMoved = value\n                if (value == true && this.heartForRetryCost <= this.heart) {\n                    this.retryButton.getComponent(cc.Button).interactable = true\n                }\n            }\n        },\n        currentStepNum: {\n            get() {\n                if (this._currentStepNum == null) {\n                    this._currentStepNum = 0\n                }\n                return this._currentStepNum\n            },\n            set(value) {\n                this._currentStepNum = value\n                var currentStepNumLabel = this.node.getChildByName(\"uiNode\").getChildByName(\"currentStepNumLabel\")\n                //currentStepNumLabel.getComponent(cc.Label).string = \"当前步数：\" + value.toString()\n                currentStepNumLabel.getComponent(cc.Label).string = require(\"textConfig\").getFormatedString(154,[value.toString()])\n            }\n        },\n        level: null,\n        soundEffect: null\n        \n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var textConfig = require(\"textConfig\")\n        var Helper = require(\"helper\")\n        this.helper = new Helper()\n        //this.level = 1\n        this.setupNodesByConfig()\n        var self = this\n        cc.loader.loadRes(\"effectSounds/hit\",function(err,res){\n            self.soundEffect = res\n        })\n\n        this.retryButton.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(152)\n        cc.find(\"Canvas/uiNode/currentStepNumLabel\").getComponent(cc.Label).string = textConfig.getFormatedString(154,[0])\n    },\n\n    start () {\n        this.node.on(\"touchstart\",this.onTouchStart,this)\n        this.node.on(\"touchmove\",this.onTouchMove,this)\n        this.node.on(\"touchend\",this.onTouchEnd,this)\n        //this.generateWalls()\n        var bulletsNode = cc.find(\"Canvas/bullets\")\n        this.bullets = bulletsNode.children\n        this.playerData = require(\"dataMgr\").playerData\n\n        this.maxHeart = this.playerData.maxHeart\n        if (this.level == this.playerData.currentLevel) {\n            this.heartForRetryCost = require(\"levelConfig\")[this.playerData.currentLevel.toString()].heartForRetryCost\n        }\n        else {\n            this.heartForRetryCost = 0\n        }\n    \n        this.heart = this.playerData.heart\n        require(\"networkMgr\").delegate = this\n        var wallsNode = cc.find(\"Canvas/walls\")\n        this.walls = wallsNode.children\n        this.targetsNum = cc.find(\"Canvas/targets\").children.length\n\n        var graphic = cc.find(\"Canvas/fillNodes\").getComponent(cc.Graphics)\n        var startPoint = null\n        var pointNodes = cc.find(\"Canvas/fillNodes\").children\n        if (pointNodes.length == 0) {\n            return\n        }\n        for (var index in pointNodes) {\n            var point = pointNodes[index]\n            if (startPoint == null) {\n                graphic.moveTo(point.x, point.y)\n                startPoint = point\n            }\n\n            graphic.lineTo(point.x, point.y)\n        }\n        graphic.close()\n        graphic.stroke()\n        graphic.fill()\n\n        var minStepNumLabel = this.node.getChildByName(\"uiNode\").getChildByName(\"minStepNumLabel\")\n        var minStepKey = \"minStep_level_\" + this.level.toString()\n        var minStepNum = require(\"dataMgr\").playerData.minSteps[minStepKey]\n        if (minStepNum == null || minStepNum == undefined) {\n            minStepNum = require(\"textConfig\").getTextByIdAndLanguageType(155)\n        }\n        minStepNumLabel.getComponent(cc.Label).string = require(\"textConfig\").getFormatedString(153,[minStepNum.toString()])\n\n        if (require(\"dataMgr\").playerData.isGuilded == 0) {\n            var guildNode = cc.instantiate(require(\"resMgr\").reses[\"guildNodePrefab\"])\n            this.node.addChild(guildNode)\n        } \n        // var guildNode = cc.instantiate(require(\"resMgr\").reses[\"guildNodePrefab\"])\n        // this.node.addChild(guildNode)\n    },\n\n    // update (dt) {},\n    playBgm() {\n        var levelConfig = require(\"levelConfig\")\n        var bgmPath = levelConfig[this.level].bgmPath\n        cc.loader.loadRes(bgmPath,function(err,res){\n            cc.audioEngine.stopAll()\n            cc.audioEngine.play(res)\n        })\n    },\n\n    onTouchStart(event){\n        this.directionTryto = null\n        this.flag = true\n    },\n\n    onTouchMove(event) {\n        if (this.flag == false) {\n            return\n        }\n        var startLocation = event.getStartLocation()\n        var tmpDirection = cc.v2(event.getLocationX() - startLocation.x, event.getLocationY() - startLocation.y)\n        var dis = tmpDirection.mag()\n        if (dis < this.minDis) {\n            return\n        }\n        else {\n            var direction = this.getPossiableDirection(tmpDirection)\n            if (direction == -1) {\n                this.flag = false\n                return\n            }\n\n            if (this.directionTryto == null) {\n                this.directionTryto = direction\n            }\n\n            this.flag = false\n            this.moveBullets(this.directionTryto)\n        }\n    },\n    onTouchEnd(event) {\n\n    },\n\n    onDestroy() {\n        this.node.off(\"touchstart\",this.onTouchStart,this)\n        this.node.off(\"touchmove\",this.onTouchMove,this)\n        this.node.off(\"touchend\",this.onTouchEnd,this)\n    },\n\n    getPossiableDirection(delta) {\n        if (this.isPossiableWithGivenDirection(delta,cc.v2(1,0)) == true) {\n            return cc.v2(1,0) //right\n        }\n        else if (this.isPossiableWithGivenDirection(delta,cc.v2(0,-1)) == true) {\n            return cc.v2(0,-1) //down\n        }\n        else if (this.isPossiableWithGivenDirection(delta,cc.v2(-1,0)) == true) {\n            return cc.v2(-1,0) //left\n        }\n        else if (this.isPossiableWithGivenDirection(delta,cc.v2(0,1)) == true) {\n            return cc.v2(0,1) //up\n        }\n        else {\n            return -1 //no direction match\n        }\n    },\n    \n    isPossiableWithGivenDirection(delta,givenDirection) {\n        var angle = delta.signAngle(givenDirection)\n        var degree = angle / Math.PI * 180\n        if (Math.abs(degree) <= this.maxOffsetDegree) {\n            return true\n        }\n        else {\n            return false\n        }\n    },\n    \n    moveBullets(direction) {\n        for (var index in this.bullets) {\n            if (this.bullets[index].getComponent(\"bulletMgr\").status != 0) {\n                return\n            }\n        }\n        var shadows = []\n        for (var index in this.bullets) {\n            var bullet = this.bullets[index]\n            var bulletMgr = bullet.getComponent(\"bulletMgr\")\n            var nearestWallInfo = bulletMgr.getNearestWallInfo(direction)\n            var shadowNode = {\n                x: nearestWallInfo.suitablePosition.x,\n                y: nearestWallInfo.suitablePosition.y,\n                width: bullet.width,\n                height: bullet.height,\n                dis: nearestWallInfo.dis,\n                originNode: bullet\n            }\n            shadows.push(shadowNode)\n        }\n\n        //resolve shadows\n        var maxTryTime = 100\n        while(this.resolveShadows(shadows,direction) == false) {\n            if (maxTryTime <= 0) {\n                // cc.log(\"CAN'T FIND A SUITABLE POSITION\")\n                break\n            }\n            maxTryTime -= 1\n        }\n        var willAddStepNum = false\n        for (var index in shadows) {\n            var shadowNode = shadows[index]\n            var originNode = shadowNode.originNode\n            if (this.helper.isTwoPositionSimilarEqual(cc.v2(shadowNode.x,shadowNode.y),cc.v2(originNode.x, originNode.y)) == true) {\n                continue\n            }\n            \n            var bulletMgr = originNode.getComponent(\"bulletMgr\")\n            bulletMgr.targetPosition = cc.v2(shadowNode.x, shadowNode.y)\n            bulletMgr.movingDirection = direction\n            \n            bulletMgr.movingDirection.normalizeSelf()\n            if (bulletMgr.movingTime != null) {\n                var dis = cc.v2(bulletMgr.targetPosition.x - originNode.x, bulletMgr.targetPosition.y - originNode.y).mag()\n                var v = dis / bulletMgr.movingTime\n\n                bulletMgr.vx = v * bulletMgr.movingDirection.x\n                bulletMgr.vy = v * bulletMgr.movingDirection.y\n            }\n            else {\n                bulletMgr.vx = bulletMgr.movingDirection.x * bulletMgr.movingSpeed\n                bulletMgr.vy = bulletMgr.movingDirection.y * bulletMgr.movingSpeed\n            }\n            bulletMgr.status = 1\n            if (this.isMoved != true) {\n                this.isMoved = true\n            }\n            if (willAddStepNum == false) {\n                willAddStepNum = true\n            }\n        }\n        if (willAddStepNum == true) {\n            this.currentStepNum += 1\n            if (this.soundEffect != null) {\n                this.scheduleOnce(function(){\n                    cc.audioEngine.play(this.soundEffect)\n                },0.3)\n            }\n        }\n    },\n\n    onSuccess() {\n        this.retryButton.getComponent(cc.Button).interactable = false\n        // if (this.level != this.playerData.currentLevel) {\n        //     // cc.director.loadScene(\"mainScene\")\n        //     require(\"gameMgr\").animatedToScene(\"mainScene\")\n        //     return\n        // }\n\n        var levels = require(\"sectionConfig\")[this.playerData.currentSection].levels\n        var index = levels.indexOf(this.playerData.currentLevel)\n        var newLevel = null\n        var newSection = null\n        var commitBody = null\n        if (index < levels.length -1) {\n            index += 1\n            newLevel = levels[index]\n        }\n        else {\n            newSection = this.playerData.currentSection + 1\n            var newLevels = require(\"sectionConfig\")[newSection].levels\n            newLevel = newLevels[0]\n        }\n        \n        if (newSection == null) {\n            commitBody = {\n                currentLevel: newLevel, \n            } \n        }\n        else {\n            commitBody = {\n                currentSection: newSection,\n                currentLevel: newLevel,   \n            }\n        }\n\n        if (this.level == require(\"dataMgr\").playerData.currentLevel) {\n            commitBody.physicalPowerCostedFlag = 0\n        }\n        if (require(\"dataMgr\").playerData.isGuilded == 0) {\n            commitBody.isGuilded = 1\n        }\n        var minStepKey = \"minStep_level_\" + this.level.toString()\n        var minStepNum = require(\"dataMgr\").playerData.minSteps[minStepKey]\n\n        if (minStepNum == null || minStepNum == undefined || this.currentStepNum < minStepNum) {\n            commitBody.minSteps = {}\n            commitBody.minSteps[minStepKey] = this.currentStepNum\n        }\n        commitBody.preLevel = this.level\n        var self = this\n        var successCallBack = function(){\n            if (newSection != null) {\n                self.playerData.currentSection = newSection\n            }\n            if (commitBody.minSteps != null && commitBody.minSteps != undefined) {\n                require(\"dataMgr\").playerData.minSteps[minStepKey] = self.currentStepNum\n            }\n            if (commitBody.isGuilded == 1) {\n                require(\"dataMgr\").playerData.isGuilded = 1\n            }\n            self.playerData.currentLevel = newLevel\n            self.playerData.physicalPowerCostedFlag = 0\n            self.playerData.preLevel = self.level\n            require(\"gameMgr\").animatedToScene(\"mainScene\")\n        }\n        \n\n        require(\"dataMgr\").commitPlayerDataToServer(commitBody,successCallBack)\n        \n    },\n\n    resolveShadows(shadows,direction) {\n        for (var index in shadows) {\n            var oneShadow = shadows[index]\n            for (var i in shadows) {\n                var anotherShadow = shadows[i]\n                if (oneShadow == anotherShadow) {\n                    continue\n                }\n\n                var testResult = this._selectStaticShadowAndShaodwForResolved(oneShadow,anotherShadow,direction)\n                if (testResult != false) {\n                    var staticShadow = testResult.staticShadow\n                    var tempShadow = testResult.shadowForResolved\n                    // cc.log(\"static: \" + staticShadow.originNode.name, \"temp: \" + tempShadow.originNode.name)\n                    var staticBorderLines = this.helper.getLinesOfOneNode(staticShadow)\n                    var staticLine = null\n                    var ray = this.helper.makeRay(cc.v2(staticShadow.x,staticShadow.y),1000,cc.v2(-direction.x,-direction.y))\n\n                    for(var k in staticBorderLines) {\n                        var line = staticBorderLines[k]\n                        var dis = this.helper.rayTest(ray,line)\n                        if (dis != false) {\n                            staticLine = line\n                            break\n                        }\n                    }\n                    var newPoint2 = this.helper.makeRay(staticLine.p2,1000,cc.v2(staticLine.p2.x - staticLine.p1.x, staticLine.p2.y - staticLine.p1.y)).p2\n                    var newPoint1 = this.helper.makeRay(staticLine.p1,1000,cc.v2(staticLine.p1.x - staticLine.p2.x, staticLine.p1.y - staticLine.p2.y)).p2\n                    staticLine = {\n                        p1: newPoint1,\n                        p2: newPoint2\n                    }\n                    var ray1 = this.helper.makeRay(tempShadow.originNode.position,3000,direction)\n                    var currentDistance = this.helper.rayTest(ray1,staticLine)\n                    var targetDis = this.helper.getDisToSelfBorder(tempShadow.originNode,direction) + tempShadow.originNode.getComponent(\"bulletMgr\").disFromBorder\n                    var suitablePosition = this.helper.getSuitablePoint(tempShadow.originNode.position,currentDistance,targetDis,direction)\n                    var updatedDis = cc.v2(suitablePosition.x - tempShadow.originNode.x, suitablePosition.y - tempShadow.originNode.y).mag()\n                    tempShadow.x = suitablePosition.x\n                    tempShadow.y = suitablePosition.y\n                    tempShadow.dis = updatedDis\n                    return false\n                }\n\n            }\n        }\n        return true\n    },\n    _selectStaticShadowAndShaodwForResolved(shadow1, shadow2, direction) {\n\n        var self = this\n        var temp = function(s1, s2) {\n            var dis = s1.dis\n            var originCrossFlag = false\n            var shadowCrossFlag = false\n\n            var originLines = self.helper.getLinesOfOneNode(s2)\n            for (var key in originLines) {\n                var oneLine = originLines[key]\n                if (self.helper.isOneNodeWillCollidWithOneLineInDirection(s1.originNode,oneLine,direction,dis) != false) {\n                    originCrossFlag = true\n                    break\n                }\n            }\n\n            if (originCrossFlag == false) {\n                return false\n            }\n\n            var shadowLines = self.helper.getLinesOfOneNode(s2.originNode)\n            for (var key in shadowLines) {\n                var oneLine = shadowLines[key]\n                if (self.helper.isOneNodeWillCollidWithOneLineInDirection(s1.originNode,oneLine,direction,dis) != false) {\n                    shadowCrossFlag = true\n                    break\n                }\n            }\n\n            if (shadowCrossFlag == false) {\n                return false\n            }\n\n            return true\n        }\n\n        if (temp(shadow1,shadow2) == true) {\n            var result = {\n                staticShadow: shadow2,\n                shadowForResolved: shadow1\n            }\n            return result\n        }\n\n        if (temp(shadow2,shadow1) == true) {\n            var result = {\n                staticShadow: shadow1,\n                shadowForResolved: shadow2\n            }\n            return result\n        }\n\n        \n        return false\n    },\n\n    generateWalls() {\n        var levelConfig = require(\"levelConfig\")\n        var currentLevel = this.level\n\n        var config = levelConfig[currentLevel]\n        var wallsNode = cc.find(\"Canvas/walls\")\n        for (var index in config.wallPathes) {\n            var onePath = config.wallPathes[index]\n\n            var points = onePath.points\n            var realPoints = []\n            for (var i in points) {\n                var realPoint = null\n                if (i == 0) {\n                    realPoint = cc.v2(points[i].x, points[i].y)\n                }\n                else {\n                    var currentPoint = points[i]\n                    realPoint = cc.v2(realPoints[i - 1].x + currentPoint.x, realPoints[i - 1].y + currentPoint.y)\n                }\n                \n                realPoints.push(realPoint)\n            }\n            var lineWidth = onePath.lineWidth\n            var offset = onePath.offset\n            var wallNodes = []\n            var isClosed = onePath.isClosed\n            if (isClosed == true) {\n                var startPoint = realPoints[0]\n                realPoints.push(startPoint)\n            }\n            for (var i in realPoints) {\n                if (i == 0) {\n                    continue\n                }\n                \n                var node = cc.instantiate(this.linePrefab)\n                node.height = lineWidth\n                var directedLine = cc.v2(realPoints[i].x - realPoints[i - 1].x, realPoints[i].y - realPoints[i - 1].y)\n                node.width = directedLine.mag()\n    \n                var degree = directedLine.signAngle(cc.v2(1,0)) / Math.PI * 180\n                node.angle = -degree\n                node.x = realPoints[i].x - directedLine.x / 2\n                node.y = realPoints[i].y - directedLine.y / 2\n                var offsetDirection = directedLine.rotate(Math.PI / 2)\n                offsetDirection.normalizeSelf()\n                node.x += node.height / 2 * offsetDirection.x\n                node.y += node.height / 2 * offsetDirection.y\n\n                node.x += offset.x\n                node.y += offset.y\n                wallNodes.push(node)\n                wallsNode.addChild(node)                \n            }\n        }\n\n        var bulletConfig = config.bullets\n        var bulletsNode = cc.find(\"Canvas/bullets\")\n        for (var index in bulletConfig) {\n            var con = bulletConfig[index]\n            var bullet = cc.instantiate(this.bulletPrefab)\n            bullet.x = con.x\n            bullet.y = con.y\n            bullet.width = bullet.width * con.scale\n            bullet.height = bullet.height * con.scale\n            bulletsNode.addChild(bullet)\n        } \n    },\n\n\n    onClickRetryButton() {\n        var gameMgr = require(\"gameMgr\")\n        if (this.heartForRetryCost == 0) {\n            gameMgr.enterLevelScene(this.level)\n            return\n        }\n        var temp = this.playerData.heart - this.heartForRetryCost\n        if (temp < 0) {\n            return\n        }\n\n        var commitBody = {\n            heart: temp\n        }\n        var self = this\n        var successCallBack = function() {\n            self.playerData.heart = temp\n            // self.heart = temp\n            gameMgr.enterLevelScene(self.level)\n        }\n        this.retryButton.getComponent(cc.Button).interactable = false\n        require(\"dataMgr\").commitPlayerDataToServer(commitBody,successCallBack)\n    },\n    onAllRetryFailed() {\n        this.retryButton.getComponent(cc.Button).interactable = true\n    },\n\n    onClickBackButton() {\n        // cc.director.loadScene(\"mainScene\")\n        require(\"gameMgr\").animatedToScene(\"mainScene\")\n    },\n\n    setupNodesByConfig() {\n        var wallPrefab = require(\"resMgr\").reses[\"wallPrefab\"]\n        var bulletPrefab = require(\"resMgr\").reses[\"bulletPrefab\"]\n        var targetPrefab = require(\"resMgr\").reses[\"targetPrefab\"]\n        var pathWayPrefab = require(\"resMgr\").reses[\"pathWayPrefab\"]\n        var levelSceneConfig = require(\"levelSceneConfig\")[this.level]\n\n        this._setupFillNodes(levelSceneConfig)\n        this._setupWalls(levelSceneConfig,wallPrefab)\n        this._setupTargets(levelSceneConfig,targetPrefab)\n        this._setupPathWaysNode(levelSceneConfig,pathWayPrefab)\n        this._setupBullets(levelSceneConfig,bulletPrefab)\n    },\n    _setupNodePropertyByConfig(givenNode, givenConfig) {\n        for (var key in givenConfig) {\n            givenNode[key] = givenConfig[key]\n        }\n    },\n    _setupFillNodes(levelSceneConfig) {\n        var fillNodesConfig = levelSceneConfig.fillNodes\n        var fillNodes = cc.find(\"Canvas/fillNodes\")\n        for(var index in fillNodesConfig) {\n            var oneNodeConfig = fillNodesConfig[index]\n            var oneNode = new cc.Node()\n            this._setupNodePropertyByConfig(oneNode,oneNodeConfig)\n            fillNodes.addChild(oneNode)\n        }\n    },\n\n    _setupWalls(levelSceneConfig,wallPrefab) {\n        var wallsConfig = levelSceneConfig.walls\n        var walls = cc.find(\"Canvas/walls\")\n        for(var index in wallsConfig) {\n            var oneWallConfig = wallsConfig[index]\n            var oneWallNode = cc.instantiate(wallPrefab)\n            this._setupNodePropertyByConfig(oneWallNode,oneWallConfig)\n            walls.addChild(oneWallNode)\n        }\n    },\n\n    _setupTargets(levelSceneConfig, targetPrefab) {\n        var targetsConfig = levelSceneConfig.targets\n        var targets = cc.find(\"Canvas/targets\") \n        for (var index in targetsConfig) {\n            var oneTargetConfig = targetsConfig[index]\n            var oneTargetNode = cc.instantiate(targetPrefab)\n            this._setupNodePropertyByConfig(oneTargetNode,oneTargetConfig)\n            targets.addChild(oneTargetNode)\n        }\n    },\n    \n    _setupPathWaysNode(levelSceneConfig,pathWayPrefab) {\n        var pathWaysConfig = levelSceneConfig.pathWaysNode\n        var pathWaysNode = cc.find(\"Canvas/pathWaysNode\")\n        for (var index in pathWaysConfig) {\n            var onePathWayConfig = pathWaysConfig[index]\n            var onePathWayNode = new cc.Node(onePathWayConfig.name)\n            for (var index in onePathWayConfig.children){\n                var oneChildConfig = onePathWayConfig.children[index]\n                var oneChildNode = cc.instantiate(pathWayPrefab)\n                this._setupNodePropertyByConfig(oneChildNode,oneChildConfig)\n                onePathWayNode.addChild(oneChildNode)\n            }\n            pathWaysNode.addChild(onePathWayNode)\n        }\n    },\n\n    _setupBullets(levelSceneConfig, bulletPrefab) {\n        var bulletsConfig = levelSceneConfig.bullets\n        var bullets = cc.find(\"Canvas/bullets\")\n        for (var index in bulletsConfig) {\n            var oneBulletConfig = bulletsConfig[index]\n            var oneBulletNode = cc.instantiate(bulletPrefab)\n            \n            var basicConfig = oneBulletConfig.basic\n            //this._setupNodePropertyByConfig(oneBulletNode,basicConfig)\n            var mgrConfig = oneBulletConfig.mgr\n            var bulletMgr = oneBulletNode.getComponent(\"bulletMgr\")\n            bulletMgr.bulletType = mgrConfig.bulletType\n            if (mgrConfig.bulletType == 2) {\n                oneBulletNode.getComponent(cc.Sprite).spriteFrame = bulletMgr.sliderFrame\n            }\n            this._setupNodePropertyByConfig(oneBulletNode,basicConfig)\n            if (bulletMgr.bulletType == 2) {\n                if (mgrConfig.pathWaysNodeName != \"\" && mgrConfig.pathWaysNodeName != null) {\n                    var pathWaysNodePath = \"Canvas/pathWaysNode/\" + mgrConfig.pathWaysNodeName\n                    var pathWaysNode = cc.find(pathWaysNodePath)\n                    bulletMgr.pathWaysNode = pathWaysNode\n                }\n            }\n\n            bullets.addChild(oneBulletNode)\n        }\n    },\n\n\n    dataMonitored(key,value) {\n        if (key.indexOf(\"minStep_level_\") != -1) {\n            //typically one key is \"minStep_level_1\"\n            var levelId = key.slice(14)\n            if (parseInt(levelId) == parseInt(this.level)) {\n                var minStepNumLabel = this.node.getChildByName(\"uiNode\").getChildByName(\"minStepNumLabel\")\n                //minStepNumLabel.getComponent(cc.Label).string = \"最小步数：\" + value.toString()\n                minStepNumLabel.getComponent(cc.Label).string = require(\"textConfig\").getFormatedString(153,[value.toString()])\n            }\n        }\n\n        else if (key == \"heart\") {\n            this.heart = value\n        }\n    }\n\n});\n\n"]}