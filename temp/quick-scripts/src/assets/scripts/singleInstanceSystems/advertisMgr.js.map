{"version":3,"sources":["assets/scripts/singleInstanceSystems/advertisMgr.js"],"names":["AdvertisMgr","cc","Class","Component","properties","videoAd","delegate","wechatAdId","onVideoAdEnd","onVideoAdNotEnd","defaultNoti","notificationSys","require","showNoti","onVideoAdLoadError","err","console","log","onVideoAdShowError","initAds","sys","platform","WECHAT_GAME","self","wx","createRewardedVideoAd","adUnitId","onLoad","onError","onClose","res","isEnded","os","OS_IOS","OS_ANDROID","sdkbox","PluginAdMob","setListener","adViewDidReceiveAd","name","adViewDidFailToReceiveAdWithError","msg","adViewWillPresentScreen","adViewDidDismissScreen","adViewWillDismissScreen","adViewWillLeaveApplication","init","cache","showVideoAd","load","then","show","sharedAdvertisMgr","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar AdvertisMgr = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        videoAd: null,\n        delegate: null,\n\n        wechatAdId: \"xxxxx\",\n    },\n\n    onVideoAdEnd() {\n        if (this.delegate != null && typeof this.delegate.onVideoAdEnd == \"function\") {\n            this.delegate.onVideoAdEnd()\n        }\n    },\n    onVideoAdNotEnd(defaultNoti = true){\n        if (defaultNoti == true) {\n            var notificationSys = require(\"notificationMgr\")\n            notificationSys.showNoti(\"看完视频才能获得奖励哦~\")\n        }\n        if (this.delegate != null && typeof this.delegate.onVideoAdNotEnd == \"function\") {\n            this.delegate.onVideoAdNotEnd()\n        }\n    },\n    onVideoAdLoadError(err){\n        console.log(\"拉取广告失败\")\n        if (this.delegate != null && typeof this.delegate.onVideoAdLoadError == \"function\") {\n            this.delegate.onVideoAdLoadError(err)\n        }\n    },\n    onVideoAdShowError(err) {\n        if (this.delegate != null && typeof this.delegate.onVideoAdShowError == \"function\") {\n            this.delegate.onVideoAdShowError(err)\n        }\n    },\n    initAds(){\n        if (this.videoAd == null) {\n            if (cc.sys.platform == cc.sys.WECHAT_GAME) {\n                var self = this\n                this.videoAd = wx.createRewardedVideoAd({adUnitId: this.wechatAdId})\n                this.videoAd.onLoad(function(){\n                    console.log(\"拉取广告成功\")\n                })\n                this.videoAd.onError(function(err){\n                    self.onVideoAdLoadError(err)\n                })\n                this.videoAd.onClose(function(res){\n                    if (res && res.isEnded) {\n                        self.onVideoAdEnd()\n                    }\n                    else {\n                        self.onVideoAdNotEnd()\n                    }\n                })\n            }\n\n            else if (cc.sys.os == cc.sys.OS_IOS || cc.sys.os == cc.sys.OS_ANDROID) {\n                var self = this\n                cc.log(\"init\")\n                sdkbox.PluginAdMob.setListener({\n                    adViewDidReceiveAd: function(name){\n                        cc.log(\"receivedAd\")\n                    },\n\n                    adViewDidFailToReceiveAdWithError: function(name,msg){\n                        cc.log(\"didFailToReciveAd \", msg)\n                    },\n\n                    adViewWillPresentScreen: function(name) {\n                        cc.log(\"willPresentScreen\")\n                    },\n\n                    adViewDidDismissScreen: function(name) {\n                        cc.log(\"didDismissScreen\")\n                    },\n\n                    adViewWillDismissScreen: function(name) {\n                        cc.log(\"willDissmissScreen\")\n                    },\n\n                    adViewWillLeaveApplication: function(name) {\n                        cc.log(\"willLeaveApp\")\n                    }\n                })\n\n                sdkbox.PluginAdMob.init()\n\n                this.videoAd = sdkbox.PluginAdMob.cache(\"rewarded\")\n            }\n        }\n    },\n    showVideoAd() {\n\n        if (cc.sys.platform == cc.sys.WECHAT_GAME) {\n            var self = this\n            this.videoAd.load()\n            .then(function(){\n                self.videoAd.show()\n            })\n            .catch(function(err){\n                self.onVideoAdShowError(err)\n            })\n        }\n\n        else if (cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.OS_IOS) {\n            sdkbox.PluginAdMob.show(\"rewarded\")\n        }\n    }\n});\n\nvar sharedAdvertisMgr = new AdvertisMgr()\nsharedAdvertisMgr.initAds()\nmodule.exports = sharedAdvertisMgr"]}