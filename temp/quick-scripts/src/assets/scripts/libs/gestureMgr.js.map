{"version":3,"sources":["assets/scripts/libs/gestureMgr.js"],"names":["cc","Class","Component","properties","isDragEnable","isZoomEnable","zoomSpeed","maxZoomRatio","minZoomRatio","dragSpeed","camaraNode","Node","minBoundX","maxBoundX","minBoundY","maxBoundY","touches","visible","onLoad","node","on","event","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","touchEvent","push","length","delta","getDelta","tempX","x","tempY","y","cama","getComponent","Camera","canvas","find","tempCamaX","tempCamaY","camaMaxBoundX","width","zoomRatio","camaMinBoundX","camaMaxBoundY","height","camaMinBoundY","firstTouch","seceondTouch","firstTouchLocation","getLocation","seceondTouchLocation","distance","distanceOfTwoVector","preFirstTouchLocation","getPreviousLocation","preSeceondTouchLocation","preDistance","disDelta","tempZoomRatio","deleteTouchEventFromTouchesArry","tempIndex","index","oneTouchEvent","getID","splice","a","b","Math","pow","sqrt"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE;AACRC,IAAAA,YAAY,EAAE,IADN;AAERC,IAAAA,YAAY,EAAE,IAFN;AAIRC,IAAAA,SAAS,EAAE,OAJH;AAKRC,IAAAA,YAAY,EAAE,GALN;AAMRC,IAAAA,YAAY,EAAE,GANN;AAQRC,IAAAA,SAAS,EAAE,CARH;AASRC,IAAAA,UAAU,EAAEV,EAAE,CAACW,IATP;AAURC,IAAAA,SAAS,EAAE,CAAC,GAVJ;AAWRC,IAAAA,SAAS,EAAE,GAXH;AAYRC,IAAAA,SAAS,EAAE,CAAC,GAZJ;AAaRC,IAAAA,SAAS,EAAE,GAbH;AAeR;AACAC,IAAAA,OAAO,EAAE;AACL,iBAAS,EADJ;AAELC,MAAAA,OAAO,EAAE;AAFJ;AAhBD,GAHP;AAyBL;AAEAC,EAAAA,MA3BK,oBA2BK;AACR,SAAKC,IAAL,CAAUC,EAAV,CAAa,YAAb,EAA0B,UAASC,KAAT,EAAe;AACrC,WAAKC,YAAL,CAAkBD,KAAlB;AACH,KAFD,EAEE,IAFF;AAGA,SAAKF,IAAL,CAAUC,EAAV,CAAa,WAAb,EAAyB,UAASC,KAAT,EAAe;AACpC,WAAKE,WAAL,CAAiBF,KAAjB;AACH,KAFD,EAEE,IAFF;AAGA,SAAKF,IAAL,CAAUC,EAAV,CAAa,UAAb,EAAwB,UAASC,KAAT,EAAe;AACnC,WAAKG,UAAL,CAAgBH,KAAhB;AACH,KAFD,EAEE,IAFF;AAGA,SAAKF,IAAL,CAAUC,EAAV,CAAa,aAAb,EAA2B,UAASC,KAAT,EAAe;AACtC,WAAKI,aAAL,CAAmBJ,KAAnB;AACH,KAFD,EAEE,IAFF;AAGD,GAxCI;AA0CL;AAEA;AAEA;AACAC,EAAAA,YA/CK,wBA+CQD,KA/CR,EA+Cc;AACf,QAAIK,UAAU,GAAGL,KAAjB;AACA,SAAKL,OAAL,CAAaW,IAAb,CAAkBD,UAAlB;AACH,GAlDI;AAmDLH,EAAAA,WAnDK,uBAmDOF,KAnDP,EAmDa;AACd,QAAI,KAAKjB,YAAL,IAAqB,IAArB,IAA6B,KAAKY,OAAL,CAAaY,MAAb,IAAuB,CAAxD,EAA2D;AACvD,UAAIC,KAAK,GAAGR,KAAK,CAACS,QAAN,EAAZ;AACA,UAAIC,KAAK,GAAGF,KAAK,CAACG,CAAN,GAAU,CAAC,CAAvB;AACA,UAAIC,KAAK,GAAGJ,KAAK,CAACK,CAAN,GAAU,CAAC,CAAvB;AAEAH,MAAAA,KAAK,GAAGA,KAAK,GAAG,KAAKtB,SAArB;AACAwB,MAAAA,KAAK,GAAGA,KAAK,GAAG,KAAKxB,SAArB;AAEA,UAAI0B,IAAI,GAAG,KAAKzB,UAAL,CAAgB0B,YAAhB,CAA6BpC,EAAE,CAACqC,MAAhC,CAAX;AACA,UAAIC,MAAM,GAAGtC,EAAE,CAACuC,IAAH,CAAQ,QAAR,CAAb;AAEA,UAAIC,SAAS,GAAG,KAAK9B,UAAL,CAAgBsB,CAAhB,GAAoBD,KAApC;AACA,UAAIU,SAAS,GAAG,KAAK/B,UAAL,CAAgBwB,CAAhB,GAAoBD,KAApC;AAEA,UAAIS,aAAa,GAAGF,SAAS,GAAIF,MAAM,CAACK,KAAP,GAAa,CAAd,IAAoB,IAAER,IAAI,CAACS,SAA3B,CAAhC;AACA,UAAIC,aAAa,GAAGL,SAAS,GAAIF,MAAM,CAACK,KAAP,GAAa,CAAd,IAAoB,IAAER,IAAI,CAACS,SAA3B,CAAhC;AACA,UAAIE,aAAa,GAAGL,SAAS,GAAIH,MAAM,CAACS,MAAP,GAAc,CAAf,IAAqB,IAAEZ,IAAI,CAACS,SAA5B,CAAhC;AACA,UAAII,aAAa,GAAGP,SAAS,GAAIH,MAAM,CAACS,MAAP,GAAc,CAAf,IAAqB,IAAEZ,IAAI,CAACS,SAA5B,CAAhC;;AAEA,UAAIF,aAAa,IAAI,KAAK7B,SAAtB,IAAmCgC,aAAa,IAAI,KAAKjC,SAA7D,EAAyE;AACrE,aAAKF,UAAL,CAAgBsB,CAAhB,GAAoBQ,SAApB;AACH;;AACD,UAAIM,aAAa,IAAI,KAAK/B,SAAtB,IAAmCiC,aAAa,IAAI,KAAKlC,SAA7D,EAAwE;AACpE,aAAKJ,UAAL,CAAgBwB,CAAhB,GAAoBO,SAApB;AACH;AACJ;;AAED,QAAG,KAAKpC,YAAL,IAAqB,IAArB,IAA6B,KAAKW,OAAL,CAAaY,MAAb,IAAuB,CAAvD,EAA0D;AACtD,UAAIqB,UAAU,GAAG,KAAKjC,OAAL,CAAa,CAAb,CAAjB;AACA,UAAIkC,YAAY,GAAG,KAAKlC,OAAL,CAAa,CAAb,CAAnB;AACA,UAAImC,kBAAkB,GAAGF,UAAU,CAACG,WAAX,EAAzB;AACA,UAAIC,oBAAoB,GAAGH,YAAY,CAACE,WAAb,EAA3B;AAEA,UAAIE,QAAQ,GAAG,KAAKC,mBAAL,CAAyBJ,kBAAzB,EAA4CE,oBAA5C,CAAf;AAEA,UAAIG,qBAAqB,GAAGP,UAAU,CAACQ,mBAAX,EAA5B;AACA,UAAIC,uBAAuB,GAAGR,YAAY,CAACO,mBAAb,EAA9B;AACA,UAAIE,WAAW,GAAG,KAAKJ,mBAAL,CAAyBC,qBAAzB,EAA+CE,uBAA/C,CAAlB;AAEA,UAAIE,QAAQ,GAAGN,QAAQ,GAAGK,WAA1B;AAEA,UAAIxB,IAAI,GAAG,KAAKzB,UAAL,CAAgB0B,YAAhB,CAA6BpC,EAAE,CAACqC,MAAhC,CAAX;AACA,UAAIwB,aAAa,GAAG1B,IAAI,CAACS,SAAL,GAAiB,KAAKA,SAAL,GAAiBgB,QAAtD;;AAEA,UAAIC,aAAa,IAAIrD,YAAjB,IAAiCqD,aAAa,IAAItD,YAAtD,EAAoE;AAChE4B,QAAAA,IAAI,CAACS,SAAL,GAAiBiB,aAAjB;AACH;AACJ;AACJ,GApGI;AAqGLrC,EAAAA,UArGK,sBAqGMH,KArGN,EAqGa;AACd,SAAKyC,+BAAL,CAAqCzC,KAArC;AACH,GAvGI;AAwGLI,EAAAA,aAxGK,yBAwGSJ,KAxGT,EAwGe;AAChB,SAAKyC,+BAAL,CAAqCzC,KAArC;AACH,GA1GI;AA2GLyC,EAAAA,+BA3GK,2CA2G2BzC,KA3G3B,EA2GkC;AACnC,QAAI0C,SAAS,GAAG,IAAhB;;AACA,SAAK,IAAIC,KAAT,IAAkB,KAAKhD,OAAvB,EAAgC;AAC5B,UAAIiD,aAAa,GAAG,KAAKjD,OAAL,CAAagD,KAAb,CAApB;;AACA,UAAIC,aAAa,CAACC,KAAd,MAAyB7C,KAAK,CAAC6C,KAAN,EAA7B,EAA4C;AACxCH,QAAAA,SAAS,GAAGC,KAAZ;AACA;AACH;AACJ;;AACD,QAAID,SAAS,IAAI,IAAjB,EAAuB;AACnB,WAAK/C,OAAL,CAAamD,MAAb,CAAoBH,KAApB,EAA0B,CAA1B;AACH;AACJ,GAvHI;AAwHLT,EAAAA,mBAxHK,+BAwHea,CAxHf,EAwHiBC,CAxHjB,EAwHoB;AACrB,QAAIf,QAAQ,GAAGgB,IAAI,CAACC,GAAL,CAAUF,CAAC,CAACrC,CAAF,GAAMoC,CAAC,CAACpC,CAAlB,EAAqB,CAArB,IAA0BsC,IAAI,CAACC,GAAL,CAAUF,CAAC,CAACnC,CAAF,GAAMkC,CAAC,CAAClC,CAAlB,EAAqB,CAArB,CAAzC;AACAoB,IAAAA,QAAQ,GAAGgB,IAAI,CAACE,IAAL,CAAUlB,QAAV,CAAX;AACA,WAAOA,QAAP;AACH;AA5HI,CAAT","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        isDragEnable: true,\n        isZoomEnable: true,\n\n        zoomSpeed: 0.00333,\n        maxZoomRatio: 1.2,\n        minZoomRatio: 0.3,\n\n        dragSpeed: 1,\n        camaraNode: cc.Node,\n        minBoundX: -960,\n        maxBoundX: 960,\n        minBoundY: -640,\n        maxBoundY: 640,\n\n        //logic properties\n        touches: {\n            default: [],\n            visible: false\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n      this.node.on(\"touchstart\",function(event){\n          this.onTouchStart(event)\n      },this)  \n      this.node.on(\"touchmove\",function(event){\n          this.onTouchMove(event)\n      },this) \n      this.node.on(\"touchend\",function(event){\n          this.onTouchEnd(event)\n      },this) \n      this.node.on(\"touchcancel\",function(event){\n          this.onTouchCancel(event)\n      },this) \n    },\n\n    // start () {\n\n    // },\n\n    // update (dt) {},\n    onTouchStart(event){\n        var touchEvent = event\n        this.touches.push(touchEvent)\n    },\n    onTouchMove(event){\n        if (this.isDragEnable == true && this.touches.length == 1) {\n            var delta = event.getDelta()\n            var tempX = delta.x * -1\n            var tempY = delta.y * -1\n    \n            tempX = tempX * this.dragSpeed\n            tempY = tempY * this.dragSpeed\n    \n            var cama = this.camaraNode.getComponent(cc.Camera)\n            var canvas = cc.find(\"Canvas\")\n    \n            var tempCamaX = this.camaraNode.x + tempX\n            var tempCamaY = this.camaraNode.y + tempY\n    \n            var camaMaxBoundX = tempCamaX + (canvas.width/2) * (1/cama.zoomRatio)\n            var camaMinBoundX = tempCamaX - (canvas.width/2) * (1/cama.zoomRatio)\n            var camaMaxBoundY = tempCamaY + (canvas.height/2) * (1/cama.zoomRatio)\n            var camaMinBoundY = tempCamaY - (canvas.height/2) * (1/cama.zoomRatio)\n            \n            if (camaMaxBoundX <= this.maxBoundX && camaMinBoundX >= this.minBoundX ) {\n                this.camaraNode.x = tempCamaX\n            }\n            if (camaMaxBoundY <= this.maxBoundY && camaMinBoundY >= this.minBoundY) {\n                this.camaraNode.y = tempCamaY\n            }\n        }\n\n        if(this.isZoomEnable == true && this.touches.length == 2) {\n            var firstTouch = this.touches[0]\n            var seceondTouch = this.touches[1]\n            var firstTouchLocation = firstTouch.getLocation()\n            var seceondTouchLocation = seceondTouch.getLocation()\n\n            var distance = this.distanceOfTwoVector(firstTouchLocation,seceondTouchLocation)\n            \n            var preFirstTouchLocation = firstTouch.getPreviousLocation()\n            var preSeceondTouchLocation = seceondTouch.getPreviousLocation()\n            var preDistance = this.distanceOfTwoVector(preFirstTouchLocation,preSeceondTouchLocation)\n\n            var disDelta = distance - preDistance\n\n            var cama = this.camaraNode.getComponent(cc.Camera)\n            var tempZoomRatio = cama.zoomRatio + this.zoomRatio * disDelta\n            \n            if (tempZoomRatio >= minZoomRatio && tempZoomRatio <= maxZoomRatio) {\n                cama.zoomRatio = tempZoomRatio\n            }\n        }\n    },\n    onTouchEnd(event) {\n        this.deleteTouchEventFromTouchesArry(event)\n    },\n    onTouchCancel(event){\n        this.deleteTouchEventFromTouchesArry(event)\n    },\n    deleteTouchEventFromTouchesArry(event) {\n        var tempIndex = null\n        for (var index in this.touches) {\n            var oneTouchEvent = this.touches[index]\n            if (oneTouchEvent.getID() == event.getID()) {\n                tempIndex = index\n                break\n            }\n        }\n        if (tempIndex != null) {\n            this.touches.splice(index,1)\n        }\n    },\n    distanceOfTwoVector(a,b) {\n        var distance = Math.pow((b.x - a.x),2) + Math.pow((b.y - a.y),2)\n        distance = Math.sqrt(distance)\n        return distance\n    }\n});\n"]}