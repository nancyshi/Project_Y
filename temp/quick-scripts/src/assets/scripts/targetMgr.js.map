{"version":3,"sources":["assets/scripts/targetMgr.js"],"names":["cc","Class","Component","properties","fatalTolerance","bullets","flag","helper","onLoad","Helper","require","start","find","getComponent","update","dt","index","bullet","bulletMgr","bulletType","status","checkWhetherSatisfied","onSatisfy","givenBulletNode","points","getPointsOfOneNode","node","bulletPoints","key","point","bulletCorrespondPoint","dis","v2","x","y","mag","givenBullet","self","tween","to","opacity","call","destroy","targetsNum","onDestroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        fatalTolerance: 0.01,\n        bullets: null,\n        flag: false,\n        helper: null\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var Helper = require(\"helper\")\n        this.helper = new Helper()\n    },\n\n    start () {\n        this.bullets = cc.find(\"Canvas\").getComponent(\"levelMgr\").bullets\n    },\n\n    update (dt) {\n        if (this.flag == true) {\n            return\n        }\n        for (var index in this.bullets) {\n            var bullet = this.bullets[index]\n            var bulletMgr = bullet.getComponent(\"bulletMgr\")\n            \n            if (bulletMgr.bulletType != 1) {\n                continue\n            }\n            if (bulletMgr.status != 0) {\n                continue\n            }\n            if (this.checkWhetherSatisfied(bullet) == true) {\n                this.onSatisfy(bullet)\n                break\n            }\n        }\n    },\n\n    checkWhetherSatisfied(givenBulletNode) {\n        var points = this.helper.getPointsOfOneNode(this.node)\n        var bulletPoints = this.helper.getPointsOfOneNode(givenBulletNode)\n\n        for (var key in points) {\n            var point = points[key]\n            var bulletCorrespondPoint = bulletPoints[key]\n            var dis = cc.v2(bulletCorrespondPoint.x - point.x, bulletCorrespondPoint.y - point.y).mag()\n            if (dis > this.fatalTolerance) {\n                return false\n            }\n        }\n\n        return true\n    },\n\n    onSatisfy(givenBullet) {\n        this.flag = true\n        givenBullet.getComponent(\"bulletMgr\").status = 2\n        var self = this\n        cc.tween(givenBullet)\n            .to(0.2,{opacity:0})\n            .call(function(){\n                givenBullet.destroy()\n            })\n            .start()\n        cc.tween(this.node)\n            .to(0.2,{opacity: 0})\n            .call(function(){\n                self.node.destroy()\n                cc.find(\"Canvas\").getComponent(\"levelMgr\").targetsNum -= 1\n            })\n            .start()\n    },\n\n    onDestroy() {\n\n    }\n});\n"]}