{"version":3,"sources":["assets/scripts/loginSceneMgr.js"],"names":["cc","Class","Component","properties","dataMgr","loginMgr","networkMgr","isLogining","changeSceneAnimationTime","nameEnSpriteFrame","SpriteFrame","onLoad","node","on","onTouchStart","textConfig","require","languageType","getChildByName","getComponent","Sprite","spriteFrame","start","delegate","retryNode","find","tween","repeatForever","to","scale","login","onPlayerDataUpdated","initAds","Label","string","getTextByIdAndLanguageType","index","children","self","temp","i","opacity","delay","call","loadReses","startHeartBeat","director","loadScene","active","loginType","platform","sys","WECHAT_GAME","LoginType","WE_CHAT_GAME","DEVICE_ID","event","_debugLogin","playerData","id","name","physicalPower","maxPhysicalPower","heart","maxHeart","currentSection","currentLevel","physicalPowerCostedFlag","onDestroy","off","onAllRetryFailed","loginInfo","loginInfoLabel"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        dataMgr: null,\n        loginMgr: null,\n        networkMgr: null,\n        isLogining: false,\n        changeSceneAnimationTime: 2,\n        nameEnSpriteFrame: cc.SpriteFrame,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.node.on(\"touchstart\",this.onTouchStart,this)\n        var textConfig = require(\"textConfig\")\n        if (textConfig.languageType != 1) {\n            this.node.getChildByName(\"name\").getComponent(cc.Sprite).spriteFrame = this.nameEnSpriteFrame\n        }\n    },\n\n    start () {\n        this.dataMgr = require(\"dataMgr\")\n        this.loginMgr = require(\"loginMgr\")\n        this.networkMgr = require(\"networkMgr\")\n        this.networkMgr.delegate = this\n        var retryNode = cc.find(\"Canvas/retry\")\n        cc.tween(retryNode)\n            .repeatForever(\n                cc.tween()\n                    .to(0.5,{scale: 1.2})\n                    .to(0.5,{scale: 0.8})\n            )\n            .start()\n\n        this.login()\n        //this._debugLogin()\n    },\n\n    onPlayerDataUpdated() {\n        require(\"advertisMgr\").initAds()\n        cc.find(\"Canvas/loginInfo/textNode\").getComponent(cc.Label).string = require(\"textConfig\").getTextByIdAndLanguageType(157)\n        //animation \n        for (var index in this.node.children) {\n            var self = this\n\n            var temp = function(i) {\n                var node = self.node.children[i]\n                cc.tween(node)\n                    .to(self.changeSceneAnimationTime, {opacity: 0})\n                    .start()\n            }\n            temp(index)\n        }\n\n        cc.tween(this.node)\n            .delay(this.changeSceneAnimationTime)\n            .call(function(){\n                require(\"resMgr\").loadReses(function(){\n                    require(\"networkMgr\").startHeartBeat()\n                    cc.director.loadScene(\"mainScene\")\n                })\n            })\n            .start()\n    },\n\n    login() {\n        this.isLogining = true\n        var retryNode = cc.find(\"Canvas/retry\")\n        retryNode.active = false\n        cc.find(\"Canvas/loginInfo/textNode\").getComponent(cc.Label).string = require(\"textConfig\").getTextByIdAndLanguageType(156)\n\n        var loginType = null\n        var platform = cc.sys.platform\n        if (platform == cc.sys.WECHAT_GAME) {\n            loginType = this.loginMgr.LoginType.WE_CHAT_GAME\n        }\n        else {\n            loginType = this.loginMgr.LoginType.DEVICE_ID\n        }\n\n        this.loginMgr.login(loginType)\n    },\n\n    onTouchStart(event) {\n        if (this.isLogining == false) {\n            this.login()\n        }\n    },\n    // update (dt) {},\n\n    _debugLogin() {\n        this.dataMgr.playerData = {\n            id: 100000001,\n            name: \"new Player\",\n            physicalPower: 10,\n            maxPhysicalPower: 10,\n            heart: 10,\n            maxHeart: 10,\n            currentSection: 1,\n            currentLevel: 2,\n            physicalPowerCostedFlag: 0\n        }\n        this.onPlayerDataUpdated()\n    },\n\n    onDestroy() {\n        this.node.off(\"touchstart\",this.onTouchStart,this)\n    },\n    onAllRetryFailed() {\n        var loginInfo = cc.find(\"Canvas/loginInfo\")\n        var loginInfoLabel = loginInfo.getChildByName(\"textNode\").getComponent(cc.Label)\n        loginInfoLabel.string = \"连接服务器失败，请点击重试\"\n        loginInfo.active = true\n        var retryNode = cc.find(\"Canvas/retry\")\n        retryNode.active = true\n        this.isLogining = false\n    }\n    \n});\n"]}