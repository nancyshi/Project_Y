{"version":3,"sources":["assets/scripts/systems/signInSys/signInSysMgr.js"],"names":["cc","Class","Component","properties","ensureButtonNode","Node","cancelButtonNode","desLabelNode","Label","physicalPowerAddNum","heartAddNum","addRateForAd","sysName","start","setupData","setupUI","status","require","playerData","signInStatus","desStr","textConfig","getTextByIdAndLanguageType","getChildByName","getComponent","string","toString","active","x","log","config","onClickEnsureButton","advMgr","delegate","showVideoAd","closeSystem","onClickCancelButton","signIn","signInType","networkMgr","msgObj","makeMessageObj","message","playerId","id","self","successCallBack","xhr","response","responseText","JSON","parse","type","physicalPower","heart","onSignInSuccess","sendMessageByMsgObj","showNoti","onVideoAdEnd"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        ensureButtonNode: cc.Node,\n        cancelButtonNode: cc.Node,\n        desLabelNode: cc.Label,\n        physicalPowerAddNum: 0,\n        heartAddNum: 0,\n        addRateForAd: 0,\n        sysName: \"signInSys\"\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n        this.setupData()\n        this.setupUI()\n    },\n    setupUI() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        //1 = not sign in\n        //2 = common in\n        //3 = ad sign in\n        var desStr = \"\"\n        var textConfig = require(\"textConfig\")\n        switch(status) {\n            case 1:\n                desStr = textConfig.getTextByIdAndLanguageType(115) + this.physicalPowerAddNum + textConfig.getTextByIdAndLanguageType(116) + this.heartAddNum +\", \"\n                desStr = desStr + textConfig.getTextByIdAndLanguageType(117)\n                this.cancelButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(118)\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(113)\n                break\n            case 2:\n                desStr = textConfig.getTextByIdAndLanguageType(119) + ((this.addRateForAd - 1) * this.physicalPowerAddNum).toString()\n                desStr = desStr + textConfig.getTextByIdAndLanguageType(116) + ((this.addRateForAd - 1) * this.heartAddNum).toString()\n                desStr = desStr + textConfig.getTextByIdAndLanguageType(120)\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(113)\n                this.cancelButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(114)\n                break\n            case 3:\n                desStr = textConfig.getTextByIdAndLanguageType(121)\n                this.cancelButtonNode.active = false\n                this.ensureButtonNode.x = 0\n                this.ensureButtonNode.getChildByName(\"textLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(122)\n                break\n        }\n        if (desStr == \"\") {\n            cc.log(\"wrong signIn status\")\n            return\n        }\n\n        this.desLabelNode.getComponent(cc.Label).string = desStr\n\n    },\n\n    setupData() {\n        var config = require(\"signInSysConfig\")\n        this.physicalPowerAddNum = config.physicalPowerAddNum\n        this.heartAddNum = config.heartAddNum\n        this.addRateForAd = config.addRateForAd\n    },\n\n    onClickEnsureButton(){\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1:\n                var advMgr = require(\"advertisMgr\")\n                advMgr.delegate = this\n                advMgr.showVideoAd()\n                break\n            case 2:\n                var advMgr = require(\"advertisMgr\")\n                advMgr.delegate = this\n                advMgr.showVideoAd()\n                break\n            case 3:\n                require(\"systemsMgr\").closeSystem(this.sysName)\n                break\n        }\n    },\n\n    onClickCancelButton() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1: \n                this.signIn(1)\n                break\n            case 2:\n                require(\"systemsMgr\").closeSystem(this.sysName)\n                break\n            case 3:\n                // if status == 3, cancel button will not appear\n                cc.log(\"some wrong thing happen from onClickCancelButton\")\n                break\n        }\n    },\n\n    signIn(signInType) {\n        var networkMgr = require(\"networkMgr\")\n        var msgObj = networkMgr.makeMessageObj(\"signInModule\",\"signInMessageType\")\n        msgObj.message.signInType = signInType\n        msgObj.message.playerId = require(\"dataMgr\").playerData.id\n        var self = this\n        msgObj.successCallBack = function(xhr) {\n            var response = xhr.responseText\n            response = JSON.parse(response)\n            \n            if (response.type == \"success\") {\n                var physicalPower = response.physicalPower\n                var heart = response.heart\n                self.onSignInSuccess(signInType,physicalPower,heart)\n            }\n        }\n\n        networkMgr.sendMessageByMsgObj(msgObj)\n    },\n\n    onSignInSuccess(signInType,physicalPower,heart) {\n        switch(signInType){\n            case 1:\n                require(\"dataMgr\").playerData.signInStatus = 2\n                break\n            case 2:\n                require(\"dataMgr\").playerData.signInStatus = 3\n                break\n            case 3:\n                require(\"dataMgr\").playerData.signInStatus = 3\n                break\n        }\n\n        require(\"dataMgr\").playerData.physicalPower = physicalPower\n        require(\"dataMgr\").playerData.heart = heart\n        require(\"notificationMgr\").showNoti(\"签到成功\")\n        require(\"systemsMgr\").closeSystem(this.sysName)\n    },\n\n    //advertis delegate\n    onVideoAdEnd() {\n        var status = require(\"dataMgr\").playerData.signInStatus\n        switch(status) {\n            case 1:\n                this.signIn(2)\n                break\n            case 2:\n                this.signIn(3)\n                break\n        }\n    }\n    // update (dt) {},\n});\n"]}