{"version":3,"sources":["assets/scripts/systems/mailSys/mailSysMgr.js"],"names":["cc","Class","Component","properties","uibg","Node","closeButtonNode","tagSection","mailSection","notiSection","mailSectionContentNode","mailSectionEmptyLabelNode","mailSectionPrefab","Prefab","tagSectionPrefab","selectedTagEffectPrefab","opendMailPrefab","tags","mailsByTag","unReadedMailNums","selectedTag","get","_selectedTag","set","value","setupMailSection","setupNotiSection","selectedTagNode","_selectedTagNode","selectedTagEffect","parent","x","y","addChild","targetY","tween","to","start","_selectedTagEffect","effect","instantiate","tagSectionStartY","tagSectionDis","mailSectionStartPosition","v2","mailSectionNodeDis","mailSectionNodeReadedColor","_mailSectionNodeReadedColor","color","sysName","onLoad","self","on","require","closeSystem","setupData","setupUI","setupTagSection","textConfig","index","oneTag","tagName","tagNameTextId","getTextByIdAndLanguageType","node","getComponent","Label","string","_forceUpdateRenderData","bindFunction","givenNode","givenTag","redPointShowCondition","mails","playerData","unReadNum","key","oneMail","tag","status","name","tagMails","mailIdsArry","Object","keys","destroyAllChildren","length","active","height","sortFunction","mailId1","mailId2","mail1","mail2","timeStamp1","timeStamp","timeStamp2","sort","mailConfig","totalHeight","mailId","mail","unReadIconNode","getChildByName","readedIconNode","titleLabelNode","seperateLineNode","titleStr","titleTextId","nodeWidth","width","nodeHeight","toString","givenMailId","openOneMail","minHeight","unReadMailNum","str","mailConditionIndex","mailSysConfig","element","conditions","conditionType","level","conditionPara","result","_getSectionAndLevelNumOfSection","section","levelNumOfSection","getFormatedString","levelId","minStepNum","givenLevelId","sectionConfig","levels","indexOf","stauts","_insertOneMail","mgr","relatedMailSectionNode","relatedMailSysMgr","setOneMailReaded","indexOfOptions","complete","log","networkMgr","messageObj","makeMessageObj","message","playerId","id","selectedOptionIndex","successCallBack","xhr","response","responseText","JSON","parse","type","sendMessageByMsgObj","dataMonitored"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        uibg: cc.Node,\n        closeButtonNode: cc.Node,\n        tagSection: cc.Node,\n        mailSection: cc.Node,\n        notiSection: cc.Node,\n        mailSectionContentNode: cc.Node,\n        mailSectionEmptyLabelNode: cc.Node,\n\n        mailSectionPrefab: cc.Prefab,\n        tagSectionPrefab: cc.Prefab,\n        selectedTagEffectPrefab: cc.Prefab,\n        opendMailPrefab: cc.Prefab,\n        tags: null,\n        mailsByTag: {\n            default: {}\n        },\n\n        unReadedMailNums: {\n            default: {}\n        },\n\n        selectedTag: {\n            get() {\n                return this._selectedTag\n            }, \n            set(value) {\n                this._selectedTag = value\n                this.setupMailSection()\n                this.setupNotiSection()\n            }\n        },\n        selectedTagNode: {\n            get(){\n                return this._selectedTagNode\n            },\n            set(value) {\n                this._selectedTagNode = value\n                if (this.selectedTagEffect.parent == null) {\n                    this.selectedTagEffect.x = this.selectedTagNode.x\n                    this.selectedTagEffect.y = this.selectedTagNode.y\n                    this.tagSection.addChild(this.selectedTagEffect,0)\n                }\n                else {\n                    var targetY = this.selectedTagNode.y\n                    cc.tween(this.selectedTagEffect)\n                        .to(0.1,{y: targetY})\n                        .start()\n                }\n            }\n        },\n        selectedTagEffect: {\n            get() {\n                if (this._selectedTagEffect == null) {\n                    var effect = cc.instantiate(this.selectedTagEffectPrefab)\n                    this._selectedTagEffect = effect\n                }\n                return this._selectedTagEffect\n            },\n            set(value) {\n                this._selectedTagEffect = value\n            }\n        },\n        tagSectionStartY: -86.345,\n        tagSectionDis: 120,\n\n\n        mailSectionStartPosition: cc.v2(-125.788,373.356),\n        mailSectionNodeDis: 32,\n        mailSectionNodeReadedColor: {\n            get() {\n                if (this._mailSectionNodeReadedColor == null) {\n                    this._mailSectionNodeReadedColor = cc.color(102,102,102)\n                } \n                return this._mailSectionNodeReadedColor\n            },\n            set(value) {\n                this._mailSectionNodeReadedColor = value\n            }\n        },\n\n        sysName: \"mailSys\"\n        \n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var self = this\n        this.closeButtonNode.on(\"click\",function(){\n            require(\"systemsMgr\").closeSystem(self.sysName)\n        })\n        this.uibg.on(\"touchstart\",function(){})\n        this.setupData()\n        this.setupUI()\n    },\n\n    start () {\n\n    },\n\n    setupTagSection() {\n        var textConfig = require(\"textConfig\")\n        for (var index in this.tags) {\n            var oneTag = this.tags[index]\n            var tagName = require(\"mailSysConfig\")[oneTag].tagNameTextId\n            tagName = textConfig.getTextByIdAndLanguageType(tagName)\n            var node = cc.instantiate(this.tagSectionPrefab)\n            node.getComponent(cc.Label).string = tagName\n            node.getComponent(cc.Label)._forceUpdateRenderData()\n            var self = this\n            var bindFunction = function(givenNode, givenTag) {\n                givenNode.on(\"click\",function(){\n                    if (self.selectedTag != givenTag) {\n                        self.selectedTag = givenTag\n                    }\n                    if (self.selectedTagNode != givenNode) {\n                        self.selectedTagNode = givenNode\n                    }\n                })\n                givenNode.getComponent(\"redPointMgr\").redPointShowCondition = function(){\n                    var mails = require(\"dataMgr\").playerData.mails\n                    var unReadNum = 0\n                    for (var key in mails) {\n                        var oneMail = mails[key]\n                        if (oneMail.tag == givenTag && oneMail.status == 0) {\n                            unReadNum += 1\n                        }\n                    }\n                    if (unReadNum > 0) {\n                        return true\n                    }\n                    else {\n                        return false\n                    }\n                }\n            }\n            bindFunction(node,oneTag)\n            \n            node.y = this.tagSectionStartY - index * this.tagSectionDis\n            node.name = oneTag\n            this.tagSection.addChild(node,1)\n            if (index == 0) {\n                this.selectedTag = oneTag\n                this.selectedTagNode = node\n            }\n        }\n    },\n\n    setupMailSection() {\n        var textConfig = require(\"textConfig\")\n        var tagMails = this.mailsByTag[this.selectedTag]\n        var mailIdsArry = Object.keys(tagMails)\n        this.mailSectionContentNode.destroyAllChildren()\n        if (mailIdsArry.length == 0) {\n            this.mailSectionEmptyLabelNode.active = true\n            this.mailSectionEmptyLabelNode.getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(146)\n            this.mailSectionContentNode.height = 0\n            return\n        }\n        \n        this.mailSectionEmptyLabelNode.active = false\n        var self = this\n        var sortFunction = function(mailId1, mailId2) {\n            var mail1 = self.mailsByTag[self.selectedTag][mailId1]\n            var mail2 = self.mailsByTag[self.selectedTag][mailId2]\n            if (mail1.status == 0 && mail2.status == 1) {\n                return -1\n            }\n            else if (mail1.status == 1 && mail2.status == 0) {\n                return 1\n            }\n            else {\n                var timeStamp1 = mail1.timeStamp\n                var timeStamp2 = mail2.timeStamp\n                if (timeStamp1 < timeStamp2) {\n                    return 1\n                }\n                else {\n                    return -1\n                }\n            }\n        }\n        mailIdsArry = mailIdsArry.sort(sortFunction)\n        var mailConfig = require(\"mailConfig\")\n        var totalHeight = 0\n        for (var index in mailIdsArry) {\n            var mailId = mailIdsArry[index]\n            var mail = require(\"dataMgr\").playerData.mails[mailId]\n            var node = cc.instantiate(this.mailSectionPrefab)\n            var unReadIconNode = node.getChildByName(\"icon_unread\")\n            var readedIconNode = node.getChildByName(\"icon_readed\")\n            var titleLabelNode = node.getChildByName(\"titleLabel\")\n            var seperateLineNode = node.getChildByName(\"seperateLine\")\n\n            if (mail.status == 1) {\n                unReadIconNode.active = false\n                readedIconNode.active = true\n                titleLabelNode.color = this.mailSectionNodeReadedColor\n            }\n            var titleStr = textConfig.getTextByIdAndLanguageType(mailConfig[mailId].titleTextId)\n            titleLabelNode.getComponent(cc.Label).string = titleStr\n            seperateLineNode.y = -titleLabelNode.height\n            node.y = -totalHeight\n            var nodeWidth = titleLabelNode.x + titleLabelNode.width / 2 - (unReadIconNode.x - unReadIconNode.width / 2)\n            var nodeHeight = titleLabelNode.height\n            node.width = nodeWidth\n            node.height = nodeHeight\n            node.name = mailId.toString()\n            totalHeight = totalHeight + titleLabelNode.height + 2\n            if (index != mailIdsArry.length - 1) {\n                totalHeight += this.mailSectionNodeDis\n            }\n            var self = this\n            var bindFunction = function(givenNode, givenMailId) {\n                givenNode.on(\"click\",function(){\n                    self.openOneMail(givenMailId,givenNode)\n                })\n            }\n            bindFunction(node,mailId)\n            this.mailSectionContentNode.addChild(node)\n        }\n        var minHeight = this.mailSectionContentNode.height\n        if (totalHeight > minHeight) {\n            this.mailSectionContentNode.height = totalHeight\n        }\n    },\n\n    setupNotiSection() {\n        var textConfig = require(\"textConfig\")\n        var unReadMailNum = this.unReadedMailNums[this.selectedTag]\n        if (unReadMailNum > 0) {\n            var str = textConfig.getTextByIdAndLanguageType(129)\n            this.notiSection.getChildByName(\"notiLabel\").getComponent(cc.Label).string = str\n            return\n        }\n        \n        var mailConditionIndex = require(\"dataMgr\").playerData.mailConditionIndex\n        var index = mailConditionIndex[this.selectedTag]\n        if (index == -1) {\n            this.notiSection.getChildByName(\"notiLabel\").getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(130)\n            return\n        }\n        var mailSysConfig = require(\"mailSysConfig\")\n        var element = mailSysConfig[this.selectedTag].conditions[index]\n\n        if (element.conditionType == 1) {\n            var level = element.conditionPara\n            var result = this._getSectionAndLevelNumOfSection(level)\n            if (result != false) {\n                var section = result[0]\n                var levelNumOfSection = result[1]\n                // var str  = \"通关 \" + section.toString() + \" - \" + levelNumOfSection.toString()\n                // str = str + \" ，会有新的邮件，加油吧少年！\"\n                // this.notiSection.getChildByName(\"notiLabel\").getComponent(cc.Label).string = str\n                var str = textConfig.getFormatedString(131,[section.toString(),levelNumOfSection.toString()])\n                this.notiSection.getChildByName(\"notiLabel\").getComponent(cc.Label).string = str\n            }\n        }\n\n        else if (element.conditionType == 2) {\n            //get minum step of one level\n            var levelId = element.conditionPara.levelId\n            var minStepNum = element.conditionPara.minStepNum\n\n            var result = this._getSectionAndLevelNumOfSection(levelId)\n            if (result != false) {\n                var section = result[0]\n                var level = result[1]\n\n                // var str = \"在 \" + section.toString() + \" - \" + level.toString()\n                // str = str + \" 用最多 \" + minStepNum + \" 步通关，会有新的邮件，加油吧少年！\"\n                var str = textConfig.getFormatedString(132,[section.toString(), level.toString(), minStepNum.toString()])\n                this.notiSection.getChildByName(\"notiLabel\").getComponent(cc.Label).string = str\n            }\n        }\n    },\n    _getSectionAndLevelNumOfSection(givenLevelId) {\n        var section = null\n        var levelNumOfSection = null\n        var sectionConfig = require(\"sectionConfig\")\n        for (var key in sectionConfig) {\n            var levels = sectionConfig[key].levels\n            var index = levels.indexOf(givenLevelId)\n            if (index != -1) {\n                section = key\n                levelNumOfSection = index + 1\n                return [section, levelNumOfSection]\n            }\n        }\n        return false\n    },\n\n    setupData() {\n        var mails = require(\"dataMgr\").playerData.mails\n        this.tags = Object.keys(require(\"mailSysConfig\"))\n        for (var index in this.tags) {\n            var oneTag = this.tags[index]\n            this.mailsByTag[oneTag] = {}\n            this.unReadedMailNums[oneTag] = 0\n            for (var key in mails) {\n                var oneMail = mails[key]\n                if (oneMail.tag == oneTag) {\n                    this.mailsByTag[oneTag][key] = oneMail\n                    if (oneMail.stauts == 0) {\n                        this.unReadedMailNums[oneTag] += 1\n                    }\n                }\n            }\n        }\n    },\n\n    setupUI() {\n        this.setupTagSection()\n        this.setupMailSection()\n        this.setupNotiSection()\n    },\n\n    _insertOneMail(mailId, mail){\n        if (mail.tag == this.selectedTag) {\n            this.setupMailSection()\n            this.setupNotiSection()\n        }\n    },\n\n    openOneMail(givenMailId,givenNode) {\n        var node = cc.instantiate(this.opendMailPrefab)\n        var mgr = node.getComponent(\"mailSysMailMgr\")\n        mgr.mailId = givenMailId\n        mgr.relatedMailSectionNode = givenNode\n        mgr.relatedMailSysMgr = this\n        this.node.addChild(node)\n    },\n    setOneMailReaded(mailId,indexOfOptions, complete = function(){},relatedMailSectionNode) {\n        var mail = require(\"dataMgr\").playerData.mails[mailId]\n        if (mail.status == 1) {\n            cc.log(\"this mail is already readed\")\n            return\n        }\n        var networkMgr = require(\"networkMgr\")\n        var messageObj = networkMgr.makeMessageObj(\"mailModule\",\"readMailMessageType\")\n        messageObj.message.playerId = require(\"dataMgr\").playerData.id\n        messageObj.message.mailId = mailId\n        messageObj.message.selectedOptionIndex = indexOfOptions\n        var self = this\n        messageObj.successCallBack = function(xhr) {\n            var response = xhr.responseText\n            response = JSON.parse(response)\n            if (response.type == \"success\") {\n                mail.status = 1\n                mail.selectedOptionIndex = indexOfOptions\n                relatedMailSectionNode.getChildByName(\"icon_readed\").active = true\n                relatedMailSectionNode.getChildByName(\"icon_unread\").active = false\n                relatedMailSectionNode.getChildByName(\"titleLabel\").color = self.mailSectionNodeReadedColor\n                self.unReadedMailNums[mail.tag] -= 1\n                //self.setupRedPoint()\n                self.setupNotiSection()\n                complete()\n            }\n        }\n        networkMgr.sendMessageByMsgObj(messageObj)\n    },\n\n    dataMonitored(key,value) {\n        var mailConfig = require(\"mailConfig\")\n        if (Object.keys(mailConfig).indexOf(key) != -1) {\n            this.setupData()\n            this._insertOneMail(key,value)\n        }\n    }\n    // update (dt) {},\n});\n"]}