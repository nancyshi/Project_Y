
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/bulletMgr.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'eb08bsyH2tHY7xzE8jRRDlt', 'bulletMgr');
// scripts/bulletMgr.js

"use strict";

// Learn cc.Class:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html
cc.Class({
  "extends": cc.Component,
  properties: {
    // bulletType: {
    //     type: cc.Integer,
    //     get() {
    //         // if (this._bulletType == null) {
    //         //     this._bulletType = 1
    //         // }
    //         return this._bulletType
    //     },
    //     set(value) {
    //         this._bulletType = value
    //         if (value == 2) {
    //             this.node.getComponent(cc.Sprite).spriteFrame = this.sliderFrame
    //         }
    //     }
    // }, //1 is normal , 2 is slider bullet
    bulletType: 1,
    status: 0,
    //0 is static, 1 is moving , 2 is reached target
    disFromBorder: 5,
    moveSpeed: 500,
    movingDirection: null,
    targetPosition: null,
    movingTime: 0.3,
    vx: null,
    vy: null,
    levelMgr: null,
    helper: null,
    _rayTestLength: 3000,
    pathWaysNode: cc.Node,
    pathWaysHeight: 10,
    sliderFrame: cc.SpriteFrame,
    faltalTorence: 0.01
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    this.levelMgr = cc.find("Canvas").getComponent("levelMgr");

    var Helper = require("helper");

    this.helper = new Helper(); // if (this.bulletType == 2) {
    //     this.node.getComponent(cc.Sprite).spriteFrame = this.sliderFrame
    // }
  },
  start: function start() {},
  move: function move(direction) {},
  checkWhetherCanMove: function checkWhetherCanMove(direction) {},
  update: function update(dt) {
    this.moveUpdate(dt);
  },
  moveUpdate: function moveUpdate(dt) {
    if (this.status != 1) {
      return;
    }

    var tempX = this.node.x + this.vx * dt;
    var tempY = this.node.y + this.vy * dt;

    if (cc.v2(tempX - this.node.x, tempY - this.node.y).mag() >= cc.v2(this.targetPosition.x - this.node.x, this.targetPosition.y - this.node.y).mag()) {
      tempX = this.targetPosition.x;
      tempY = this.targetPosition.y;
      this.node.x = tempX;
      this.node.y = tempY;
      this.status = 0;
      return;
    }

    this.node.x = tempX;
    this.node.y = tempY;
  },
  getNearestWallInfo: function getNearestWallInfo(givenDirection) {
    if (this.bulletType == 1) {
      //normal bullet
      var result = null;
      var walls = this.levelMgr.walls;
      var disToSelfBounder = this.helper.getDisToSelfBorder(this.node, givenDirection);

      for (var index in walls) {
        var wallNode = walls[index];
        var bounderLines = this.helper.getLinesOfOneNode(wallNode);

        for (var key in bounderLines) {
          var line = bounderLines[key];
          var dis = this.helper.isOneNodeWillCollidWithOneLineInDirection(this.node, line, givenDirection);

          if (dis == false) {
            continue;
          }

          var targetDis = this.disFromBorder + disToSelfBounder;

          if (result == null || dis < result.dis + targetDis) {
            var suitablePosition = this.helper.getSuitablePoint(cc.v2(this.node.x, this.node.y), dis, targetDis, givenDirection);
            var moveDis = cc.v2(suitablePosition.x - this.node.x, suitablePosition.y - this.node.y).mag();
            result = {
              dis: moveDis,
              suitablePosition: suitablePosition
            };
          }
        }
      }

      return result;
    }

    if (this.bulletType == 2) {
      if (this.pathWaysNode == null || this.pathWaysNode.children.length == 0) {
        return {
          dis: 0,
          suitablePosition: this.node.position
        };
      }

      var selectedPathNode = null;

      for (var index in this.pathWaysNode.children) {
        var onePath = this.pathWaysNode.children[index];

        if (this.helper.isTwoNodeCross(this.node, onePath) == false) {
          continue;
        }

        if (selectedPathNode == null || this._isPathNodeMoveDirection(onePath, givenDirection) == true) {
          selectedPathNode = onePath;
        }
      }

      if (this._isPathNodeMoveDirection(selectedPathNode, givenDirection) == false) {
        return {
          dis: 0,
          suitablePosition: this.node.position
        };
      }

      var ray = this.helper.makeRay(this.node.position, 3000, givenDirection);
      var currentDis = null;
      var lines = this.helper.getLinesOfOneNode(selectedPathNode);

      for (var key in lines) {
        var line = lines[key];
        var dis = this.helper.rayTest(ray, line);

        if (dis.toString() != "false") {
          if (currentDis == null || dis > currentDis) {
            currentDis = dis;
          }
        }
      }

      if (currentDis == null) {
        currentDis = 5;
      }

      var suitablePosition = this.helper.getSuitablePoint(this.node.position, currentDis, 0, givenDirection);
      var dis = cc.v2(suitablePosition.x - this.node.x, suitablePosition.y - this.node.y).mag();
      return {
        suitablePosition: suitablePosition,
        dis: dis
      };
    }
  },
  getMaxDisFromPathNode: function getMaxDisFromPathNode(givenNode, direction) {
    var ray1 = this.helper.makeRay(this.node.position, 3000, direction);
    var ray2 = this.helper.makeRay(this.node.position, 3000, cc.v2(-direction.x, -direction.y));
    var lines = this.helper.getLinesOfOneNode(givenNode);
    var self = this;

    var getDis = function getDis(ray) {
      var dis = null;

      for (var key in lines) {
        var line = lines[key];
        var dist = self.helper.rayTest(ray, line);

        if (dist != false) {
          return dist;
        }
      }

      if (dis == null) {
        dis = 5;
      }

      return dis;
    };

    var dis1 = getDis(ray1);
    var dis2 = getDis(ray2);

    if (dis1 >= dis2) {
      return dis1;
    } else {
      return dis2;
    }
  },
  isPathNodeMoveDirection: function isPathNodeMoveDirection(givenPathNode, givenDirection) {
    var dis1 = this.getMaxDisFromPathNode(givenPathNode, givenDirection);
    var verticalDirection = givenDirection.rotate(Math.PI / 2);
    var dis2 = this.getMaxDisFromPathNode(givenPathNode, verticalDirection);

    if (dis1 > dis2) {
      return true;
    }

    return false;
  },
  _isPathNodeMoveDirection: function _isPathNodeMoveDirection(givenPathNode, givenDirection) {
    givenDirection.normalizeSelf();
    var angle = -givenPathNode.angle * Math.PI / 180;
    var rotatedDirection = cc.v2(1, 0).rotate(angle);

    if (givenDirection.fuzzyEquals(rotatedDirection, 0.001) == true || givenDirection.fuzzyEquals(cc.v2(-rotatedDirection.x, -rotatedDirection.y), 0.001) == true) {
      return true;
    } else {
      return false;
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL2J1bGxldE1nci5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImJ1bGxldFR5cGUiLCJzdGF0dXMiLCJkaXNGcm9tQm9yZGVyIiwibW92ZVNwZWVkIiwibW92aW5nRGlyZWN0aW9uIiwidGFyZ2V0UG9zaXRpb24iLCJtb3ZpbmdUaW1lIiwidngiLCJ2eSIsImxldmVsTWdyIiwiaGVscGVyIiwiX3JheVRlc3RMZW5ndGgiLCJwYXRoV2F5c05vZGUiLCJOb2RlIiwicGF0aFdheXNIZWlnaHQiLCJzbGlkZXJGcmFtZSIsIlNwcml0ZUZyYW1lIiwiZmFsdGFsVG9yZW5jZSIsIm9uTG9hZCIsImZpbmQiLCJnZXRDb21wb25lbnQiLCJIZWxwZXIiLCJyZXF1aXJlIiwic3RhcnQiLCJtb3ZlIiwiZGlyZWN0aW9uIiwiY2hlY2tXaGV0aGVyQ2FuTW92ZSIsInVwZGF0ZSIsImR0IiwibW92ZVVwZGF0ZSIsInRlbXBYIiwibm9kZSIsIngiLCJ0ZW1wWSIsInkiLCJ2MiIsIm1hZyIsImdldE5lYXJlc3RXYWxsSW5mbyIsImdpdmVuRGlyZWN0aW9uIiwicmVzdWx0Iiwid2FsbHMiLCJkaXNUb1NlbGZCb3VuZGVyIiwiZ2V0RGlzVG9TZWxmQm9yZGVyIiwiaW5kZXgiLCJ3YWxsTm9kZSIsImJvdW5kZXJMaW5lcyIsImdldExpbmVzT2ZPbmVOb2RlIiwia2V5IiwibGluZSIsImRpcyIsImlzT25lTm9kZVdpbGxDb2xsaWRXaXRoT25lTGluZUluRGlyZWN0aW9uIiwidGFyZ2V0RGlzIiwic3VpdGFibGVQb3NpdGlvbiIsImdldFN1aXRhYmxlUG9pbnQiLCJtb3ZlRGlzIiwiY2hpbGRyZW4iLCJsZW5ndGgiLCJwb3NpdGlvbiIsInNlbGVjdGVkUGF0aE5vZGUiLCJvbmVQYXRoIiwiaXNUd29Ob2RlQ3Jvc3MiLCJfaXNQYXRoTm9kZU1vdmVEaXJlY3Rpb24iLCJyYXkiLCJtYWtlUmF5IiwiY3VycmVudERpcyIsImxpbmVzIiwicmF5VGVzdCIsInRvU3RyaW5nIiwiZ2V0TWF4RGlzRnJvbVBhdGhOb2RlIiwiZ2l2ZW5Ob2RlIiwicmF5MSIsInJheTIiLCJzZWxmIiwiZ2V0RGlzIiwiZGlzdCIsImRpczEiLCJkaXMyIiwiaXNQYXRoTm9kZU1vdmVEaXJlY3Rpb24iLCJnaXZlblBhdGhOb2RlIiwidmVydGljYWxEaXJlY3Rpb24iLCJyb3RhdGUiLCJNYXRoIiwiUEkiLCJub3JtYWxpemVTZWxmIiwiYW5nbGUiLCJyb3RhdGVkRGlyZWN0aW9uIiwiZnV6enlFcXVhbHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUVSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBQyxJQUFBQSxVQUFVLEVBQUUsQ0FqQko7QUFrQlJDLElBQUFBLE1BQU0sRUFBRSxDQWxCQTtBQWtCRztBQUNYQyxJQUFBQSxhQUFhLEVBQUUsQ0FuQlA7QUFvQlJDLElBQUFBLFNBQVMsRUFBRSxHQXBCSDtBQXFCUkMsSUFBQUEsZUFBZSxFQUFFLElBckJUO0FBc0JSQyxJQUFBQSxjQUFjLEVBQUUsSUF0QlI7QUF1QlJDLElBQUFBLFVBQVUsRUFBRSxHQXZCSjtBQXdCUkMsSUFBQUEsRUFBRSxFQUFFLElBeEJJO0FBeUJSQyxJQUFBQSxFQUFFLEVBQUUsSUF6Qkk7QUEyQlJDLElBQUFBLFFBQVEsRUFBRSxJQTNCRjtBQTRCUkMsSUFBQUEsTUFBTSxFQUFFLElBNUJBO0FBOEJSQyxJQUFBQSxjQUFjLEVBQUUsSUE5QlI7QUErQlJDLElBQUFBLFlBQVksRUFBRWhCLEVBQUUsQ0FBQ2lCLElBL0JUO0FBZ0NSQyxJQUFBQSxjQUFjLEVB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LCJzb3VyY2VzQ29udGVudCI6WyIvLyBMZWFybiBjYy5DbGFzczpcbi8vICAtIFtDaGluZXNlXSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL3NjcmlwdGluZy9jbGFzcy5odG1sXG4vLyAgLSBbRW5nbGlzaF0gaHR0cDovL2RvY3MuY29jb3MyZC14Lm9yZy9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvY2xhc3MuaHRtbFxuLy8gTGVhcm4gQXR0cmlidXRlOlxuLy8gIC0gW0NoaW5lc2VdIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL3JlZmVyZW5jZS9hdHRyaWJ1dGVzLmh0bWxcbi8vICAtIFtFbmdsaXNoXSBodHRwOi8vZG9jcy5jb2NvczJkLXgub3JnL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9yZWZlcmVuY2UvYXR0cmlidXRlcy5odG1sXG4vLyBMZWFybiBsaWZlLWN5Y2xlIGNhbGxiYWNrczpcbi8vICAtIFtDaGluZXNlXSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL3NjcmlwdGluZy9saWZlLWN5Y2xlLWNhbGxiYWNrcy5odG1sXG4vLyAgLSBbRW5nbGlzaF0gaHR0cHM6Ly93d3cuY29jb3MyZC14Lm9yZy9kb2NzL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9saWZlLWN5Y2xlLWNhbGxiYWNrcy5odG1sXG5cbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG5cbiAgICAgICAgLy8gYnVsbGV0VHlwZToge1xuICAgICAgICAvLyAgICAgdHlwZTogY2MuSW50ZWdlcixcbiAgICAgICAgLy8gICAgIGdldCgpIHtcbiAgICAgICAgLy8gICAgICAgICAvLyBpZiAodGhpcy5fYnVsbGV0VHlwZSA9PSBudWxsKSB7XG4gICAgICAgIC8vICAgICAgICAgLy8gICAgIHRoaXMuX2J1bGxldFR5cGUgPSAxXG4gICAgICAgIC8vICAgICAgICAgLy8gfVxuICAgICAgICAvLyAgICAgICAgIHJldHVybiB0aGlzLl9idWxsZXRUeXBlXG4gICAgICAgIC8vICAgICB9LFxuICAgICAgICAvLyAgICAgc2V0KHZhbHVlKSB7XG4gICAgICAgIC8vICAgICAgICAgdGhpcy5fYnVsbGV0VHlwZSA9IHZhbHVlXG4gICAgICAgIC8vICAgICAgICAgaWYgKHZhbHVlID09IDIpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy5ub2RlLmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNwcml0ZUZyYW1lID0gdGhpcy5zbGlkZXJGcmFtZVxuICAgICAgICAvLyAgICAgICAgIH1cbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfSwgLy8xIGlzIG5vcm1hbCAsIDIgaXMgc2xpZGVyIGJ1bGxldFxuICAgICAgICBidWxsZXRUeXBlOiAxLFxuICAgICAgICBzdGF0dXM6IDAsIC8vMCBpcyBzdGF0aWMsIDEgaXMgbW92aW5nICwgMiBpcyByZWFjaGVkIHRhcmdldFxuICAgICAgICBkaXNGcm9tQm9yZGVyOiA1LFxuICAgICAgICBtb3ZlU3BlZWQ6IDUwMCxcbiAgICAgICAgbW92aW5nRGlyZWN0aW9uOiBudWxsLFxuICAgICAgICB0YXJnZXRQb3NpdGlvbjogbnVsbCxcbiAgICAgICAgbW92aW5nVGltZTogMC4zLFxuICAgICAgICB2eDogbnVsbCxcbiAgICAgICAgdnk6IG51bGwsXG5cbiAgICAgICAgbGV2ZWxNZ3I6IG51bGwsXG4gICAgICAgIGhlbHBlcjogbnVsbCxcblxuICAgICAgICBfcmF5VGVzdExlbmd0aDogMzAwMCxcbiAgICAgICAgcGF0aFdheXNOb2RlOiBjYy5Ob2RlLFxuICAgICAgICBwYXRoV2F5c0hlaWdodDogMTAsXG4gICAgICAgIHNsaWRlckZyYW1lOiBjYy5TcHJpdGVGcmFtZSxcbiAgICAgICAgZmFsdGFsVG9yZW5jZTogMC4wMVxuICAgIH0sXG5cbiAgICAvLyBMSUZFLUNZQ0xFIENBTExCQUNLUzpcblxuICAgIG9uTG9hZCAoKSB7XG4gICAgICAgIHRoaXMubGV2ZWxNZ3IgPSBjYy5maW5kKFwiQ2FudmFzXCIpLmdldENvbXBvbmVudChcImxldmVsTWdyXCIpXG4gICAgICAgIHZhciBIZWxwZXIgPSByZXF1aXJlKFwiaGVscGVyXCIpXG4gICAgICAgIHRoaXMuaGVscGVyID0gbmV3IEhlbHBlcigpXG4gICAgICAgIC8vIGlmICh0aGlzLmJ1bGxldFR5cGUgPT0gMikge1xuICAgICAgICAvLyAgICAgdGhpcy5ub2RlLmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNwcml0ZUZyYW1lID0gdGhpcy5zbGlkZXJGcmFtZVxuICAgICAgICAvLyB9XG4gICAgfSxcblxuICAgIHN0YXJ0ICgpIHtcbiAgICAgICAgXG4gICAgfSxcbiAgICBtb3ZlKGRpcmVjdGlvbikge1xuXG4gICAgfSxcbiAgICBjaGVja1doZXRoZXJDYW5Nb3ZlKGRpcmVjdGlvbikge1xuXG4gICAgfSxcbiAgICB1cGRhdGUgKGR0KSB7XG4gICAgICAgIHRoaXMubW92ZVVwZGF0ZShkdClcbiAgICB9LFxuXG4gICAgbW92ZVVwZGF0ZShkdCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0dXMgIT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdGVtcFggPSB0aGlzLm5vZGUueCArIHRoaXMudnggKiBkdFxuICAgICAgICB2YXIgdGVtcFkgPSB0aGlzLm5vZGUueSArIHRoaXMudnkgKiBkdFxuICAgICAgICBpZiAoY2MudjIodGVtcFggLSB0aGlzLm5vZGUueCwgdGVtcFkgLSB0aGlzLm5vZGUueSkubWFnKCkgPj0gY2MudjIodGhpcy50YXJnZXRQb3NpdGlvbi54IC0gdGhpcy5ub2RlLngsIHRoaXMudGFyZ2V0UG9zaXRpb24ueSAtIHRoaXMubm9kZS55KS5tYWcoKSkge1xuICAgICAgICAgICAgdGVtcFggPSB0aGlzLnRhcmdldFBvc2l0aW9uLnhcbiAgICAgICAgICAgIHRlbXBZID0gdGhpcy50YXJnZXRQb3NpdGlvbi55XG5cbiAgICAgICAgICAgIHRoaXMubm9kZS54ID0gdGVtcFhcbiAgICAgICAgICAgIHRoaXMubm9kZS55ID0gdGVtcFlcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gMFxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm5vZGUueCA9IHRlbXBYXG4gICAgICAgIHRoaXMubm9kZS55ID0gdGVtcFlcbiAgICB9LFxuICAgIGdldE5lYXJlc3RXYWxsSW5mbyhnaXZlbkRpcmVjdGlvbikge1xuICAgICAgICBpZiAodGhpcy5idWxsZXRUeXBlID09IDEpIHtcbiAgICAgICAgICAgIC8vbm9ybWFsIGJ1bGxldFxuXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbFxuICAgICAgICAgICAgdmFyIHdhbGxzID0gdGhpcy5sZXZlbE1nci53YWxsc1xuICAgICAgICAgICAgdmFyIGRpc1RvU2VsZkJvdW5kZXIgPSB0aGlzLmhlbHBlci5nZXREaXNUb1NlbGZCb3JkZXIodGhpcy5ub2RlLGdpdmVuRGlyZWN0aW9uKVxuXG4gICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiB3YWxscykge1xuICAgICAgICAgICAgICAgIHZhciB3YWxsTm9kZSA9IHdhbGxzW2luZGV4XVxuICAgICAgICAgICAgICAgIHZhciBib3VuZGVyTGluZXMgPSB0aGlzLmhlbHBlci5nZXRMaW5lc09mT25lTm9kZSh3YWxsTm9kZSlcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gYm91bmRlckxpbmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW5lID0gYm91bmRlckxpbmVzW2tleV1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpcyA9IHRoaXMuaGVscGVyLmlzT25lTm9kZVdpbGxDb2xsaWRXaXRoT25lTGluZUluRGlyZWN0aW9uKHRoaXMubm9kZSxsaW5lLGdpdmVuRGlyZWN0aW9uKVxuICAgICAgICAgICAgICAgICAgICBpZiAoZGlzID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXREaXMgPSB0aGlzLmRpc0Zyb21Cb3JkZXIgKyBkaXNUb1NlbGZCb3VuZGVyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCB8fCBkaXMgPCByZXN1bHQuZGlzICsgdGFyZ2V0RGlzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VpdGFibGVQb3NpdGlvbiA9IHRoaXMuaGVscGVyLmdldFN1aXRhYmxlUG9pbnQoY2MudjIodGhpcy5ub2RlLngsIHRoaXMubm9kZS55KSxkaXMsdGFyZ2V0RGlzLGdpdmVuRGlyZWN0aW9uKVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vdmVEaXMgPSBjYy52MihzdWl0YWJsZVBvc2l0aW9uLnggLSB0aGlzLm5vZGUueCwgc3VpdGFibGVQb3NpdGlvbi55IC0gdGhpcy5ub2RlLnkpLm1hZygpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzOiBtb3ZlRGlzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1aXRhYmxlUG9zaXRpb246IHN1aXRhYmxlUG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHRcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKHRoaXMuYnVsbGV0VHlwZSA9PSAyKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wYXRoV2F5c05vZGUgPT0gbnVsbCB8fCB0aGlzLnBhdGhXYXlzTm9kZS5jaGlsZHJlbi5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGRpczogMCxcbiAgICAgICAgICAgICAgICAgICAgc3VpdGFibGVQb3NpdGlvbjogdGhpcy5ub2RlLnBvc2l0aW9uXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkUGF0aE5vZGUgPSBudWxsXG4gICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiB0aGlzLnBhdGhXYXlzTm9kZS5jaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIHZhciBvbmVQYXRoID0gdGhpcy5wYXRoV2F5c05vZGUuY2hpbGRyZW5baW5kZXhdXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaGVscGVyLmlzVHdvTm9kZUNyb3NzKHRoaXMubm9kZSxvbmVQYXRoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZFBhdGhOb2RlID09IG51bGwgfHwgdGhpcy5faXNQYXRoTm9kZU1vdmVEaXJlY3Rpb24ob25lUGF0aCxnaXZlbkRpcmVjdGlvbikgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFBhdGhOb2RlID0gb25lUGF0aFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9pc1BhdGhOb2RlTW92ZURpcmVjdGlvbihzZWxlY3RlZFBhdGhOb2RlLGdpdmVuRGlyZWN0aW9uKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGRpczogMCxcbiAgICAgICAgICAgICAgICAgICAgc3VpdGFibGVQb3NpdGlvbjogdGhpcy5ub2RlLnBvc2l0aW9uXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJheSA9IHRoaXMuaGVscGVyLm1ha2VSYXkodGhpcy5ub2RlLnBvc2l0aW9uLDMwMDAsZ2l2ZW5EaXJlY3Rpb24pXG4gICAgICAgICAgICB2YXIgY3VycmVudERpcyA9IG51bGxcbiAgICAgICAgICAgIHZhciBsaW5lcyA9IHRoaXMuaGVscGVyLmdldExpbmVzT2ZPbmVOb2RlKHNlbGVjdGVkUGF0aE5vZGUpXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbGluZXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGluZSA9IGxpbmVzW2tleV1cbiAgICAgICAgICAgICAgICB2YXIgZGlzID0gdGhpcy5oZWxwZXIucmF5VGVzdChyYXksbGluZSlcbiAgICAgICAgICAgICAgICBpZiAoZGlzLnRvU3RyaW5nKCkgIT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RGlzID09IG51bGwgfHwgZGlzID4gY3VycmVudERpcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudERpcyA9IGRpcyBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGN1cnJlbnREaXMgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnREaXMgPSA1XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc3VpdGFibGVQb3NpdGlvbiA9IHRoaXMuaGVscGVyLmdldFN1aXRhYmxlUG9pbnQodGhpcy5ub2RlLnBvc2l0aW9uLGN1cnJlbnREaXMsMCxnaXZlbkRpcmVjdGlvbilcbiAgICAgICAgICAgIHZhciBkaXMgPSBjYy52MihzdWl0YWJsZVBvc2l0aW9uLnggLSB0aGlzLm5vZGUueCwgc3VpdGFibGVQb3NpdGlvbi55IC0gdGhpcy5ub2RlLnkpLm1hZygpXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN1aXRhYmxlUG9zaXRpb246IHN1aXRhYmxlUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgZGlzOiBkaXNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRNYXhEaXNGcm9tUGF0aE5vZGUoZ2l2ZW5Ob2RlLGRpcmVjdGlvbikge1xuICAgICAgICB2YXIgcmF5MSA9IHRoaXMuaGVscGVyLm1ha2VSYXkodGhpcy5ub2RlLnBvc2l0aW9uLDMwMDAsZGlyZWN0aW9uKVxuICAgICAgICB2YXIgcmF5MiA9IHRoaXMuaGVscGVyLm1ha2VSYXkodGhpcy5ub2RlLnBvc2l0aW9uLDMwMDAsY2MudjIoLWRpcmVjdGlvbi54LCAtZGlyZWN0aW9uLnkpKVxuXG4gICAgICAgIHZhciBsaW5lcyA9IHRoaXMuaGVscGVyLmdldExpbmVzT2ZPbmVOb2RlKGdpdmVuTm9kZSlcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzXG4gICAgICAgIHZhciBnZXREaXMgPSBmdW5jdGlvbihyYXkpIHtcbiAgICAgICAgICAgIHZhciBkaXMgPSBudWxsXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbGluZXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGluZSA9IGxpbmVzW2tleV1cbiAgICAgICAgICAgICAgICB2YXIgZGlzdCA9IHNlbGYuaGVscGVyLnJheVRlc3QocmF5LGxpbmUpXG4gICAgICAgICAgICAgICAgaWYgKGRpc3QgIT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRpc3RcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChkaXMgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGRpcyA9IDVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkaXNcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkaXMxID0gZ2V0RGlzKHJheTEpXG4gICAgICAgIHZhciBkaXMyID0gZ2V0RGlzKHJheTIpXG4gICAgICAgIFxuICAgICAgICBpZiAoZGlzMSA+PSBkaXMyKSB7XG4gICAgICAgICAgICByZXR1cm4gZGlzMVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGRpczJcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpc1BhdGhOb2RlTW92ZURpcmVjdGlvbihnaXZlblBhdGhOb2RlLCBnaXZlbkRpcmVjdGlvbikge1xuICAgICAgICB2YXIgZGlzMSA9IHRoaXMuZ2V0TWF4RGlzRnJvbVBhdGhOb2RlKGdpdmVuUGF0aE5vZGUsZ2l2ZW5EaXJlY3Rpb24pXG4gICAgICAgIHZhciB2ZXJ0aWNhbERpcmVjdGlvbiA9IGdpdmVuRGlyZWN0aW9uLnJvdGF0ZShNYXRoLlBJLzIpXG4gICAgICAgIHZhciBkaXMyID0gdGhpcy5nZXRNYXhEaXNGcm9tUGF0aE5vZGUoZ2l2ZW5QYXRoTm9kZSx2ZXJ0aWNhbERpcmVjdGlvbilcbiAgICAgICAgaWYgKGRpczEgPiBkaXMyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSxcblxuICAgIF9pc1BhdGhOb2RlTW92ZURpcmVjdGlvbihnaXZlblBhdGhOb2RlLGdpdmVuRGlyZWN0aW9uKSB7XG4gICAgICAgIGdpdmVuRGlyZWN0aW9uLm5vcm1hbGl6ZVNlbGYoKVxuICAgICAgICB2YXIgYW5nbGUgPSAtZ2l2ZW5QYXRoTm9kZS5hbmdsZSAqIE1hdGguUEkgLyAxODBcbiAgICAgICAgdmFyIHJvdGF0ZWREaXJlY3Rpb24gPSBjYy52MigxLDApLnJvdGF0ZShhbmdsZSlcbiAgICAgICAgaWYgKGdpdmVuRGlyZWN0aW9uLmZ1enp5RXF1YWxzKHJvdGF0ZWREaXJlY3Rpb24sMC4wMDEpID09IHRydWUgfHwgZ2l2ZW5EaXJlY3Rpb24uZnV6enlFcXVhbHMoY2MudjIoLXJvdGF0ZWREaXJlY3Rpb24ueCwgLXJvdGF0ZWREaXJlY3Rpb24ueSksMC4wMDEpID09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgfVxuIFxufSk7XG4iXX0=