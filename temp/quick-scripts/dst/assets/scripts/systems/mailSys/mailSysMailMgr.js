
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/systems/mailSys/mailSysMailMgr.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '16bb9ye6UBAebul1F7cBbyY', 'mailSysMailMgr');
// scripts/systems/mailSys/mailSysMailMgr.js

"use strict";

// Learn cc.Class:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html
cc.Class({
  "extends": cc.Component,
  properties: {
    // foo: {
    //     // ATTRIBUTES:
    //     default: null,        // The default value will be used only when the component attaching
    //                           // to a node for the first time
    //     type: cc.SpriteFrame, // optional, default is typeof default
    //     serializable: true,   // optional, default is true
    // },
    // bar: {
    //     get () {
    //         return this._bar;
    //     },
    //     set (value) {
    //         this._bar = value;
    //     }
    // },
    mailId: null,
    relatedMailSectionNode: cc.Node,
    relatedMailSysMgr: null,
    mailOptionNodePrefab: cc.Prefab,
    disOfContentAndOptionSection: 200,
    disOfOptionNodes: 25,
    headerHeight: 82,
    footerHeight: 80
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    var bg = this.node.getChildByName("bg");
    bg.width = cc.winSize.width;
    bg.height = cc.winSize.height;
    bg.on("touchstart", function () {});
    this.setupContentSection();
    this.setupOptionSection();
    this.setupUiBg();
  },
  start: function start() {},
  close: function close() {
    this.node.destroy();
  },
  setupContentSection: function setupContentSection() {
    var textConfig = require("textConfig");

    var mailConfig = require("mailConfig");

    var mail = mailConfig[this.mailId];
    var content = this.node.getChildByName("others").getChildByName("contentSection").getChildByName("view").getChildByName("content");
    var titleLabel = content.getChildByName("titleLabel");
    var contentLabel = content.getChildByName("contentLabel"); // titleLabel.getComponent(cc.Label).string = mail.title
    // contentLabel.getComponent(cc.Label).string = mail.content

    titleLabel.getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(mail.titleTextId);
    contentLabel.getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(mail.contentTextId);
    content.height = -contentLabel.y + contentLabel.height;
  },
  setupOptionSection: function setupOptionSection() {
    var textConfig = require("textConfig");

    var optionSection = this.node.getChildByName("others").getChildByName("optionSection");

    var mailConfig = require("mailConfig");

    var mail = mailConfig[this.mailId];
    var options = mail.options;
    mail = require("dataMgr").playerData.mails[this.mailId];

    if (mail.status == 0) {
      //unreaded mail
      if (options.length == 0) {
        var okOptionNode = cc.instantiate(this.mailOptionNodePrefab);
        var okLabelNode = okOptionNode.getChildByName("label");
        okLabelNode.getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(147);
        var okBgNode = okOptionNode.getChildByName("bg");
        okOptionNode.width = okBgNode.width;
        okOptionNode.height = okBgNode.height;
        optionSection.height += okOptionNode.height;
        var self = this;
        okOptionNode.on("click", function () {
          var onMailReaded = function onMailReaded() {
            self.close();
          };

          self.relatedMailSysMgr.setOneMailReaded(self.mailId, -1, onMailReaded, self.relatedMailSectionNode);
        });
        okOptionNode.y = -(optionSection.height - okOptionNode.height);
        optionSection.addChild(okOptionNode);
        return;
      }

      for (var index in options) {
        var oneOption = options[index];
        var optionNode = cc.instantiate(this.mailOptionNodePrefab);
        var labelNode = optionNode.getChildByName("label"); // labelNode.getComponent(cc.Label).string = oneOption.showText

        labelNode.getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(oneOption.showTextId);
        var bgNode = optionNode.getChildByName("bg");
        bgNode.height = labelNode.height;
        optionNode.width = bgNode.width;
        optionNode.height = bgNode.height;

        if (index == 0) {
          optionSection.height += optionNode.height;
        } else {
          optionSection.height += optionNode.height + this.disOfOptionNodes;
        }

        optionNode.y = -(optionSection.height - optionNode.height);
        var operationType = oneOption.operationType;
        var operationPara = oneOption.operationPara;
        var self = this;

        var bindFunction = function bindFunction(givenNode, givenOperationType, givenOperationPara, indexOfOptions) {
          givenNode.on("click", function () {
            //no matter what option be selected, this mail will be readed
            var onMailReaded = function onMailReaded() {
              if (givenOperationType == 1) {
                self.close();
              } else if (givenOperationType == 2) {
                // mailSys.sendOneMail(givenOperationPara.mailId, mail.tag, givenOperationPara.delay)
                require("systemsMgr").mailSysGloableSendOneMail(givenOperationPara.mailId, mail.tag, function () {}, givenOperationPara.delay);

                self.close();
              }
            };

            self.relatedMailSysMgr.setOneMailReaded(self.mailId, indexOfOptions, onMailReaded, self.relatedMailSectionNode);
          });
        };

        bindFunction(optionNode, operationType, operationPara, index);
        optionSection.addChild(optionNode);
      }
    } else if (mail.status == 1) {
      //readed mail
      if (mail.selectedOptionIndex != -1) {
        var selectedOptionIndex = mail.selectedOptionIndex;
        var selectedOption = options[selectedOptionIndex];
        var optionNode = cc.instantiate(this.mailOptionNodePrefab);
        var labelNode = optionNode.getChildByName("label"); // labelNode.getComponent(cc.Label).string = selectedOption.showText

        labelNode.getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(selectedOption.showTextId);
        labelNode.color = cc.color(255, 255, 255);
        var bgNode = optionNode.getChildByName("bg_readed");
        bgNode.active = true;
        bgNode.height = labelNode.height;
        optionNode.width = bgNode.width;
        optionNode.height = bgNode.height;
        optionSection.height += optionNode.height;
        optionNode.getComponent(cc.Button).interactable = false;
        optionNode.y = -(optionSection.height - optionNode.height);
        optionSection.addChild(optionNode);
        var okOptionNode = cc.instantiate(this.mailOptionNodePrefab);
        var okLabelNode = okOptionNode.getChildByName("label");
        okLabelNode.getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(147);
        var okBgNode = okOptionNode.getChildByName("bg");
        okOptionNode.width = okBgNode.width;
        okOptionNode.height = okBgNode.height;
        optionSection.height += okOptionNode.height + this.disOfOptionNodes;
        var self = this;
        okOptionNode.on("click", function () {
          self.close();
        });
        okOptionNode.y = -(optionSection.height - okOptionNode.height);
        optionSection.addChild(okOptionNode);
      } else {
        var okOptionNode = cc.instantiate(this.mailOptionNodePrefab);
        var okLabelNode = okOptionNode.getChildByName("label");
        okLabelNode.getComponent(cc.Label).string = textConfig.getTextByIdAndLanguageType(147);
        var okBgNode = okOptionNode.getChildByName("bg");
        okOptionNode.width = okBgNode.width;
        okOptionNode.height = okBgNode.height;
        optionSection.height += okOptionNode.height;
        var self = this;
        okOptionNode.on("click", function () {
          self.close();
        });
        okOptionNode.y = -(optionSection.height - okOptionNode.height);
        optionSection.addChild(okOptionNode);
      }
    }
  },
  setupUiBg: function setupUiBg() {
    var uibg = this.node.getChildByName("others").getChildByName("uibg");
    var contentSection = this.node.getChildByName("others").getChildByName("contentSection");
    var optionSection = this.node.getChildByName("others").getChildByName("optionSection");
    uibg.height = this.headerHeight + contentSection.height + this.disOfContentAndOptionSection + optionSection.height + this.footerHeight;
    contentSection.y = uibg.height / 2 - this.headerHeight;
    optionSection.y = contentSection.y - contentSection.height - this.disOfContentAndOptionSection;
  } // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL3N5c3RlbXMvbWFpbFN5cy9tYWlsU3lzTWFpbE1nci5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIm1haWxJZCIsInJlbGF0ZWRNYWlsU2VjdGlvbk5vZGUiLCJOb2RlIiwicmVsYXRlZE1haWxTeXNNZ3IiLCJtYWlsT3B0aW9uTm9kZVByZWZhYiIsIlByZWZhYiIsImRpc09mQ29udGVudEFuZE9wdGlvblNlY3Rpb24iLCJkaXNPZk9wdGlvbk5vZGVzIiwiaGVhZGVySGVpZ2h0IiwiZm9vdGVySGVpZ2h0Iiwib25Mb2FkIiwiYmciLCJub2RlIiwiZ2V0Q2hpbGRCeU5hbWUiLCJ3aWR0aCIsIndpblNpemUiLCJoZWlnaHQiLCJvbiIsInNldHVwQ29udGVudFNlY3Rpb24iLCJzZXR1cE9wdGlvblNlY3Rpb24iLCJzZXR1cFVpQmciLCJzdGFydCIsImNsb3NlIiwiZGVzdHJveSIsInRleHRDb25maWciLCJyZXF1aXJlIiwibWFpbENvbmZpZyIsIm1haWwiLCJjb250ZW50IiwidGl0bGVMYWJlbCIsImNvbnRlbnRMYWJlbCIsImdldENvbXBvbmVudCIsIkxhYmVsIiwic3RyaW5nIiwiZ2V0VGV4dEJ5SWRBbmRMYW5ndWFnZVR5cGUiLCJ0aXRsZVRleHRJZCIsImNvbnRlbnRUZXh0SWQiLCJ5Iiwib3B0aW9uU2VjdGlvbiIsIm9wdGlvbnMiLCJwbGF5ZXJEYXRhIiwibWFpbHMiLCJzdGF0dXMiLCJsZW5ndGgiLCJva09wdGlvbk5vZGUiLCJpbnN0YW50aWF0ZSIsIm9rTGFiZWxOb2RlIiwib2tCZ05vZGUiLCJzZWxmIiwib25NYWlsUmVhZGVkIiwic2V0T25lTWFpbFJlYWRlZCIsImFkZENoaWxkIiwiaW5kZXgiLCJvbmVPcHRpb24iLCJvcHRpb25Ob2RlIiwibGFiZWxOb2RlIiwic2hvd1RleHRJZCIsImJnTm9kZSIsIm9wZXJhdGlvblR5cGUiLCJvcGVyYXRpb25QYXJhIiwiYmluZEZ1bmN0aW9uIiwiZ2l2ZW5Ob2RlIiwiZ2l2ZW5PcGVyYXRpb25UeXBlIiwiZ2l2ZW5PcGVyYXRpb25QYXJhIiwiaW5kZXhPZk9wdGlvbnMiLCJtYWlsU3lzR2xvYWJsZVNlbmRPbmVNYWlsIiwidGFnIiwiZGVsYXkiLCJzZWxlY3RlZE9wdGlvbkluZGV4Iiwic2VsZWN0ZWRPcHRpb24iLCJjb2xvciIsImFjdGl2ZSIsIkJ1dHRvbiIsImludGVyYWN0YWJsZSIsInVpYmciLCJjb250ZW50U2VjdGlvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQUEsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FDLElBQUFBLE1BQU0sRUFBRSxJQWhCQTtBQWlCUkMsSUFBQUEsc0JBQXNCLEVBQUVMLEVBQUUsQ0FBQ00sSUFqQm5CO0FBa0JSQyxJQUFBQSxpQkFBaUIsRUFBRSxJQWxCWDtBQW1CUkMsSUFBQUEsb0JBQW9CLEVBQUVSLEVBQUUsQ0FBQ1MsTUFuQmpCO0FBb0JSQyxJQUFBQSw0QkFBNEIsRUFBRSxHQXBCdEI7QUFxQlJDLElBQUFBLGdCQUFnQixFQUFFLEVBckJWO0FBc0JSQyxJQUFBQSxZQUFZLEVBQUUsRUF0Qk47QUF1QlJDLElBQUFBLFlBQVksRUFBRTtBQXZCTixHQUhQO0FBNkJMO0FBRUFDLEVBQUFBLE1BL0JLLG9CQStCSztBQUNOLFFBQUlDLEVBQUUsR0FBRyxLQUFLQyxJQUFMLENBQVVDLGNBQVYsQ0FBeUIsSUFBekIsQ0FBVDtBQUNBRixJQUFBQSxFQUFFLENBQUNHLEtBQUgsR0FBV2xCLEVBQUUsQ0FBQ21CLE9BQUgsQ0FBV0QsS0FBdEI7QUFDQUgsSUFBQUEsRUFBRSxDQUFD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LFlBQXhDO0FBQ0E4QixJQUFBQSxhQUFhLENBQUNELENBQWQsR0FBa0JzQyxjQUFjLENBQUN0QyxDQUFmLEdBQW1Cc0MsY0FBYyxDQUFDM0QsTUFBbEMsR0FBMkMsS0FBS1YsNEJBQWxFO0FBQ0gsR0E1TUksQ0E2TUw7O0FBN01LLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExlYXJuIGNjLkNsYXNzOlxuLy8gIC0gW0NoaW5lc2VdIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL2NsYXNzLmh0bWxcbi8vICAtIFtFbmdsaXNoXSBodHRwOi8vZG9jcy5jb2NvczJkLXgub3JnL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9jbGFzcy5odG1sXG4vLyBMZWFybiBBdHRyaWJ1dGU6XG4vLyAgLSBbQ2hpbmVzZV0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC96aC9zY3JpcHRpbmcvcmVmZXJlbmNlL2F0dHJpYnV0ZXMuaHRtbFxuLy8gIC0gW0VuZ2xpc2hdIGh0dHA6Ly9kb2NzLmNvY29zMmQteC5vcmcvY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL3JlZmVyZW5jZS9hdHRyaWJ1dGVzLmh0bWxcbi8vIExlYXJuIGxpZmUtY3ljbGUgY2FsbGJhY2tzOlxuLy8gIC0gW0NoaW5lc2VdIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL2xpZmUtY3ljbGUtY2FsbGJhY2tzLmh0bWxcbi8vICAtIFtFbmdsaXNoXSBodHRwczovL3d3dy5jb2NvczJkLXgub3JnL2RvY3MvY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL2xpZmUtY3ljbGUtY2FsbGJhY2tzLmh0bWxcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgLy8gZm9vOiB7XG4gICAgICAgIC8vICAgICAvLyBBVFRSSUJVVEVTOlxuICAgICAgICAvLyAgICAgZGVmYXVsdDogbnVsbCwgICAgICAgIC8vIFRoZSBkZWZhdWx0IHZhbHVlIHdpbGwgYmUgdXNlZCBvbmx5IHdoZW4gdGhlIGNvbXBvbmVudCBhdHRhY2hpbmdcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0byBhIG5vZGUgZm9yIHRoZSBmaXJzdCB0aW1lXG4gICAgICAgIC8vICAgICB0eXBlOiBjYy5TcHJpdGVGcmFtZSwgLy8gb3B0aW9uYWwsIGRlZmF1bHQgaXMgdHlwZW9mIGRlZmF1bHRcbiAgICAgICAgLy8gICAgIHNlcmlhbGl6YWJsZTogdHJ1ZSwgICAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyB0cnVlXG4gICAgICAgIC8vIH0sXG4gICAgICAgIC8vIGJhcjoge1xuICAgICAgICAvLyAgICAgZ2V0ICgpIHtcbiAgICAgICAgLy8gICAgICAgICByZXR1cm4gdGhpcy5fYmFyO1xuICAgICAgICAvLyAgICAgfSxcbiAgICAgICAgLy8gICAgIHNldCAodmFsdWUpIHtcbiAgICAgICAgLy8gICAgICAgICB0aGlzLl9iYXIgPSB2YWx1ZTtcbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfSxcbiAgICAgICAgbWFpbElkOiBudWxsLFxuICAgICAgICByZWxhdGVkTWFpbFNlY3Rpb25Ob2RlOiBjYy5Ob2RlLFxuICAgICAgICByZWxhdGVkTWFpbFN5c01ncjogbnVsbCxcbiAgICAgICAgbWFpbE9wdGlvbk5vZGVQcmVmYWI6IGNjLlByZWZhYixcbiAgICAgICAgZGlzT2ZDb250ZW50QW5kT3B0aW9uU2VjdGlvbjogMjAwLFxuICAgICAgICBkaXNPZk9wdGlvbk5vZGVzOiAyNSxcbiAgICAgICAgaGVhZGVySGVpZ2h0OiA4MixcbiAgICAgICAgZm9vdGVySGVpZ2h0OiA4MFxuICAgIH0sXG5cbiAgICAvLyBMSUZFLUNZQ0xFIENBTExCQUNLUzpcblxuICAgIG9uTG9hZCAoKSB7XG4gICAgICAgIHZhciBiZyA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcImJnXCIpXG4gICAgICAgIGJnLndpZHRoID0gY2Mud2luU2l6ZS53aWR0aFxuICAgICAgICBiZy5oZWlnaHQgPSBjYy53aW5TaXplLmhlaWdodFxuICAgICAgICBiZy5vbihcInRvdWNoc3RhcnRcIixmdW5jdGlvbigpe30pXG5cbiAgICAgICAgdGhpcy5zZXR1cENvbnRlbnRTZWN0aW9uKClcbiAgICAgICAgdGhpcy5zZXR1cE9wdGlvblNlY3Rpb24oKVxuICAgICAgICB0aGlzLnNldHVwVWlCZygpXG4gICAgfSxcblxuICAgIHN0YXJ0ICgpIHtcblxuICAgIH0sXG5cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgdGhpcy5ub2RlLmRlc3Ryb3koKVxuICAgIH0sXG5cbiAgICBzZXR1cENvbnRlbnRTZWN0aW9uKCkge1xuICAgICAgICB2YXIgdGV4dENvbmZpZyA9IHJlcXVpcmUoXCJ0ZXh0Q29uZmlnXCIpXG4gICAgICAgIHZhciBtYWlsQ29uZmlnID0gcmVxdWlyZShcIm1haWxDb25maWdcIilcbiAgICAgICAgdmFyIG1haWwgPSBtYWlsQ29uZmlnW3RoaXMubWFpbElkXVxuICAgICAgICB2YXIgY29udGVudCA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcIm90aGVyc1wiKS5nZXRDaGlsZEJ5TmFtZShcImNvbnRlbnRTZWN0aW9uXCIpLmdldENoaWxkQnlOYW1lKFwidmlld1wiKS5nZXRDaGlsZEJ5TmFtZShcImNvbnRlbnRcIilcbiAgICAgICAgdmFyIHRpdGxlTGFiZWwgPSBjb250ZW50LmdldENoaWxkQnlOYW1lKFwidGl0bGVMYWJlbFwiKVxuICAgICAgICB2YXIgY29udGVudExhYmVsID0gY29udGVudC5nZXRDaGlsZEJ5TmFtZShcImNvbnRlbnRMYWJlbFwiKVxuXG4gICAgICAgIC8vIHRpdGxlTGFiZWwuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBtYWlsLnRpdGxlXG4gICAgICAgIC8vIGNvbnRlbnRMYWJlbC5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IG1haWwuY29udGVudFxuICAgICAgICB0aXRsZUxhYmVsLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gdGV4dENvbmZpZy5nZXRUZXh0QnlJZEFuZExhbmd1YWdlVHlwZShtYWlsLnRpdGxlVGV4dElkKVxuICAgICAgICBjb250ZW50TGFiZWwuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSB0ZXh0Q29uZmlnLmdldFRleHRCeUlkQW5kTGFuZ3VhZ2VUeXBlKG1haWwuY29udGVudFRleHRJZClcbiAgICAgICAgY29udGVudC5oZWlnaHQgPSAtY29udGVudExhYmVsLnkgKyBjb250ZW50TGFiZWwuaGVpZ2h0XG4gICAgfSxcblxuICAgIHNldHVwT3B0aW9uU2VjdGlvbigpIHtcbiAgICAgICAgdmFyIHRleHRDb25maWcgPSByZXF1aXJlKFwidGV4dENvbmZpZ1wiKVxuICAgICAgICB2YXIgb3B0aW9uU2VjdGlvbiA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcIm90aGVyc1wiKS5nZXRDaGlsZEJ5TmFtZShcIm9wdGlvblNlY3Rpb25cIilcbiAgICAgICAgdmFyIG1haWxDb25maWcgPSByZXF1aXJlKFwibWFpbENvbmZpZ1wiKVxuICAgICAgICB2YXIgbWFpbCA9IG1haWxDb25maWdbdGhpcy5tYWlsSWRdXG4gICAgICAgIHZhciBvcHRpb25zID0gbWFpbC5vcHRpb25zXG4gICAgICAgIG1haWwgPSByZXF1aXJlKFwiZGF0YU1nclwiKS5wbGF5ZXJEYXRhLm1haWxzW3RoaXMubWFpbElkXVxuICAgICAgICBpZiAobWFpbC5zdGF0dXMgPT0gMCkge1xuICAgICAgICAgICAgLy91bnJlYWRlZCBtYWlsXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgIHZhciBva09wdGlvbk5vZGUgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLm1haWxPcHRpb25Ob2RlUHJlZmFiKVxuICAgICAgICAgICAgICAgIHZhciBva0xhYmVsTm9kZSA9IG9rT3B0aW9uTm9kZS5nZXRDaGlsZEJ5TmFtZShcImxhYmVsXCIpXG4gICAgICAgICAgICAgICAgb2tMYWJlbE5vZGUuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSB0ZXh0Q29uZmlnLmdldFRleHRCeUlkQW5kTGFuZ3VhZ2VUeXBlKDE0NylcbiAgICAgICAgICAgICAgICB2YXIgb2tCZ05vZGUgPSBva09wdGlvbk5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJiZ1wiKVxuICAgICAgICAgICAgICAgIG9rT3B0aW9uTm9kZS53aWR0aCA9IG9rQmdOb2RlLndpZHRoXG4gICAgICAgICAgICAgICAgb2tPcHRpb25Ob2RlLmhlaWdodCA9IG9rQmdOb2RlLmhlaWdodFxuICAgICAgICAgICAgICAgIG9wdGlvblNlY3Rpb24uaGVpZ2h0ICs9IG9rT3B0aW9uTm9kZS5oZWlnaHRcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXNcbiAgICAgICAgICAgICAgICBva09wdGlvbk5vZGUub24oXCJjbGlja1wiLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvbk1haWxSZWFkZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNlbGYucmVsYXRlZE1haWxTeXNNZ3Iuc2V0T25lTWFpbFJlYWRlZChzZWxmLm1haWxJZCwgLTEsIG9uTWFpbFJlYWRlZCxzZWxmLnJlbGF0ZWRNYWlsU2VjdGlvbk5vZGUpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBva09wdGlvbk5vZGUueSA9IC0ob3B0aW9uU2VjdGlvbi5oZWlnaHQgLSBva09wdGlvbk5vZGUuaGVpZ2h0KVxuICAgICAgICAgICAgICAgIG9wdGlvblNlY3Rpb24uYWRkQ2hpbGQob2tPcHRpb25Ob2RlKVxuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiBvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9uZU9wdGlvbiA9IG9wdGlvbnNbaW5kZXhdXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbk5vZGUgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLm1haWxPcHRpb25Ob2RlUHJlZmFiKVxuICAgICAgICAgICAgICAgIHZhciBsYWJlbE5vZGUgPSBvcHRpb25Ob2RlLmdldENoaWxkQnlOYW1lKFwibGFiZWxcIilcbiAgICAgICAgICAgICAgICAvLyBsYWJlbE5vZGUuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBvbmVPcHRpb24uc2hvd1RleHRcbiAgICAgICAgICAgICAgICBsYWJlbE5vZGUuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSB0ZXh0Q29uZmlnLmdldFRleHRCeUlkQW5kTGFuZ3VhZ2VUeXBlKG9uZU9wdGlvbi5zaG93VGV4dElkKVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciBiZ05vZGUgPSBvcHRpb25Ob2RlLmdldENoaWxkQnlOYW1lKFwiYmdcIilcbiAgICAgICAgICAgICAgICBiZ05vZGUuaGVpZ2h0ID0gbGFiZWxOb2RlLmhlaWdodFxuXG4gICAgICAgICAgICAgICAgb3B0aW9uTm9kZS53aWR0aCA9IGJnTm9kZS53aWR0aFxuICAgICAgICAgICAgICAgIG9wdGlvbk5vZGUuaGVpZ2h0ID0gYmdOb2RlLmhlaWdodFxuXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uU2VjdGlvbi5oZWlnaHQgKz0gb3B0aW9uTm9kZS5oZWlnaHRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvblNlY3Rpb24uaGVpZ2h0ICs9IG9wdGlvbk5vZGUuaGVpZ2h0ICsgdGhpcy5kaXNPZk9wdGlvbk5vZGVzXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgb3B0aW9uTm9kZS55ID0gLShvcHRpb25TZWN0aW9uLmhlaWdodCAtIG9wdGlvbk5vZGUuaGVpZ2h0KVxuICAgICAgICAgICAgICAgIHZhciBvcGVyYXRpb25UeXBlID0gb25lT3B0aW9uLm9wZXJhdGlvblR5cGVcbiAgICAgICAgICAgICAgICB2YXIgb3BlcmF0aW9uUGFyYSA9IG9uZU9wdGlvbi5vcGVyYXRpb25QYXJhXG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzXG4gICAgICAgICAgICAgICAgdmFyIGJpbmRGdW5jdGlvbiA9IGZ1bmN0aW9uKGdpdmVuTm9kZSxnaXZlbk9wZXJhdGlvblR5cGUsZ2l2ZW5PcGVyYXRpb25QYXJhLGluZGV4T2ZPcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGdpdmVuTm9kZS5vbihcImNsaWNrXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbm8gbWF0dGVyIHdoYXQgb3B0aW9uIGJlIHNlbGVjdGVkLCB0aGlzIG1haWwgd2lsbCBiZSByZWFkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvbk1haWxSZWFkZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2l2ZW5PcGVyYXRpb25UeXBlID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jbG9zZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGdpdmVuT3BlcmF0aW9uVHlwZSA9PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1haWxTeXMuc2VuZE9uZU1haWwoZ2l2ZW5PcGVyYXRpb25QYXJhLm1haWxJZCwgbWFpbC50YWcsIGdpdmVuT3BlcmF0aW9uUGFyYS5kZWxheSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZShcInN5c3RlbXNNZ3JcIikubWFpbFN5c0dsb2FibGVTZW5kT25lTWFpbChnaXZlbk9wZXJhdGlvblBhcmEubWFpbElkLG1haWwudGFnLCBmdW5jdGlvbigpe30sZ2l2ZW5PcGVyYXRpb25QYXJhLmRlbGF5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNsb3NlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbGF0ZWRNYWlsU3lzTWdyLnNldE9uZU1haWxSZWFkZWQoc2VsZi5tYWlsSWQsaW5kZXhPZk9wdGlvbnMsb25NYWlsUmVhZGVkLHNlbGYucmVsYXRlZE1haWxTZWN0aW9uTm9kZSlcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYmluZEZ1bmN0aW9uKG9wdGlvbk5vZGUsIG9wZXJhdGlvblR5cGUsIG9wZXJhdGlvblBhcmEsIGluZGV4KVxuICAgICAgICAgICAgICAgIG9wdGlvblNlY3Rpb24uYWRkQ2hpbGQob3B0aW9uTm9kZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2UgaWYgKG1haWwuc3RhdHVzID09IDEpIHtcbiAgICAgICAgICAgIC8vcmVhZGVkIG1haWxcbiAgICAgICAgICAgIGlmIChtYWlsLnNlbGVjdGVkT3B0aW9uSW5kZXggIT0gLTEpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRPcHRpb25JbmRleCA9IG1haWwuc2VsZWN0ZWRPcHRpb25JbmRleFxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZE9wdGlvbiA9IG9wdGlvbnNbc2VsZWN0ZWRPcHRpb25JbmRleF1cblxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25Ob2RlID0gY2MuaW5zdGFudGlhdGUodGhpcy5tYWlsT3B0aW9uTm9kZVByZWZhYilcbiAgICAgICAgICAgICAgICB2YXIgbGFiZWxOb2RlID0gb3B0aW9uTm9kZS5nZXRDaGlsZEJ5TmFtZShcImxhYmVsXCIpXG4gICAgICAgICAgICAgICAgLy8gbGFiZWxOb2RlLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gc2VsZWN0ZWRPcHRpb24uc2hvd1RleHRcbiAgICAgICAgICAgICAgICBsYWJlbE5vZGUuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSB0ZXh0Q29uZmlnLmdldFRleHRCeUlkQW5kTGFuZ3VhZ2VUeXBlKHNlbGVjdGVkT3B0aW9uLnNob3dUZXh0SWQpXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbGFiZWxOb2RlLmNvbG9yID0gY2MuY29sb3IoMjU1LDI1NSwyNTUpXG4gICAgICAgICAgICAgICAgdmFyIGJnTm9kZSA9IG9wdGlvbk5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJiZ19yZWFkZWRcIilcbiAgICAgICAgICAgICAgICBiZ05vZGUuYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICAgIGJnTm9kZS5oZWlnaHQgPSBsYWJlbE5vZGUuaGVpZ2h0XG5cbiAgICAgICAgICAgICAgICBvcHRpb25Ob2RlLndpZHRoID0gYmdOb2RlLndpZHRoXG4gICAgICAgICAgICAgICAgb3B0aW9uTm9kZS5oZWlnaHQgPSBiZ05vZGUuaGVpZ2h0XG4gICAgICAgICAgICAgICAgb3B0aW9uU2VjdGlvbi5oZWlnaHQgKz0gb3B0aW9uTm9kZS5oZWlnaHRcbiAgICAgICAgICAgICAgICBvcHRpb25Ob2RlLmdldENvbXBvbmVudChjYy5CdXR0b24pLmludGVyYWN0YWJsZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgb3B0aW9uTm9kZS55ID0gLShvcHRpb25TZWN0aW9uLmhlaWdodCAtIG9wdGlvbk5vZGUuaGVpZ2h0KVxuICAgICAgICAgICAgICAgIG9wdGlvblNlY3Rpb24uYWRkQ2hpbGQob3B0aW9uTm9kZSlcblxuICAgICAgICAgICAgICAgIHZhciBva09wdGlvbk5vZGUgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLm1haWxPcHRpb25Ob2RlUHJlZmFiKVxuICAgICAgICAgICAgICAgIHZhciBva0xhYmVsTm9kZSA9IG9rT3B0aW9uTm9kZS5nZXRDaGlsZEJ5TmFtZShcImxhYmVsXCIpXG4gICAgICAgICAgICAgICAgb2tMYWJlbE5vZGUuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSB0ZXh0Q29uZmlnLmdldFRleHRCeUlkQW5kTGFuZ3VhZ2VUeXBlKDE0NylcbiAgICAgICAgICAgICAgICB2YXIgb2tCZ05vZGUgPSBva09wdGlvbk5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJiZ1wiKVxuICAgICAgICAgICAgICAgIG9rT3B0aW9uTm9kZS53aWR0aCA9IG9rQmdOb2RlLndpZHRoXG4gICAgICAgICAgICAgICAgb2tPcHRpb25Ob2RlLmhlaWdodCA9IG9rQmdOb2RlLmhlaWdodFxuICAgICAgICAgICAgICAgIG9wdGlvblNlY3Rpb24uaGVpZ2h0ICs9IG9rT3B0aW9uTm9kZS5oZWlnaHQgKyB0aGlzLmRpc09mT3B0aW9uTm9kZXNcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXNcbiAgICAgICAgICAgICAgICBva09wdGlvbk5vZGUub24oXCJjbGlja1wiLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgb2tPcHRpb25Ob2RlLnkgPSAtKG9wdGlvblNlY3Rpb24uaGVpZ2h0IC0gb2tPcHRpb25Ob2RlLmhlaWdodClcbiAgICAgICAgICAgICAgICBvcHRpb25TZWN0aW9uLmFkZENoaWxkKG9rT3B0aW9uTm9kZSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIG9rT3B0aW9uTm9kZSA9IGNjLmluc3RhbnRpYXRlKHRoaXMubWFpbE9wdGlvbk5vZGVQcmVmYWIpXG4gICAgICAgICAgICAgICAgdmFyIG9rTGFiZWxOb2RlID0gb2tPcHRpb25Ob2RlLmdldENoaWxkQnlOYW1lKFwibGFiZWxcIilcbiAgICAgICAgICAgICAgICBva0xhYmVsTm9kZS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHRleHRDb25maWcuZ2V0VGV4dEJ5SWRBbmRMYW5ndWFnZVR5cGUoMTQ3KVxuICAgICAgICAgICAgICAgIHZhciBva0JnTm9kZSA9IG9rT3B0aW9uTm9kZS5nZXRDaGlsZEJ5TmFtZShcImJnXCIpXG4gICAgICAgICAgICAgICAgb2tPcHRpb25Ob2RlLndpZHRoID0gb2tCZ05vZGUud2lkdGhcbiAgICAgICAgICAgICAgICBva09wdGlvbk5vZGUuaGVpZ2h0ID0gb2tCZ05vZGUuaGVpZ2h0XG4gICAgICAgICAgICAgICAgb3B0aW9uU2VjdGlvbi5oZWlnaHQgKz0gb2tPcHRpb25Ob2RlLmhlaWdodFxuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpc1xuICAgICAgICAgICAgICAgIG9rT3B0aW9uTm9kZS5vbihcImNsaWNrXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jbG9zZSgpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBva09wdGlvbk5vZGUueSA9IC0ob3B0aW9uU2VjdGlvbi5oZWlnaHQgLSBva09wdGlvbk5vZGUuaGVpZ2h0KVxuICAgICAgICAgICAgICAgIG9wdGlvblNlY3Rpb24uYWRkQ2hpbGQob2tPcHRpb25Ob2RlKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgIH0sXG5cbiAgICBzZXR1cFVpQmcoKSB7XG4gICAgICAgIHZhciB1aWJnID0gdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwib3RoZXJzXCIpLmdldENoaWxkQnlOYW1lKFwidWliZ1wiKVxuICAgICAgICB2YXIgY29udGVudFNlY3Rpb24gPSB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJvdGhlcnNcIikuZ2V0Q2hpbGRCeU5hbWUoXCJjb250ZW50U2VjdGlvblwiKVxuICAgICAgICB2YXIgb3B0aW9uU2VjdGlvbiA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcIm90aGVyc1wiKS5nZXRDaGlsZEJ5TmFtZShcIm9wdGlvblNlY3Rpb25cIilcblxuICAgICAgICB1aWJnLmhlaWdodCA9IHRoaXMuaGVhZGVySGVpZ2h0ICsgY29udGVudFNlY3Rpb24uaGVpZ2h0ICsgdGhpcy5kaXNPZkNvbnRlbnRBbmRPcHRpb25TZWN0aW9uICsgb3B0aW9uU2VjdGlvbi5oZWlnaHQgKyB0aGlzLmZvb3RlckhlaWdodFxuICAgICAgICBjb250ZW50U2VjdGlvbi55ID0gdWliZy5oZWlnaHQvMiAtIHRoaXMuaGVhZGVySGVpZ2h0XG4gICAgICAgIG9wdGlvblNlY3Rpb24ueSA9IGNvbnRlbnRTZWN0aW9uLnkgLSBjb250ZW50U2VjdGlvbi5oZWlnaHQgLSB0aGlzLmRpc09mQ29udGVudEFuZE9wdGlvblNlY3Rpb25cbiAgICB9XG4gICAgLy8gdXBkYXRlIChkdCkge30sXG59KTtcbiJdfQ==