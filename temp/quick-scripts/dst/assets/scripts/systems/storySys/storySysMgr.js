
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/systems/storySys/storySysMgr.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'e7a64OS7/RMK7rBUEbD4B4U', 'storySysMgr');
// scripts/systems/storySys/storySysMgr.js

"use strict";

// Learn cc.Class:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html
cc.Class({
  "extends": cc.Component,
  properties: {
    // foo: {
    //     // ATTRIBUTES:
    //     default: null,        // The default value will be used only when the component attaching
    //                           // to a node for the first time
    //     type: cc.SpriteFrame, // optional, default is typeof default
    //     serializable: true,   // optional, default is true
    // },
    // bar: {
    //     get () {
    //         return this._bar;
    //     },
    //     set (value) {
    //         this._bar = value;
    //     }
    // },
    contentNode: cc.Node,
    storyTextNodePrefab: cc.Prefab,
    disBetweenStoryTextNodes: 50,
    continueLabelNode: cc.Node,
    completeButtonNode: cc.Node,
    startDelayTime: 1,
    storyId: null,
    storyTextNodes: [],
    status: {
      get: function get() {
        return this._status;
      },
      set: function set(value) {
        this._status = value; // 1 = start showing a node
        // 2 = showing complete , wating for tap to next
        // 3 = all nodes showing complete , wating for click button to complete

        switch (value) {
          case 1:
            this.continueLabelNode.active = false;
            this.completeButtonNode.active = false;
            this.node.getChildByName("tapMonitoredNode").active = false;
            break;

          case 2:
            this.continueLabelNode.active = true;
            this.completeButtonNode.active = false;
            this.node.getChildByName("tapMonitoredNode").active = true;
            break;

          case 3:
            this.continueLabelNode.active = false;
            this.completeButtonNode.active = true;
            this.node.getChildByName("tapMonitoredNode").active = false;
            break;

          default:
            cc.log("STORYSYSMGR: WRONG STATUS VALUE PROVIDED");
        }
      }
    },
    header: 100,
    footer: 100,
    sectionDis: 50,
    totalHeight: 0,
    totalTextNodeNum: null,
    currentNum: null,
    textIds: null
  },
  // LIFE-CYCLE CALLBACKS:
  onLoad: function onLoad() {
    var self = this;
    var bg = this.node.getChildByName("bg");
    bg.width = cc.winSize.width;
    bg.height = cc.winSize.height;
    this.node.width = bg.width;
    this.node.height = bg.height;
    var monitoredNode = this.node.getChildByName("tapMonitoredNode");
    monitoredNode.width = bg.width;
    monitoredNode.height = bg.height; //cc.log(bg.width,bg.height)

    monitoredNode.on("touchstart", function () {
      if (self.status == 2) {
        self.currentNum += 1;

        var str = require("textConfig").getTextByIdAndLanguageType(self.textIds[self.currentNum - 1]);

        self._showOneStoryText(str);
      }
    }, this);
    this.completeButtonNode.on("click", function () {
      if (self.status == 3) {
        self.completeStory();
      }
    });
    this.completeButtonNode.getChildByName("New Label").getComponent(cc.Label).string = require("textConfig").getTextByIdAndLanguageType(122);
    cc.tween(this.continueLabelNode).repeatForever(cc.tween().to(0.3, {
      opacity: 0
    }).to(0.3, {
      opacity: 255
    })).start();
    var scrollContainer = this.node.getChildByName("scrollContainer");
    scrollContainer.y = bg.height / 2 - this.footer;
    this.continueLabelNode.y = -bg.height / 2 + this.footer + this.completeButtonNode.height / 2;
    this.completeButtonNode.y = -bg.height / 2 + this.footer + this.completeButtonNode.height / 2;
    var tempHeight = bg.height - this.header - this.footer - this.completeButtonNode.height - this.sectionDis;
    scrollContainer.height = tempHeight;
    scrollContainer.getChildByName("view").height = tempHeight;
    this.contentNode.height = tempHeight;
  },
  start: function start() {
    this.showStory();
  },
  showStory: function showStory() {
    if (this.storyId == null) {
      cc.log("NO STORY ID PROVIDED");
      return;
    }

    var storyConfig = require("storyConfig");

    var key = "story_" + this.storyId.toString();
    var config = storyConfig[key];
    var textIds = config.textIds;
    this.textIds = textIds;
    this.totalTextNodeNum = textIds.length;
    this.currentNum = 1;

    var str = require("textConfig").getTextByIdAndLanguageType(textIds[0]);

    var self = this;
    cc.tween(this.node).delay(self.startDelayTime).call(function () {
      self._showOneStoryText(str);
    }).start();
  },
  completeStory: function completeStory() {
    var networkMgr = require("networkMgr");

    var messageObj = networkMgr.makeMessageObj("storyModule", "completeCurrentMessageType");
    messageObj.message.playerId = require("dataMgr").playerData.id;

    messageObj.successCallBack = function (xhr) {
      var response = xhr.responseText;
      response = JSON.parse(response);

      if (response.type == "success") {
        var storyId = response.storyId;
        require("dataMgr").playerData.storySysId = storyId;

        require("systemsMgr").closeSystem("storySys", 3);
      }
    };

    this.completeButtonNode.getComponent(cc.Button).interactable = false;
    networkMgr.sendMessageByMsgObj(messageObj);
  },
  _showOneStoryText: function _showOneStoryText(str) {
    this.status = 1;
    var node = cc.instantiate(this.storyTextNodePrefab);
    node.getComponent(cc.Label).string = str;

    node.getComponent(cc.Label)._forceUpdateRenderData();

    node.y = -this.totalHeight;
    this.totalHeight += node.height + this.disBetweenStoryTextNodes;

    if (this.contentNode.height < this.totalHeight) {
      this.contentNode.height = this.totalHeight;
      this.node.getChildByName("scrollContainer").getComponent(cc.ScrollView).vertical = true;
    }

    node.opacity = 0;
    this.contentNode.addChild(node);
    var self = this;
    cc.tween(node).to(0.5, {
      opacity: 255
    }).call(function () {
      if (self.currentNum == self.totalTextNodeNum) {
        self.status = 3;
      } else {
        self.status = 2;
      }
    }).start();
  },
  onWillOpend: function onWillOpend(givenStoryId) {
    this.storyId = givenStoryId;
  } // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL3N5c3RlbXMvc3RvcnlTeXMvc3RvcnlTeXNNZ3IuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJjb250ZW50Tm9kZSIsIk5vZGUiLCJzdG9yeVRleHROb2RlUHJlZmFiIiwiUHJlZmFiIiwiZGlzQmV0d2VlblN0b3J5VGV4dE5vZGVzIiwiY29udGludWVMYWJlbE5vZGUiLCJjb21wbGV0ZUJ1dHRvbk5vZGUiLCJzdGFydERlbGF5VGltZSIsInN0b3J5SWQiLCJzdG9yeVRleHROb2RlcyIsInN0YXR1cyIsImdldCIsIl9zdGF0dXMiLCJzZXQiLCJ2YWx1ZSIsImFjdGl2ZSIsIm5vZGUiLCJnZXRDaGlsZEJ5TmFtZSIsImxvZyIsImhlYWRlciIsImZvb3RlciIsInNlY3Rpb25EaXMiLCJ0b3RhbEhlaWdodCIsInRvdGFsVGV4dE5vZGVOdW0iLCJjdXJyZW50TnVtIiwidGV4dElkcyIsIm9uTG9hZCIsInNlbGYiLCJiZyIsIndpZHRoIiwid2luU2l6ZSIsImhlaWdodCIsIm1vbml0b3JlZE5vZGUiLCJvbiIsInN0ciIsInJlcXVpcmUiLCJnZXRUZXh0QnlJZEFuZExhbmd1YWdlVHlwZSIsIl9zaG93T25lU3RvcnlUZXh0IiwiY29tcGxldGVTdG9yeSIsImdldENvbXBvbmVudCIsIkxhYmVsIiwic3RyaW5nIiwidHdlZW4iLCJyZXBlYXRGb3JldmVyIiwidG8iLCJvcGFjaXR5Iiwic3RhcnQiLCJzY3JvbGxDb250YWluZXIiLCJ5IiwidGVtcEhlaWdodCIsInNob3dTdG9yeSIsInN0b3J5Q29uZmlnIiwia2V5IiwidG9TdHJpbmciLCJjb25maWciLCJsZW5ndGgiLCJkZWxheSIsImNhbGwiLCJuZXR3b3JrTWdyIiwibWVzc2FnZU9iaiIsIm1ha2VNZXNzYWdlT2JqIiwibWVzc2FnZSIsInBsYXllcklkIiwicGxheWVyRGF0YSIsImlkIiwic3VjY2Vzc0NhbGxCYWNrIiwieGhyIiwicmVzcG9uc2UiLCJyZXNwb25zZVRleHQiLCJKU09OIiwicGFyc2UiLCJ0eXBlIiwic3RvcnlTeXNJZCIsImNsb3NlU3lzdGVtIiwiQnV0dG9uIiwiaW50ZXJhY3RhYmxlIiwic2VuZE1lc3NhZ2VCeU1zZ09iaiIsImluc3RhbnRpYXRlIiwiX2ZvcmNlVXBkYXRlUmVuZGVyRGF0YSIsIlNjcm9sbFZpZXciLCJ2ZXJ0aWNhbCIsImFkZENoaWxkIiwib25XaWxsT3BlbmQiLCJnaXZlblN0b3J5SWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBQyxJQUFBQSxXQUFXLEVBQUVKLEVBQUUsQ0FBQ0ssSUFoQlI7QUFpQlJDLElBQUFBLG1CQUFtQixFQUFFTixFQUFFLENBQUNPLE1BakJoQjtBQWtCUkMsSUFBQUEsd0JBQXdCLEVBQUUsRUFsQmxCO0FBbUJSQyxJQUFBQSxpQkFBaUIsRUFBRVQsRUFBRSxDQUFDSyxJQW5CZDtBQW9CUkssSUFBQUEsa0JBQWtCLEVBQUVWLEVBQUUsQ0FBQ0ssSUFwQmY7QUFxQlJNLElBQUFBLGNBQWMsRUFBRSxDQXJCUjtBQXNCUkMsSUFBQUEsT0FBTyxFQUFFLElBdEJEO0FBd0JSQyxJQUFBQSxjQUFjLEVBQUUsRUF4QlI7QUF5QlJDLElBQUFBLE1BQU0sRUFBRTtBQUNKQyxNQUFBQSxHQURJLGlCQUNFO0FBQ0YsZUFBTyxLQUFLQyxPQUFaO0FBQ0gsT0FIRztBQUlKQyxNQUFBQSxHQUpJLGVBSUFDLEtBSkEsRUFJTztBQUNQLGFBQUtGLE9BQUwsR0FBZUUsS0FBZixDQURPLENBRVA7QUFDQTtBQUNBOztBQUNBLGdC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QUFJLENBQUNqQixNQUFMLEdBQWMsQ0FBZDtBQUNIO0FBQ0osS0FUTCxFQVVLb0MsS0FWTDtBQVdILEdBMUxJO0FBNExMb0MsRUFBQUEsV0E1TEssdUJBNExPQyxZQTVMUCxFQTRMcUI7QUFDdEIsU0FBSzNFLE9BQUwsR0FBZTJFLFlBQWY7QUFDSCxHQTlMSSxDQStMTDs7QUEvTEssQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGVhcm4gY2MuQ2xhc3M6XG4vLyAgLSBbQ2hpbmVzZV0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC96aC9zY3JpcHRpbmcvY2xhc3MuaHRtbFxuLy8gIC0gW0VuZ2xpc2hdIGh0dHA6Ly9kb2NzLmNvY29zMmQteC5vcmcvY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL2NsYXNzLmh0bWxcbi8vIExlYXJuIEF0dHJpYnV0ZTpcbi8vICAtIFtDaGluZXNlXSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL3NjcmlwdGluZy9yZWZlcmVuY2UvYXR0cmlidXRlcy5odG1sXG4vLyAgLSBbRW5nbGlzaF0gaHR0cDovL2RvY3MuY29jb3MyZC14Lm9yZy9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvcmVmZXJlbmNlL2F0dHJpYnV0ZXMuaHRtbFxuLy8gTGVhcm4gbGlmZS1jeWNsZSBjYWxsYmFja3M6XG4vLyAgLSBbQ2hpbmVzZV0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC96aC9zY3JpcHRpbmcvbGlmZS1jeWNsZS1jYWxsYmFja3MuaHRtbFxuLy8gIC0gW0VuZ2xpc2hdIGh0dHBzOi8vd3d3LmNvY29zMmQteC5vcmcvZG9jcy9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvbGlmZS1jeWNsZS1jYWxsYmFja3MuaHRtbFxuXG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICAvLyBmb286IHtcbiAgICAgICAgLy8gICAgIC8vIEFUVFJJQlVURVM6XG4gICAgICAgIC8vICAgICBkZWZhdWx0OiBudWxsLCAgICAgICAgLy8gVGhlIGRlZmF1bHQgdmFsdWUgd2lsbCBiZSB1c2VkIG9ubHkgd2hlbiB0aGUgY29tcG9uZW50IGF0dGFjaGluZ1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRvIGEgbm9kZSBmb3IgdGhlIGZpcnN0IHRpbWVcbiAgICAgICAgLy8gICAgIHR5cGU6IGNjLlNwcml0ZUZyYW1lLCAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyB0eXBlb2YgZGVmYXVsdFxuICAgICAgICAvLyAgICAgc2VyaWFsaXphYmxlOiB0cnVlLCAgIC8vIG9wdGlvbmFsLCBkZWZhdWx0IGlzIHRydWVcbiAgICAgICAgLy8gfSxcbiAgICAgICAgLy8gYmFyOiB7XG4gICAgICAgIC8vICAgICBnZXQgKCkge1xuICAgICAgICAvLyAgICAgICAgIHJldHVybiB0aGlzLl9iYXI7XG4gICAgICAgIC8vICAgICB9LFxuICAgICAgICAvLyAgICAgc2V0ICh2YWx1ZSkge1xuICAgICAgICAvLyAgICAgICAgIHRoaXMuX2JhciA9IHZhbHVlO1xuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyB9LFxuICAgICAgICBjb250ZW50Tm9kZTogY2MuTm9kZSxcbiAgICAgICAgc3RvcnlUZXh0Tm9kZVByZWZhYjogY2MuUHJlZmFiLFxuICAgICAgICBkaXNCZXR3ZWVuU3RvcnlUZXh0Tm9kZXM6IDUwLFxuICAgICAgICBjb250aW51ZUxhYmVsTm9kZTogY2MuTm9kZSxcbiAgICAgICAgY29tcGxldGVCdXR0b25Ob2RlOiBjYy5Ob2RlLFxuICAgICAgICBzdGFydERlbGF5VGltZTogMSxcbiAgICAgICAgc3RvcnlJZDogbnVsbCxcblxuICAgICAgICBzdG9yeVRleHROb2RlczogW10sXG4gICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGF0dXNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQodmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSB2YWx1ZVxuICAgICAgICAgICAgICAgIC8vIDEgPSBzdGFydCBzaG93aW5nIGEgbm9kZVxuICAgICAgICAgICAgICAgIC8vIDIgPSBzaG93aW5nIGNvbXBsZXRlICwgd2F0aW5nIGZvciB0YXAgdG8gbmV4dFxuICAgICAgICAgICAgICAgIC8vIDMgPSBhbGwgbm9kZXMgc2hvd2luZyBjb21wbGV0ZSAsIHdhdGluZyBmb3IgY2xpY2sgYnV0dG9uIHRvIGNvbXBsZXRlXG4gICAgICAgICAgICAgICAgc3dpdGNoKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGludWVMYWJlbE5vZGUuYWN0aXZlID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVCdXR0b25Ob2RlLmFjdGl2ZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJ0YXBNb25pdG9yZWROb2RlXCIpLmFjdGl2ZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRpbnVlTGFiZWxOb2RlLmFjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVCdXR0b25Ob2RlLmFjdGl2ZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJ0YXBNb25pdG9yZWROb2RlXCIpLmFjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGludWVMYWJlbE5vZGUuYWN0aXZlID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVCdXR0b25Ob2RlLmFjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInRhcE1vbml0b3JlZE5vZGVcIikuYWN0aXZlID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5sb2coXCJTVE9SWVNZU01HUjogV1JPTkcgU1RBVFVTIFZBTFVFIFBST1ZJREVEXCIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBoZWFkZXI6IDEwMCxcbiAgICAgICAgZm9vdGVyOiAxMDAsXG4gICAgICAgIHNlY3Rpb25EaXM6IDUwLFxuXG4gICAgICAgIHRvdGFsSGVpZ2h0OiAwLFxuICAgICAgICB0b3RhbFRleHROb2RlTnVtOiBudWxsLFxuICAgICAgICBjdXJyZW50TnVtOiBudWxsLFxuICAgICAgICB0ZXh0SWRzOiBudWxsXG4gICAgfSxcblxuICAgIC8vIExJRkUtQ1lDTEUgQ0FMTEJBQ0tTOlxuXG4gICAgb25Mb2FkICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzXG4gICAgICAgIHZhciBiZyA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcImJnXCIpXG4gICAgICAgIGJnLndpZHRoID0gY2Mud2luU2l6ZS53aWR0aFxuICAgICAgICBiZy5oZWlnaHQgPSBjYy53aW5TaXplLmhlaWdodFxuICAgICAgICB0aGlzLm5vZGUud2lkdGggPSBiZy53aWR0aFxuICAgICAgICB0aGlzLm5vZGUuaGVpZ2h0ID0gYmcuaGVpZ2h0XG4gICAgICAgIHZhciBtb25pdG9yZWROb2RlID0gdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwidGFwTW9uaXRvcmVkTm9kZVwiKVxuICAgICAgICBtb25pdG9yZWROb2RlLndpZHRoID0gYmcud2lkdGhcbiAgICAgICAgbW9uaXRvcmVkTm9kZS5oZWlnaHQgPSBiZy5oZWlnaHRcblxuICAgICAgICAvL2NjLmxvZyhiZy53aWR0aCxiZy5oZWlnaHQpXG4gICAgICAgIG1vbml0b3JlZE5vZGUub24oXCJ0b3VjaHN0YXJ0XCIsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmIChzZWxmLnN0YXR1cyA9PSAyKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50TnVtICs9IDFcbiAgICAgICAgICAgICAgICB2YXIgc3RyID0gcmVxdWlyZShcInRleHRDb25maWdcIikuZ2V0VGV4dEJ5SWRBbmRMYW5ndWFnZVR5cGUoc2VsZi50ZXh0SWRzW3NlbGYuY3VycmVudE51bSAtIDFdKVxuICAgICAgICAgICAgICAgIHNlbGYuX3Nob3dPbmVTdG9yeVRleHQoc3RyKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LHRoaXMpXG4gICAgICAgIHRoaXMuY29tcGxldGVCdXR0b25Ob2RlLm9uKFwiY2xpY2tcIixmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHNlbGYuc3RhdHVzID09IDMpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmNvbXBsZXRlU3RvcnkoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICB0aGlzLmNvbXBsZXRlQnV0dG9uTm9kZS5nZXRDaGlsZEJ5TmFtZShcIk5ldyBMYWJlbFwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHJlcXVpcmUoXCJ0ZXh0Q29uZmlnXCIpLmdldFRleHRCeUlkQW5kTGFuZ3VhZ2VUeXBlKDEyMilcblxuICAgICAgICBjYy50d2Vlbih0aGlzLmNvbnRpbnVlTGFiZWxOb2RlKVxuICAgICAgICAgICAgLnJlcGVhdEZvcmV2ZXIoY2MudHdlZW4oKVxuICAgICAgICAgICAgICAgICAgICAudG8oMC4zLCB7b3BhY2l0eTogMH0pXG4gICAgICAgICAgICAgICAgICAgIC50bygwLjMsIHtvcGFjaXR5OiAyNTV9KSAgICBcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zdGFydCgpXG5cbiAgICAgICAgdmFyIHNjcm9sbENvbnRhaW5lciA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInNjcm9sbENvbnRhaW5lclwiKVxuICAgICAgICBzY3JvbGxDb250YWluZXIueSA9IGJnLmhlaWdodCAvIDIgLSB0aGlzLmZvb3RlclxuICAgICAgICB0aGlzLmNvbnRpbnVlTGFiZWxOb2RlLnkgPSAtYmcuaGVpZ2h0IC8gMiArIHRoaXMuZm9vdGVyICsgdGhpcy5jb21wbGV0ZUJ1dHRvbk5vZGUuaGVpZ2h0IC8gMlxuICAgICAgICB0aGlzLmNvbXBsZXRlQnV0dG9uTm9kZS55ID0gLWJnLmhlaWdodCAvIDIgKyB0aGlzLmZvb3RlciArIHRoaXMuY29tcGxldGVCdXR0b25Ob2RlLmhlaWdodCAvIDJcblxuICAgICAgICB2YXIgdGVtcEhlaWdodCA9IGJnLmhlaWdodCAtIHRoaXMuaGVhZGVyIC0gdGhpcy5mb290ZXIgLSB0aGlzLmNvbXBsZXRlQnV0dG9uTm9kZS5oZWlnaHQgLSB0aGlzLnNlY3Rpb25EaXNcbiAgICAgICAgc2Nyb2xsQ29udGFpbmVyLmhlaWdodCA9IHRlbXBIZWlnaHRcbiAgICAgICAgc2Nyb2xsQ29udGFpbmVyLmdldENoaWxkQnlOYW1lKFwidmlld1wiKS5oZWlnaHQgPSB0ZW1wSGVpZ2h0XG4gICAgICAgIHRoaXMuY29udGVudE5vZGUuaGVpZ2h0ID0gdGVtcEhlaWdodFxuICAgIH0sXG5cbiAgICBzdGFydCAoKSB7XG5cbiAgICAgICAgdGhpcy5zaG93U3RvcnkoKVxuICAgIH0sXG5cbiAgICBzaG93U3RvcnkoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0b3J5SWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgY2MubG9nKFwiTk8gU1RPUlkgSUQgUFJPVklERURcIilcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIHZhciBzdG9yeUNvbmZpZyA9IHJlcXVpcmUoXCJzdG9yeUNvbmZpZ1wiKVxuICAgICAgICB2YXIga2V5ID0gXCJzdG9yeV9cIiArIHRoaXMuc3RvcnlJZC50b1N0cmluZygpXG4gICAgICAgIHZhciBjb25maWcgPSBzdG9yeUNvbmZpZ1trZXldXG4gICAgICAgIHZhciB0ZXh0SWRzID0gY29uZmlnLnRleHRJZHNcbiAgICAgICAgdGhpcy50ZXh0SWRzID0gdGV4dElkc1xuICAgICAgICB0aGlzLnRvdGFsVGV4dE5vZGVOdW0gPSB0ZXh0SWRzLmxlbmd0aFxuICAgICAgICBcbiAgICAgICAgdGhpcy5jdXJyZW50TnVtID0gMVxuICAgICAgICB2YXIgc3RyID0gcmVxdWlyZShcInRleHRDb25maWdcIikuZ2V0VGV4dEJ5SWRBbmRMYW5ndWFnZVR5cGUodGV4dElkc1swXSlcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzXG4gICAgICAgIGNjLnR3ZWVuKHRoaXMubm9kZSlcbiAgICAgICAgICAgIC5kZWxheShzZWxmLnN0YXJ0RGVsYXlUaW1lKVxuICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzZWxmLl9zaG93T25lU3RvcnlUZXh0KHN0cilcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3RhcnQoKVxuICAgIH0sXG5cbiAgICBjb21wbGV0ZVN0b3J5KCkge1xuICAgICAgICB2YXIgbmV0d29ya01nciA9IHJlcXVpcmUoXCJuZXR3b3JrTWdyXCIpXG4gICAgICAgIHZhciBtZXNzYWdlT2JqID0gbmV0d29ya01nci5tYWtlTWVzc2FnZU9iaihcInN0b3J5TW9kdWxlXCIsXCJjb21wbGV0ZUN1cnJlbnRNZXNzYWdlVHlwZVwiKVxuICAgICAgICBtZXNzYWdlT2JqLm1lc3NhZ2UucGxheWVySWQgPSByZXF1aXJlKFwiZGF0YU1nclwiKS5wbGF5ZXJEYXRhLmlkXG4gICAgICAgIG1lc3NhZ2VPYmouc3VjY2Vzc0NhbGxCYWNrID0gZnVuY3Rpb24oeGhyKSB7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB4aHIucmVzcG9uc2VUZXh0XG4gICAgICAgICAgICByZXNwb25zZSA9IEpTT04ucGFyc2UocmVzcG9uc2UpXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UudHlwZSA9PSBcInN1Y2Nlc3NcIikge1xuICAgICAgICAgICAgICAgIHZhciBzdG9yeUlkID0gcmVzcG9uc2Uuc3RvcnlJZFxuICAgICAgICAgICAgICAgIHJlcXVpcmUoXCJkYXRhTWdyXCIpLnBsYXllckRhdGEuc3RvcnlTeXNJZCA9IHN0b3J5SWRcbiAgICAgICAgICAgICAgICByZXF1aXJlKFwic3lzdGVtc01nclwiKS5jbG9zZVN5c3RlbShcInN0b3J5U3lzXCIsMylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5jb21wbGV0ZUJ1dHRvbk5vZGUuZ2V0Q29tcG9uZW50KGNjLkJ1dHRvbikuaW50ZXJhY3RhYmxlID0gZmFsc2VcbiAgICAgICAgbmV0d29ya01nci5zZW5kTWVzc2FnZUJ5TXNnT2JqKG1lc3NhZ2VPYmopXG4gICAgfSxcblxuICAgIF9zaG93T25lU3RvcnlUZXh0KHN0cikge1xuICAgICAgICB0aGlzLnN0YXR1cyA9IDFcbiAgICAgICAgdmFyIG5vZGUgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLnN0b3J5VGV4dE5vZGVQcmVmYWIpXG4gICAgICAgIG5vZGUuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBzdHJcbiAgICAgICAgbm9kZS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLl9mb3JjZVVwZGF0ZVJlbmRlckRhdGEoKVxuICAgICAgICBub2RlLnkgPSAtdGhpcy50b3RhbEhlaWdodFxuXG4gICAgICAgIHRoaXMudG90YWxIZWlnaHQgKz0gbm9kZS5oZWlnaHQgKyB0aGlzLmRpc0JldHdlZW5TdG9yeVRleHROb2Rlc1xuICAgICAgICBpZiAodGhpcy5jb250ZW50Tm9kZS5oZWlnaHQgPCB0aGlzLnRvdGFsSGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnROb2RlLmhlaWdodCA9IHRoaXMudG90YWxIZWlnaHRcbiAgICAgICAgICAgIHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInNjcm9sbENvbnRhaW5lclwiKS5nZXRDb21wb25lbnQoY2MuU2Nyb2xsVmlldykudmVydGljYWwgPSB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgbm9kZS5vcGFjaXR5ID0gMFxuICAgICAgICB0aGlzLmNvbnRlbnROb2RlLmFkZENoaWxkKG5vZGUpXG4gICAgICAgIHZhciBzZWxmID0gdGhpc1xuICAgICAgICBjYy50d2Vlbihub2RlKVxuICAgICAgICAgICAgLnRvKDAuNSx7b3BhY2l0eTogMjU1fSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuY3VycmVudE51bSA9PSBzZWxmLnRvdGFsVGV4dE5vZGVOdW0pIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zdGF0dXMgPSAzXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnN0YXR1cyA9IDJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0YXJ0KClcbiAgICB9LFxuXG4gICAgb25XaWxsT3BlbmQoZ2l2ZW5TdG9yeUlkKSB7XG4gICAgICAgIHRoaXMuc3RvcnlJZCA9IGdpdmVuU3RvcnlJZFxuICAgIH1cbiAgICAvLyB1cGRhdGUgKGR0KSB7fSxcbn0pO1xuIl19