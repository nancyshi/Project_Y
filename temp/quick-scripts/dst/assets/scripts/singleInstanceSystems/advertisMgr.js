
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/singleInstanceSystems/advertisMgr.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'd2cc9xBWpRNy65AgLl//eBO', 'advertisMgr');
// scripts/singleInstanceSystems/advertisMgr.js

"use strict";

// Learn cc.Class:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html
var AdvertisMgr = cc.Class({
  "extends": cc.Component,
  properties: {
    // foo: {
    //     // ATTRIBUTES:
    //     default: null,        // The default value will be used only when the component attaching
    //                           // to a node for the first time
    //     type: cc.SpriteFrame, // optional, default is typeof default
    //     serializable: true,   // optional, default is true
    // },
    // bar: {
    //     get () {
    //         return this._bar;
    //     },
    //     set (value) {
    //         this._bar = value;
    //     }
    // },
    videoAd: null,
    delegate: null,
    wechatAdId: "xxxxx",
    isReady: {
      get: function get() {
        return this._isReady;
      },
      set: function set(value) {
        this._isReady = value; //1 = ok , 2 = loading 3 = erro

        if (value == 1 && this.showStatus == 1) {
          sdkbox.PluginAdMob.show("rewarded");
        } else if (value == 3 && this.showStatus == 1) {
          this.showStatus = 0;
          this.removeActivityNode();

          require("notificationMgr").showNoti("something wrong with ad system , retry later");
        } else if (value == 2 && this.showStatus == 1) {
          this.showActivityNode();
        }
      }
    },
    showStatus: {
      get: function get() {
        return this._showStatus;
      },
      set: function set(value) {
        this._showStatus = value; //0 = init 1 = will show 2 = showing
      }
    },
    activityNode: null,
    isRewardSend: false
  },
  showActivityNode: function showActivityNode() {
    var activityNodePrefab = require("resMgr").reses["activityNodePrefab"];

    var activityNode = cc.instantiate(activityNodePrefab);
    var bg = activityNode.getChildByName("bg");
    bg.width = cc.winSize.width;
    bg.height = cc.winSize.height;
    bg.on("touchstart", function () {});
    var activity = activityNode.getChildByName("activity");
    cc.tween(activity).repeatForever(cc.tween().by(2, {
      angle: 360
    })).start();
    this.activityNode = activityNode;
    cc.director.getScene().getChildByName("Canvas").addChild(this.activityNode);
  },
  removeActivityNode: function removeActivityNode() {
    if (this.activityNode != null && this.activityNode.parent != null) {
      this.activityNode.destroy();
      this.activityNode.removeFromParent();
      this.activityNode = null;
    }
  },
  onVideoAdEnd: function onVideoAdEnd() {
    if (this.delegate != null && typeof this.delegate.onVideoAdEnd == "function") {
      this.delegate.onVideoAdEnd();
    }
  },
  onVideoAdNotEnd: function onVideoAdNotEnd() {
    var defaultNoti = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

    if (defaultNoti == true) {
      var notificationSys = require("notificationMgr");

      notificationSys.showNoti("看完视频才能获得奖励哦~");
    }

    if (this.delegate != null && typeof this.delegate.onVideoAdNotEnd == "function") {
      this.delegate.onVideoAdNotEnd();
    }
  },
  onVideoAdLoadError: function onVideoAdLoadError(err) {
    console.log("拉取广告失败");

    if (this.delegate != null && typeof this.delegate.onVideoAdLoadError == "function") {
      this.delegate.onVideoAdLoadError(err);
    }
  },
  onVideoAdShowError: function onVideoAdShowError(err) {
    if (this.delegate != null && typeof this.delegate.onVideoAdShowError == "function") {
      this.delegate.onVideoAdShowError(err);
    }
  },
  initAds: function initAds() {
    if (this.videoAd == null) {
      if (cc.sys.platform == cc.sys.WECHAT_GAME) {
        var self = this;
        this.videoAd = wx.createRewardedVideoAd({
          adUnitId: this.wechatAdId
        });
        this.videoAd.onLoad(function () {
          console.log("拉取广告成功");
        });
        this.videoAd.onError(function (err) {
          self.onVideoAdLoadError(err);
        });
        this.videoAd.onClose(function (res) {
          if (res && res.isEnded) {
            self.onVideoAdEnd();
          } else {
            self.onVideoAdNotEnd();
          }
        });
      } else if (cc.sys.os == cc.sys.OS_IOS || cc.sys.os == cc.sys.OS_ANDROID) {
        var self = this;
        sdkbox.PluginAdMob.setListener({
          adViewDidReceiveAd: function adViewDidReceiveAd(name) {
            self.isReady = 1;
          },
          adViewDidFailToReceiveAdWithError: function adViewDidFailToReceiveAdWithError(name, msg) {
            self.isReady = 3;
            self.onVideoAdLoadError(msg);
          },
          adViewWillPresentScreen: function adViewWillPresentScreen(name) {
            self.removeActivityNode();
            self.showStatus = 2;
            self.isRewardSend = false;
            cc.audioEngine.pauseAll();
          },
          adViewDidDismissScreen: function adViewDidDismissScreen(name) {
            self.showStatus = 0;

            if (self.isRewardSend == false) {
              self.onVideoAdNotEnd(true);
            }

            self.isReady = 2;
            sdkbox.PluginAdMob.cache("rewarded");
            cc.audioEngine.resumeAll();
          },
          adViewWillDismissScreen: function adViewWillDismissScreen(name) {},
          adViewWillLeaveApplication: function adViewWillLeaveApplication(name) {},
          reward: function reward(name, currency, amount) {
            self.isRewardSend = true;
            self.onVideoAdEnd();
          }
        });
        this.isReady = 2;
        sdkbox.PluginAdMob.init();
        sdkbox.PluginAdMob.cache("rewarded");
      }
    }
  },
  showVideoAd: function showVideoAd() {
    if (cc.sys.platform == cc.sys.WECHAT_GAME) {
      var self = this;
      this.videoAd.load().then(function () {
        self.videoAd.show();
      })["catch"](function (err) {
        self.onVideoAdShowError(err);
      });
    } else if (cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.OS_IOS) {
      this.showStatus = 1;
      cc.log(this.isReady + " : current isready");

      if (this.isReady == 1) {
        this.showActivityNode();
        sdkbox.PluginAdMob.show("rewarded");
      } else if (this.isReady == 2) {
        //just wait set event of isReady to 1
        this.showActivityNode();
      } else if (this.isReady == 3) {
        //reload once and then show
        this.isReady = 2;
        sdkbox.PluginAdMob.cache("rewarded"); //wait set event of isReady to 1
      }
    }
  }
});
var sharedAdvertisMgr = new AdvertisMgr();
module.exports = sharedAdvertisMgr;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL3NpbmdsZUluc3RhbmNlU3lzdGVtcy9hZHZlcnRpc01nci5qcyJdLCJuYW1lcyI6WyJBZHZlcnRpc01nciIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwidmlkZW9BZCIsImRlbGVnYXRlIiwid2VjaGF0QWRJZCIsImlzUmVhZHkiLCJnZXQiLCJfaXNSZWFkeSIsInNldCIsInZhbHVlIiwic2hvd1N0YXR1cyIsInNka2JveCIsIlBsdWdpbkFkTW9iIiwic2hvdyIsInJlbW92ZUFjdGl2aXR5Tm9kZSIsInJlcXVpcmUiLCJzaG93Tm90aSIsInNob3dBY3Rpdml0eU5vZGUiLCJfc2hvd1N0YXR1cyIsImFjdGl2aXR5Tm9kZSIsImlzUmV3YXJkU2VuZCIsImFjdGl2aXR5Tm9kZVByZWZhYiIsInJlc2VzIiwiaW5zdGFudGlhdGUiLCJiZyIsImdldENoaWxkQnlOYW1lIiwid2lkdGgiLCJ3aW5TaXplIiwiaGVpZ2h0Iiwib24iLCJhY3Rpdml0eSIsInR3ZWVuIiwicmVwZWF0Rm9yZXZlciIsImJ5IiwiYW5nbGUiLCJzdGFydCIsImRpcmVjdG9yIiwiZ2V0U2NlbmUiLCJhZGRDaGlsZCIsInBhcmVudCIsImRlc3Ryb3kiLCJyZW1vdmVGcm9tUGFyZW50Iiwib25WaWRlb0FkRW5kIiwib25WaWRlb0FkTm90RW5kIiwiZGVmYXVsdE5vdGkiLCJub3RpZmljYXRpb25TeXMiLCJvblZpZGVvQWRMb2FkRXJyb3IiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwib25WaWRlb0FkU2hvd0Vycm9yIiwiaW5pdEFkcyIsInN5cyIsInBsYXRmb3JtIiwiV0VDSEFUX0dBTUUiLCJzZWxmIiwid3giLCJjcmVhdGVSZXdhcmRlZFZpZGVvQWQiLCJhZFVuaXRJZCIsIm9uTG9hZCIsIm9uRXJyb3IiLCJvbkNsb3NlIiwicmVzIiwiaXNFbmRlZCIsIm9zIiwiT1NfSU9TIiwiT1NfQU5EUk9JRCIsInNldExpc3RlbmVyIiwiYWRWaWV3RGlkUmVjZWl2ZUFkIiwibmFtZSIsImFkVmlld0RpZEZhaWxUb1JlY2VpdmVBZFdpdGhFcnJvciIsIm1zZyIsImFkVmlld1dpbGxQcmVzZW50U2NyZWVuIiwiYXVkaW9FbmdpbmUiLCJwYXVzZUFsbCIsImFkVmlld0RpZERpc21pc3NTY3JlZW4iLCJjYWNoZSIsInJlc3VtZUFsbCIsImFkVmlld1dpbGxEaXNtaXNzU2NyZWVuIiwiYWRWaWV3V2lsbExlYXZlQXBwbGljYXRpb24iLCJyZXdhcmQiLCJjdXJyZW5jeSIsImFtb3VudCIsImluaXQiLCJzaG93VmlkZW9BZCIsImxvYWQiLCJ0aGVuIiwic2hhcmVkQWR2ZXJ0aXNNZ3IiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLElBQUlBLFdBQVcsR0FBR0MsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDdkIsYUFBU0QsRUFBRSxDQUFDRSxTQURXO0FBR3ZCQyxFQUFBQSxVQUFVLEVBQUU7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQUMsSUFBQUEsT0FBTyxFQUFFLElBaEJEO0FBaUJSQyxJQUFBQSxRQUFRLEVBQUUsSUFqQkY7QUFtQlJDLElBQUFBLFVBQVUsRUFBRSxPQW5CSjtBQXFCUkMsSUFBQUEsT0FBTyxFQUFFO0FBQ0xDLE1BQUFBLEdBREssaUJBQ0M7QUFDRixlQUFPLEtBQUtDLFFBQVo7QUFDSCxPQUhJO0FBSUxDLE1BQUFBLEdBSkssZUFJREMsS0FKQyxFQUlNO0FBQ1AsYUFBS0YsUUFBTCxHQUFnQkUsS0FBaEIsQ0FETyxDQUVQOztBQUNBLFlBQUlBLEtBQUssSUFBSSxDQUFULElBQWMsS0FBS0MsVUFBTCxJQUFtQixDQUFyQyxFQUF3QztBQUNwQ0MsVUFBQUEsTUFBTSxDQUFDQyxXQUFQLENBQW1CQyxJQUFuQixDQUF3QixVQUF4QjtBQUNILFNBRkQsTUFHSyxJQUFJSixLQUFLLElBQUksQ0FBVCxJQUFjLEtBQUtDLFVBQUwsSUFBbUIsQ0FBckMsRUFBd0M7QUFDekMsZUFBS0EsVUFBTCxHQUFrQixDQUFsQjtBQUNBLGVBQUtJLGtCQUFMOztBQUNBQyxVQUFBQSxPQUFPLENBQUMsaUJBQUQsQ0FBUCxDQUEyQkMsUUFBM0IsQ0FBb0MsOENBQXBDO0FBRUgsU0FMSSxNQU9BLElBQUlQLEtBQUssSUFBSSxDQUFULElBQWMsS0FBS0MsVUFBTCxJQUFtQixDQUFyQyxFQUF3QztBQUN6QyxlQUFLTyxnQkFBTDtBQUNIO0FBQ0o7QUFwQkksS0FyQkQ7QUE0Q1JQLElBQUFBLFVBQVUsRUFBRTtBQUNSSixNQUFBQSxHQURRLGlCQUNGO0FBQ0YsZUFBTyxLQUFLWSxXQUFaO0FBQ0gsT0FITztBQUlSVixNQUFBQSxHQUpRLGVBSUpDLEtBSkksRUFJRztBQUNQLGFBQUtTLFdBQUwsR0FBbUJULEtBQW5CLENBRE8sQ0FFUDtBQUVIO0FBUk8sS0E1Q0o7QUF1RFJVLElBQUFBLFlBQVksRUFBRSxJQXZETjtBQXlEUkMsSUFBQUEsWUFBWSxFQUFFO0FBekROLEdBSFc7QUErRHZCSCxFQUFBQSxnQkEvRHVCLDhCQStESjtBQUNmLFFBQUlJLGtCQUFrQixHQUFHTixPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCTyxLQUFsQixDQUF3QixvQkFBeEIsQ0FBekI7O0FBQ0EsUUFBSUgsWUFBWSxHQUFHckIsRUFBRSxDQUFDeUIsV0FBSCxDQUFlRixrQkFBZixDQUFuQjtBQUNBLFFBQUlHLEVBQUUsR0FBR0wsWUFBWSxDQUFDTSxjQUFiLENBQTRCLElBQTVCLENBQVQ7QUFDQUQsSUFBQUEsRUFBRSxDQUFDRSxLQUFILEdBQVc1QixFQUFFLENBQUM2QixPQUFILENBQVdELEtBQXRCO0FBQ0FGLElBQUFBLEVBQUUsQ0FBQ0ksTUFBSCxHQUFZOUIsRUFBRSxDQUFDNkIsT0FBSCxDQUFXQyxNQUF2QjtBQUNBSixJQUFBQSxFQUFFLENBQUNLLEVBQUgsQ0FBTSxZQUFOLEVBQW1CLFlBQVUsQ0FBRSxDQUEvQjtBQUVBLFFBQUlDLFFBQVEsR0FBR1gsWUFBWSxDQUFDTSxjQUFiLENBQTRCLFVBQTVCLENBQWY7QUFDQTNCLElBQUFBLEVBQUUsQ0FBQ2lDLEtBQUgsQ0FBU0QsUUFBVCxFQUNLRSxhQURMLENBQ21CbEMsRUFBRSxDQUFDaUMsS0FBSCxHQUNORSxFQURNLENBQ0gsQ0FERyxFQUNEO0FBQUNDLE1BQUFBLEtBQUssRUFBRTtBQUFSLEtBREMsQ0FEbkIsRUFJS0MsS0FKTDtBQUtBLFNBQUtoQixZQUFMLEdBQW9CQSxZQUFwQjtBQUNBckIsSUFBQUEsRUFBRSxDQUFDc0MsUUFBSCxDQUFZQyxRQUFaLEdBQXVCWixjQUF2QixDQUFzQyxRQUF0QyxFQUFnRGEsUUFBaEQsQ0FBeUQsS0FBS25CLFlBQTlEO0FBQ0gsR0EvRXNCO0FBaUZ2QkwsRUFBQUEsa0JBakZ1QixnQ0FpRkY7QUFDakIsUUFBSSxLQUFLSyxZQUFMLElBQXFCLElBQXJCLElBQTZCLEtBQUtBLFlBQUwsQ0FBa0JvQixNQUFsQixJQUE0QixJQUE3RCxFQUFtRTtBQUMvRCxXQUFLcEIsWUFBTCxDQUFrQnFCLE9BQWxCO0FBQ0EsV0FBS3JCLFlBQUwsQ0FBa0JzQixnQkFBbEI7QUFDQSxXQUFLdEIsWUFBTCxHQUFvQixJQUFwQjtBQUNIO0FBQ0osR0F2RnNCO0FBeUZ2QnVCLEVBQUFBLFlBekZ1QiwwQkF5RlI7QUFDWCxRQUFJLEtBQUt2QyxRQUFMLElBQWlCLElBQWpCLElBQXlCLE9BQU8sS0FBS0EsUUFBTCxDQUFjdUMsWUFBckIsSUFBcUMsVUFBbEUsRUFBOEU7QUFDMUUsV0FBS3ZDLFFBQUwsQ0FBY3VDLFlBQWQ7QUFDSDtBQUNKLEdBN0ZzQjtBQThGdkJDLEVBQUFBLGVBOUZ1Qiw2QkE4Rlk7QUFBQSxRQUFuQkMsV0FBbUIsdUVBQUwsSUFBSzs7QUFDL0IsUUFBSUEsV0FBVyxJQUFJLElBQW5CLEVBQXlCO0FBQ3JCLFVBQUlDLGVBQWUsR0FBRzlCLE9BQU8sQ0FBQyxpQkFBRCxDQUE3Qjs7QUFDQThCLE1BQUFBLGVBQWUsQ0FBQzdCLFFBQWhCLENBQXlCLGNBQXpCO0FBQ0g7O0FBQ0QsUUFBSSxLQUFLYixRQUFMLElBQWlCLElBQWpCLElBQXlCLE9BQU8sS0FBS0EsUUFBTCxDQUFjd0MsZUFBckIsSUFBd0MsVUFBckUsRUFBaUY7QUFDN0UsV0FBS3hDLFFBQUwsQ0FBY3dDLGVBQWQ7QUFDSDtBQUNKLEdBdEdzQjtBQXVHdkJHLEVBQUFBLGtCQXZHdUIsOEJBdUdKQyxHQXZHSSxFQXVHQTtBQUNuQkMsSUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksUUFBWjs7QUFDQSxRQUFJLEtBQUs5QyxRQUFMLElBQWlCLElBQWpCLElBQXlCLE9BQU8sS0FBS0EsUUFBTCxDQUFjMkMsa0JBQXJCLElBQTJDLFVBQXhFLEVBQW9GO0FBQ2hGLFdBQUszQyxRQUFMLENBQWMyQyxrQkFBZCxDQUFpQ0MsR0FBakM7QUFDSDtBQUNKLEdBNUdzQjtBQTZHdkJHLEVBQUFBLGtCQTdHdUIsOEJBNkdKSCxHQTdHSSxFQTZHQztBQUNwQixRQUFJLEtBQUs1QyxRQUFMLElBQWlCLElBQWpCLElBQXlCLE9BQU8sS0FBS0EsUUFBTCxDQUFjK0Msa0JBQXJCLElBQTJDLFVBQXhFLEVBQW9GO0FBQ2hGLFdBQUsvQyxRQUFMLENBQWMrQyxrQkFBZCxDQUFpQ0gsR0FBakM7QUFDSDtBQUNKLEdBakhzQjtBQWtIdkJJLEVBQUFBLE9BbEh1QixxQkFrSGQ7QUFDTCxRQUFJLEtBQUtqRCxPQUFMLElBQWdCLElBQXBCLEVBQTBCO0FBQ3RCLFVBQUlKLEVBQUUsQ0FBQ3NELEdBQUgsQ0FBT0MsUUFBUCxJQUFtQnZELEVBQUUsQ0FBQ3NELEdBQUgsQ0FBT0UsV0FBOUIsRUFBMkM7QUFDdkMsWUFBSUMsSUFBSSxHQUFHLElBQVg7QUFDQSxhQUFLckQsT0FBTCxHQUFlc0QsRUFBRSxDQUFDQyxxQkFBSCxDQUF5QjtBQUFDQyxVQUFBQSxRQUFRLEVBQUUsS0FBS3REO0FBQWhCLFNBQXpCLENBQWY7QUFDQSxhQUFLRixPQUFMLENBQWF5RCxNQUFiLENBQW9CLFlBQVU7QUFDMUJYLFVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFFBQVo7QUFDSCxTQUZEO0FBR0EsYUFBSy9DLE9BQUwsQ0FBYTBELE9BQWIsQ0FBcUIsVUFBU2IsR0FBVCxFQUFhO0FBQzlCUSxVQUFBQSxJQUFJLENBQUNULGtCQUFMLENBQXdCQyxHQUF4QjtBQUNILFNBRkQ7QUFHQSxhQUFLN0MsT0FBTCxDQUFhMkQsT0FBYixDQUFxQixVQUFTQyxHQUFULEVBQWE7QUFDOUIsY0FBSUEsR0FBRyxJQUFJQSxHQUFHLENBQUNDLE9BQWYsRUFBd0I7QUFDcEJSLFlBQUFBLElBQUksQ0FBQ2IsWUFBTDtBQUNILFdBRkQsTUFHSztBQUNEYSxZQUFBQSxJQUFJLENBQUNaLGVBQUw7QUFDSDtBQUNKLFNBUEQ7QUFRSCxPQWpCRCxNQW1CSyxJQUFJN0MsRUFBRSxDQUFDc0QsR0FBSCxDQUFPWSxFQUFQLElBQWFsRSxFQUFFLENBQUNzRCxHQUFILENBQU9hLE1BQXBCLElBQThCbkUsRUFBRSxDQUFDc0QsR0FBSCxDQUFPWSxFQUFQLElBQWFsRSxFQUFFLENBQUNzRCxHQUFILENBQU9jLFVBQXRELEVBQWtFO0FBQ25FLFlBQUlYLElBQUksR0FBRyxJQUFYO0FBQ0E1QyxRQUFBQSxNQUFNLENBQUNDLFdBQVAsQ0FBbUJ1RCxXQUFuQixDQUErQjtBQUMzQkMsVUFBQUEsa0JBQWtCLEVBQUUsNEJBQVNDLElBQVQsRUFBYztBQUM5QmQsWUFBQUEsSUFBSSxDQUFDbEQsT0FBTCxHQUFlLENBQWY7QUFDSCxXQUgwQjtBQUszQmlFLFVBQUFBLGlDQUFpQyxFQUFFLDJDQUFTRCxJQUFULEVBQWNFLEdBQWQsRUFBa0I7QUFDakRoQixZQUFBQSxJQUFJLENBQUNsRCxPQUFMLEdBQWUsQ0FBZjtBQUNBa0QsWUFBQUEsSUFBSSxDQUFDVCxrQkFBTCxDQUF3QnlCLEdBQXhCO0FBQ0gsV0FSMEI7QUFVM0JDLFVBQUFBLHVCQUF1QixFQUFFLGlDQUFTSCxJQUFULEVBQWU7QUFDcENkLFlBQUFBLElBQUksQ0FBQ3pDLGtCQUFMO0FBQ0F5QyxZQUFBQSxJQUFJLENBQUM3QyxVQUFMLEdBQWtCLENBQWxCO0FBQ0E2QyxZQUFBQSxJQUFJLENBQUNuQyxZQUFMLEdBQW9CLEtBQXBCO0FBQ0F0QixZQUFBQSxFQUFFLENBQUMyRSxXQUFILENBQWVDLFFBQWY7QUFDSCxXQWYwQjtBQWlCM0JDLFVBQUFBLHNCQUFzQixFQUFFLGdDQUFTTixJQUFULEVBQWU7QUFDbkNkLFlBQUFBLElBQUksQ0FBQzdDLFVBQUwsR0FBa0IsQ0FBbEI7O0FBQ0EsZ0JBQUk2QyxJQUFJLENBQUNuQyxZQUFMLElBQXFCLEtBQXpCLEVBQWdDO0FBQzVCbUMsY0FBQUEsSUFBSSxDQUFDWixlQUFMLENBQXFCLElBQXJCO0FBQ0g7O0FBQ0RZLFlBQUFBLElBQUksQ0FBQ2xELE9BQUwsR0FBZSxDQUFmO0FBQ0FNLFlBQUFBLE1BQU0sQ0FBQ0MsV0FBUCxDQUFtQmdFLEtBQW5CLENBQXlCLFVBQXpCO0FBQ0E5RSxZQUFBQSxFQUFFLENBQUMyRSxXQUFILENBQWVJLFNBQWY7QUFDSCxXQXpCMEI7QUEyQjNCQyxVQUFBQSx1QkFBdUIsRUFBRSxpQ0FBU1QsSUFBVCxFQUFlLENBRXZDLENBN0IwQjtBQStCM0JVLFVBQUFBLDBCQUEwQixFQUFFLG9DQUFTVixJQUFULEVBQWUsQ0FFMUMsQ0FqQzBCO0FBa0MzQlcsVUFBQUEsTUFBTSxFQUFFLGdCQUFTWCxJQUFULEVBQWNZLFFBQWQsRUFBd0JDLE1BQXhCLEVBQWdDO0FBQ3BDM0IsWUFBQUEsSUFBSSxDQUFDbkMsWUFBTCxHQUFvQixJQUFwQjtBQUNBbUMsWUFBQUEsSUFBSSxDQUFDYixZQUFMO0FBQ0g7QUFyQzBCLFNBQS9CO0FBdUNBLGFBQUtyQyxPQUFMLEdBQWUsQ0FBZjtBQUNBTSxRQUFBQSxNQUFNLENBQUNDLFdBQVAsQ0FBbUJ1RSxJQUFuQjtBQUNBeEUsUUFBQUEsTUFBTSxDQUFDQyxXQUFQLENBQW1CZ0UsS0FBbkIsQ0FBeUIsVUFBekI7QUFDSDtBQUNKO0FBQ0osR0FyTHNCO0FBc0x2QlEsRUFBQUEsV0F0THVCLHlCQXNMVDtBQUVWLFFBQUl0RixFQUFFLENBQUNzRCxHQUFILENBQU9DLFFBQVAsSUFBbUJ2RCxFQUFFLENBQUNzRCxHQUFILENBQU9FLFdBQTlCLEVBQTJDO0FBQ3ZDLFVBQUlDLElBQUksR0FBRyxJQUFYO0FBQ0EsV0FBS3JELE9BQUwsQ0FBYW1GLElBQWIsR0FDQ0MsSUFERCxDQUNNLFlBQVU7QUFDWi9CLFFBQUFBLElBQUksQ0FBQ3JELE9BQUwsQ0FBYVcsSUFBYjtBQUNILE9BSEQsV0FJTyxVQUFTa0MsR0FBVCxFQUFhO0FBQ2hCUSxRQUFBQSxJQUFJLENBQUNMLGtCQUFMLENBQXdCSCxHQUF4QjtBQUNILE9BTkQ7QUFPSCxLQVRELE1BV0ssSUFBSWpELEVBQUUsQ0FBQ3NELEdBQUgsQ0FBT1ksRUFBUCxJQUFhbEUsRUFBRSxDQUFDc0QsR0FBSCxDQUFPYyxVQUFwQixJQUFrQ3BFLEVBQUUsQ0FBQ3NELEdBQUgsQ0FBT1ksRUFBUCxJQUFhbEUsRUFBRSxDQUFDc0QsR0FBSCxDQUFPYSxNQUExRCxFQUFrRTtBQUNuRSxXQUFLdkQsVUFBTCxHQUFrQixDQUFsQjtBQUNBWixNQUFBQSxFQUFFLENBQUNtRCxHQUFILENBQU8sS0FBSzVDLE9BQUwsR0FBZSxvQkFBdEI7O0FBQ0EsVUFBSSxLQUFLQSxPQUFMLElBQWdCLENBQXBCLEVBQXVCO0FBQ25CLGFBQUtZLGdCQUFMO0FBQ0FOLFFBQUFBLE1BQU0sQ0FBQ0MsV0FBUCxDQUFtQkMsSUFBbkIsQ0FBd0IsVUFBeEI7QUFDSCxPQUhELE1BSUssSUFBSSxLQUFLUixPQUFMLElBQWdCLENBQXBCLEVBQXVCO0FBQ3hCO0FBQ0EsYUFBS1ksZ0JBQUw7QUFDSCxPQUhJLE1BSUEsSUFBSSxLQUFLWixPQUFMLElBQWdCLENBQXBCLEVBQXVCO0FBQ3hCO0FBQ0EsYUFBS0EsT0FBTCxHQUFlLENBQWY7QUFDQU0sUUFBQUEsTUFBTSxDQUFDQyxXQUFQLENBQW1CZ0UsS0FBbkIsQ0FBeUIsVUFBekIsRUFId0IsQ0FJeEI7QUFDSDtBQUNKO0FBQ0o7QUFyTnNCLENBQVQsQ0FBbEI7QUF3TkEsSUFBSVcsaUJBQWlCLEdBQUcsSUFBSTFGLFdBQUosRUFBeEI7QUFDQTJGLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQkYsaUJBQWpCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMZWFybiBjYy5DbGFzczpcbi8vICAtIFtDaGluZXNlXSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL3NjcmlwdGluZy9jbGFzcy5odG1sXG4vLyAgLSBbRW5nbGlzaF0gaHR0cDovL2RvY3MuY29jb3MyZC14Lm9yZy9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvY2xhc3MuaHRtbFxuLy8gTGVhcm4gQXR0cmlidXRlOlxuLy8gIC0gW0NoaW5lc2VdIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL3JlZmVyZW5jZS9hdHRyaWJ1dGVzLmh0bWxcbi8vICAtIFtFbmdsaXNoXSBodHRwOi8vZG9jcy5jb2NvczJkLXgub3JnL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9yZWZlcmVuY2UvYXR0cmlidXRlcy5odG1sXG4vLyBMZWFybiBsaWZlLWN5Y2xlIGNhbGxiYWNrczpcbi8vICAtIFtDaGluZXNlXSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL3NjcmlwdGluZy9saWZlLWN5Y2xlLWNhbGxiYWNrcy5odG1sXG4vLyAgLSBbRW5nbGlzaF0gaHR0cHM6Ly93d3cuY29jb3MyZC14Lm9yZy9kb2NzL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9saWZlLWN5Y2xlLWNhbGxiYWNrcy5odG1sXG5cbnZhciBBZHZlcnRpc01nciA9IGNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIC8vIGZvbzoge1xuICAgICAgICAvLyAgICAgLy8gQVRUUklCVVRFUzpcbiAgICAgICAgLy8gICAgIGRlZmF1bHQ6IG51bGwsICAgICAgICAvLyBUaGUgZGVmYXVsdCB2YWx1ZSB3aWxsIGJlIHVzZWQgb25seSB3aGVuIHRoZSBjb21wb25lbnQgYXR0YWNoaW5nXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG8gYSBub2RlIGZvciB0aGUgZmlyc3QgdGltZVxuICAgICAgICAvLyAgICAgdHlwZTogY2MuU3ByaXRlRnJhbWUsIC8vIG9wdGlvbmFsLCBkZWZhdWx0IGlzIHR5cGVvZiBkZWZhdWx0XG4gICAgICAgIC8vICAgICBzZXJpYWxpemFibGU6IHRydWUsICAgLy8gb3B0aW9uYWwsIGRlZmF1bHQgaXMgdHJ1ZVxuICAgICAgICAvLyB9LFxuICAgICAgICAvLyBiYXI6IHtcbiAgICAgICAgLy8gICAgIGdldCAoKSB7XG4gICAgICAgIC8vICAgICAgICAgcmV0dXJuIHRoaXMuX2JhcjtcbiAgICAgICAgLy8gICAgIH0sXG4gICAgICAgIC8vICAgICBzZXQgKHZhbHVlKSB7XG4gICAgICAgIC8vICAgICAgICAgdGhpcy5fYmFyID0gdmFsdWU7XG4gICAgICAgIC8vICAgICB9XG4gICAgICAgIC8vIH0sXG4gICAgICAgIHZpZGVvQWQ6IG51bGwsXG4gICAgICAgIGRlbGVnYXRlOiBudWxsLFxuXG4gICAgICAgIHdlY2hhdEFkSWQ6IFwieHh4eHhcIixcblxuICAgICAgICBpc1JlYWR5OiB7XG4gICAgICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzUmVhZHlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQodmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pc1JlYWR5ID0gdmFsdWVcbiAgICAgICAgICAgICAgICAvLzEgPSBvayAsIDIgPSBsb2FkaW5nIDMgPSBlcnJvXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IDEgJiYgdGhpcy5zaG93U3RhdHVzID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgc2RrYm94LlBsdWdpbkFkTW9iLnNob3coXCJyZXdhcmRlZFwiKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA9PSAzICYmIHRoaXMuc2hvd1N0YXR1cyA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1cyA9IDBcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVBY3Rpdml0eU5vZGUoKVxuICAgICAgICAgICAgICAgICAgICByZXF1aXJlKFwibm90aWZpY2F0aW9uTWdyXCIpLnNob3dOb3RpKFwic29tZXRoaW5nIHdyb25nIHdpdGggYWQgc3lzdGVtICwgcmV0cnkgbGF0ZXJcIilcbiAgICBcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA9PSAyICYmIHRoaXMuc2hvd1N0YXR1cyA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0FjdGl2aXR5Tm9kZSgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNob3dTdGF0dXM6IHtcbiAgICAgICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2hvd1N0YXR1c1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldCh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dTdGF0dXMgPSB2YWx1ZVxuICAgICAgICAgICAgICAgIC8vMCA9IGluaXQgMSA9IHdpbGwgc2hvdyAyID0gc2hvd2luZ1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWN0aXZpdHlOb2RlOiBudWxsLFxuXG4gICAgICAgIGlzUmV3YXJkU2VuZDogZmFsc2VcbiAgICB9LFxuXG4gICAgc2hvd0FjdGl2aXR5Tm9kZSgpIHtcbiAgICAgICAgdmFyIGFjdGl2aXR5Tm9kZVByZWZhYiA9IHJlcXVpcmUoXCJyZXNNZ3JcIikucmVzZXNbXCJhY3Rpdml0eU5vZGVQcmVmYWJcIl1cbiAgICAgICAgdmFyIGFjdGl2aXR5Tm9kZSA9IGNjLmluc3RhbnRpYXRlKGFjdGl2aXR5Tm9kZVByZWZhYilcbiAgICAgICAgdmFyIGJnID0gYWN0aXZpdHlOb2RlLmdldENoaWxkQnlOYW1lKFwiYmdcIilcbiAgICAgICAgYmcud2lkdGggPSBjYy53aW5TaXplLndpZHRoXG4gICAgICAgIGJnLmhlaWdodCA9IGNjLndpblNpemUuaGVpZ2h0XG4gICAgICAgIGJnLm9uKFwidG91Y2hzdGFydFwiLGZ1bmN0aW9uKCl7fSlcblxuICAgICAgICB2YXIgYWN0aXZpdHkgPSBhY3Rpdml0eU5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJhY3Rpdml0eVwiKVxuICAgICAgICBjYy50d2VlbihhY3Rpdml0eSlcbiAgICAgICAgICAgIC5yZXBlYXRGb3JldmVyKGNjLnR3ZWVuKClcbiAgICAgICAgICAgICAgICAgICAgLmJ5KDIse2FuZ2xlOiAzNjB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN0YXJ0KClcbiAgICAgICAgdGhpcy5hY3Rpdml0eU5vZGUgPSBhY3Rpdml0eU5vZGVcbiAgICAgICAgY2MuZGlyZWN0b3IuZ2V0U2NlbmUoKS5nZXRDaGlsZEJ5TmFtZShcIkNhbnZhc1wiKS5hZGRDaGlsZCh0aGlzLmFjdGl2aXR5Tm9kZSlcbiAgICB9LFxuXG4gICAgcmVtb3ZlQWN0aXZpdHlOb2RlKCkge1xuICAgICAgICBpZiAodGhpcy5hY3Rpdml0eU5vZGUgIT0gbnVsbCAmJiB0aGlzLmFjdGl2aXR5Tm9kZS5wYXJlbnQgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5hY3Rpdml0eU5vZGUuZGVzdHJveSgpXG4gICAgICAgICAgICB0aGlzLmFjdGl2aXR5Tm9kZS5yZW1vdmVGcm9tUGFyZW50KClcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdHlOb2RlID0gbnVsbFxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uVmlkZW9BZEVuZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGVsZWdhdGUgIT0gbnVsbCAmJiB0eXBlb2YgdGhpcy5kZWxlZ2F0ZS5vblZpZGVvQWRFbmQgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICB0aGlzLmRlbGVnYXRlLm9uVmlkZW9BZEVuZCgpXG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uVmlkZW9BZE5vdEVuZChkZWZhdWx0Tm90aSA9IHRydWUpe1xuICAgICAgICBpZiAoZGVmYXVsdE5vdGkgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgdmFyIG5vdGlmaWNhdGlvblN5cyA9IHJlcXVpcmUoXCJub3RpZmljYXRpb25NZ3JcIilcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvblN5cy5zaG93Tm90aShcIueci+WujOinhumikeaJjeiDveiOt+W+l+WlluWKseWTpn5cIilcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kZWxlZ2F0ZSAhPSBudWxsICYmIHR5cGVvZiB0aGlzLmRlbGVnYXRlLm9uVmlkZW9BZE5vdEVuZCA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZGVsZWdhdGUub25WaWRlb0FkTm90RW5kKClcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25WaWRlb0FkTG9hZEVycm9yKGVycil7XG4gICAgICAgIGNvbnNvbGUubG9nKFwi5ouJ5Y+W5bm/5ZGK5aSx6LSlXCIpXG4gICAgICAgIGlmICh0aGlzLmRlbGVnYXRlICE9IG51bGwgJiYgdHlwZW9mIHRoaXMuZGVsZWdhdGUub25WaWRlb0FkTG9hZEVycm9yID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgdGhpcy5kZWxlZ2F0ZS5vblZpZGVvQWRMb2FkRXJyb3IoZXJyKVxuICAgICAgICB9XG4gICAgfSxcbiAgICBvblZpZGVvQWRTaG93RXJyb3IoZXJyKSB7XG4gICAgICAgIGlmICh0aGlzLmRlbGVnYXRlICE9IG51bGwgJiYgdHlwZW9mIHRoaXMuZGVsZWdhdGUub25WaWRlb0FkU2hvd0Vycm9yID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgdGhpcy5kZWxlZ2F0ZS5vblZpZGVvQWRTaG93RXJyb3IoZXJyKVxuICAgICAgICB9XG4gICAgfSxcbiAgICBpbml0QWRzKCl7XG4gICAgICAgIGlmICh0aGlzLnZpZGVvQWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5wbGF0Zm9ybSA9PSBjYy5zeXMuV0VDSEFUX0dBTUUpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXNcbiAgICAgICAgICAgICAgICB0aGlzLnZpZGVvQWQgPSB3eC5jcmVhdGVSZXdhcmRlZFZpZGVvQWQoe2FkVW5pdElkOiB0aGlzLndlY2hhdEFkSWR9KVxuICAgICAgICAgICAgICAgIHRoaXMudmlkZW9BZC5vbkxvYWQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLmi4nlj5blub/lkYrmiJDlip9cIilcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHRoaXMudmlkZW9BZC5vbkVycm9yKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYub25WaWRlb0FkTG9hZEVycm9yKGVycilcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHRoaXMudmlkZW9BZC5vbkNsb3NlKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMgJiYgcmVzLmlzRW5kZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub25WaWRlb0FkRW5kKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub25WaWRlb0FkTm90RW5kKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsc2UgaWYgKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfSU9TIHx8IGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpc1xuICAgICAgICAgICAgICAgIHNka2JveC5QbHVnaW5BZE1vYi5zZXRMaXN0ZW5lcih7XG4gICAgICAgICAgICAgICAgICAgIGFkVmlld0RpZFJlY2VpdmVBZDogZnVuY3Rpb24obmFtZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmlzUmVhZHkgPSAxXG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgYWRWaWV3RGlkRmFpbFRvUmVjZWl2ZUFkV2l0aEVycm9yOiBmdW5jdGlvbihuYW1lLG1zZyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmlzUmVhZHkgPSAzXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9uVmlkZW9BZExvYWRFcnJvcihtc2cpXG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgYWRWaWV3V2lsbFByZXNlbnRTY3JlZW46IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVtb3ZlQWN0aXZpdHlOb2RlKClcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd1N0YXR1cyA9IDJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaXNSZXdhcmRTZW5kID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnBhdXNlQWxsKClcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBhZFZpZXdEaWREaXNtaXNzU2NyZWVuOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dTdGF0dXMgPSAwXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5pc1Jld2FyZFNlbmQgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9uVmlkZW9BZE5vdEVuZCh0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pc1JlYWR5ID0gMlxuICAgICAgICAgICAgICAgICAgICAgICAgc2RrYm94LlBsdWdpbkFkTW9iLmNhY2hlKFwicmV3YXJkZWRcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnJlc3VtZUFsbCgpXG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgYWRWaWV3V2lsbERpc21pc3NTY3JlZW46IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGFkVmlld1dpbGxMZWF2ZUFwcGxpY2F0aW9uOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcmV3YXJkOiBmdW5jdGlvbihuYW1lLGN1cnJlbmN5LCBhbW91bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaXNSZXdhcmRTZW5kID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vblZpZGVvQWRFbmQoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB0aGlzLmlzUmVhZHkgPSAyXG4gICAgICAgICAgICAgICAgc2RrYm94LlBsdWdpbkFkTW9iLmluaXQoKVxuICAgICAgICAgICAgICAgIHNka2JveC5QbHVnaW5BZE1vYi5jYWNoZShcInJld2FyZGVkXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHNob3dWaWRlb0FkKCkge1xuXG4gICAgICAgIGlmIChjYy5zeXMucGxhdGZvcm0gPT0gY2Muc3lzLldFQ0hBVF9HQU1FKSB7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXNcbiAgICAgICAgICAgIHRoaXMudmlkZW9BZC5sb2FkKClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgc2VsZi52aWRlb0FkLnNob3coKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgICAgIHNlbGYub25WaWRlb0FkU2hvd0Vycm9yKGVycilcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBlbHNlIGlmIChjYy5zeXMub3MgPT0gY2Muc3lzLk9TX0FORFJPSUQgfHwgY2Muc3lzLm9zID09IGNjLnN5cy5PU19JT1MpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1cyA9IDFcbiAgICAgICAgICAgIGNjLmxvZyh0aGlzLmlzUmVhZHkgKyBcIiA6IGN1cnJlbnQgaXNyZWFkeVwiKVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNSZWFkeSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93QWN0aXZpdHlOb2RlKClcbiAgICAgICAgICAgICAgICBzZGtib3guUGx1Z2luQWRNb2Iuc2hvdyhcInJld2FyZGVkXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmlzUmVhZHkgPT0gMikge1xuICAgICAgICAgICAgICAgIC8vanVzdCB3YWl0IHNldCBldmVudCBvZiBpc1JlYWR5IHRvIDFcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dBY3Rpdml0eU5vZGUoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pc1JlYWR5ID09IDMpIHtcbiAgICAgICAgICAgICAgICAvL3JlbG9hZCBvbmNlIGFuZCB0aGVuIHNob3dcbiAgICAgICAgICAgICAgICB0aGlzLmlzUmVhZHkgPSAyXG4gICAgICAgICAgICAgICAgc2RrYm94LlBsdWdpbkFkTW9iLmNhY2hlKFwicmV3YXJkZWRcIilcbiAgICAgICAgICAgICAgICAvL3dhaXQgc2V0IGV2ZW50IG9mIGlzUmVhZHkgdG8gMVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSk7XG5cbnZhciBzaGFyZWRBZHZlcnRpc01nciA9IG5ldyBBZHZlcnRpc01ncigpXG5tb2R1bGUuZXhwb3J0cyA9IHNoYXJlZEFkdmVydGlzTWdyIl19