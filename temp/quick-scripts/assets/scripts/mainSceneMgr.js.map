{"version":3,"sources":["mainSceneMgr.js"],"names":["cc","Class","extends","Component","properties","playerData","levelsStartPosition","v2","levelsHorDis","levelsVerDis","levelsHorNum","levelNodePrefab","Prefab","lockedLevelColor","color","unlockedLevelColor","currentLevelColor","physicalPower","get","_physicalPower","set","value","node","getChildByName","getComponent","Label","string","toString","physicalPowerForChallengeCost","_physicalPowerForChallengeCost","physicalPowerLabel","challengeButton","commentLabel","find","physicalPowerIcon","active","Button","interactable","heartForChallengeCost","_heartForChallengeCost","heartLabel","heartIcon","heart","selectedLevel","_selectedLevel","currentLevel","physicalPowerCostedFlag","temp","require","physicalPowerCost","initAdWatchedFlag","Math","round","heartForRetryCost","levelAresNodes","selectedLevelAreaNode","_selectedLevelAreaNode","selectedEffect","x","y","tween","to","start","Node","default","_heart","onLoad","playerName","name","delegate","signInButton","on","show","welfaryButton","enterButtonNode","repeatForever","angle","delay","setupUi","addHeartButton","addPhysicalPowerButton","setupSection","currentSection","givenSection","complete","sectionConfig","config","sectionTitle","sectionDescrip","levels","index","strForShow","parseInt","length","instantiate","label","width","floor","status","checkLevelStatus","level","addChild","url","backgroundPath","self","loader","loadRes","SpriteFrame","err","res","Sprite","spriteFrame","checkSectionStatus","givenLevel","key","i","belongedSection","sectionCheckResult","oneLevel","onClickChallengeButton","gameMgr","enterLevelScene","commitBody","flagValue","successCallBack","commitPlayerDataToServer","onAllRetryFailed","onRefresh"],"mappings":"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","file":"mainSceneMgr.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        playerData: null,\n        levelsStartPosition: cc.v2(0,0),\n        levelsHorDis: 60,\n        levelsVerDis: 60,\n        levelsHorNum: 5,\n        levelNodePrefab: cc.Prefab,\n        lockedLevelColor: cc.color,\n        unlockedLevelColor: cc.color,\n        currentLevelColor: cc.color,\n\n        physicalPower: {\n            get() {\n                return this._physicalPower\n            },\n            set(value) {\n                this._physicalPower = value\n                this.node.getChildByName(\"physicalPowerLabel\").getComponent(cc.Label).string = this.playerData.physicalPower.toString()\n            }\n        },\n\n        // maxPhysicalPower: {\n        //     get() {\n        //         return this._maxPhysicalPower\n        //     },\n        //     set(value) {\n        //         this._maxPhysicalPower = value\n        //     }\n        // },\n\n        physicalPowerForChallengeCost: {\n            get() {\n                return this._physicalPowerForChallengeCost\n            },\n            set(value) {\n                this._physicalPowerForChallengeCost = value\n                var physicalPowerLabel = this.challengeButton.getChildByName(\"physicalPowerLabel\")\n                var commentLabel = cc.find(\"Canvas/commentLabel\")\n                var physicalPowerIcon = this.challengeButton.getChildByName(\"physicalPower\")\n                if (value == null) {\n                    physicalPowerIcon.active = false\n                    physicalPowerLabel.active = false\n                }\n                else {\n                    physicalPowerIcon.active = true\n                    physicalPowerLabel.active = true\n\n                    physicalPowerLabel.getComponent(cc.Label).string = value.toString()\n                    if (value <= this.physicalPower) {\n                        this.challengeButton.getComponent(cc.Button).interactable = true\n                        if (value == 0) {\n                            commentLabel.getComponent(cc.Label).string = \"已挑战过的关卡不会消耗体力\"\n                        }\n                        else {\n                            commentLabel.getComponent(cc.Label).string = \"每天挑战每个新的关卡时会消耗体力\"\n                        }\n                    }\n                    else {\n                        this.challengeButton.getComponent(cc.Button).interactable = false\n                        commentLabel.getComponent(cc.Label).string = \"每天挑战每个新的关卡时会消耗体力\"\n                    }\n                }\n            }\n        },\n\n        heartForChallengeCost: {\n            get() {\n                return this._heartForChallengeCost\n            },\n            set(value) {\n                this._heartForChallengeCost = value\n                var heartLabel = this.challengeButton.getChildByName(\"heartLabel\")\n                var heartIcon = this.challengeButton.getChildByName(\"heart\")\n                if (value == null) {\n                    heartLabel.active = false\n                    heartIcon.active = false\n                }\n                else {\n                    heartLabel.active = true\n                    heartIcon.active = true\n\n                    heartLabel.getComponent(cc.Label).string = value.toString()\n                    if (value <= this.heart) {\n                        this.challengeButton.getComponent(cc.Button).interactable = true\n                    }\n                    else {\n                        this.challengeButton.getComponent(cc.Button).interactable = false\n                    }\n                }\n            }\n        }, \n\n        selectedLevel: {\n            get() {\n                return this._selectedLevel\n            },\n            set(value) {\n                this._selectedLevel = value\n                if (value != null) {\n                    if (value == this.playerData.currentLevel && this.playerData.physicalPowerCostedFlag == 0) {\n                        this.heartForChallengeCost = null\n                        var temp = require(\"levelConfig\")[value].physicalPowerCost\n                        if (this.playerData.initAdWatchedFlag == 1) {\n                            temp = Math.round(temp / 2)\n                        }\n                        this.physicalPowerForChallengeCost = temp\n                    }\n                    else if (value == this.playerData.currentLevel && this.playerData.physicalPowerCostedFlag == 1) {\n                        this.physicalPowerForChallengeCost = null\n                        this.heartForChallengeCost = require(\"levelConfig\")[value].heartForRetryCost\n                    }\n                    else{\n                        this.heartForChallengeCost = null\n                        this.physicalPowerForChallengeCost = 0\n                    }\n                    if (this.levelAresNodes[value] != null) {\n                        this.selectedLevelAreaNode = this.levelAresNodes[value]\n                    }\n                }\n            }\n        },\n\n        selectedLevelAreaNode: {\n            get() {\n                return this._selectedLevelAreaNode\n            },\n            set(value) {\n                this._selectedLevelAreaNode = value\n                if (value != null) {\n                    if (this.selectedEffect.active == false) {\n                        this.selectedEffect.x = this.selectedLevelAreaNode.x\n                        this.selectedEffect.y = this.selectedLevelAreaNode.y\n                        this.selectedEffect.active = true\n                    }\n                    else {\n                        cc.tween(this.selectedEffect)\n                            .to(0.2,{x: this.selectedLevelAreaNode.x, y: this.selectedLevelAreaNode.y})\n                            .start()\n                    }\n                }\n                else {\n                    this.selectedEffect.active = false\n                }\n            }\n        },\n\n        selectedEffect: cc.Node,\n        levelAresNodes: {\n            default: {}\n        },\n\n        challengeButton: null,\n        heartLabel: cc.Label,\n        heart: {\n            get() {\n                return this._heart\n            },\n            set(value) {\n                this._heart = value\n                this.heartLabel.string = value.toString()\n            }\n        },\n        // maxHeart: null\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.playerData = require(\"dataMgr\").playerData\n        this.lockedLevelColor = cc.color(191,191,191)\n        this.unlockedLevelColor = cc.color(102,102,102)\n        this.currentLevelColor = cc.color(188,36,36)\n        this.challengeButton = this.node.getChildByName(\"challengeButton\")\n        this.playerName = this.playerData.name\n        // this.maxPhysicalPower = this.playerData.maxPhysicalPower\n        this.physicalPower = this.playerData.physicalPower\n        // this.maxHeart = this.playerData.maxHeart\n        this.heart = this.playerData.heart\n       \n        require(\"networkMgr\").delegate = this\n        require(\"dataMgr\").delegate = this\n\n        var signInButton = this.node.getChildByName(\"signInButton\")\n        signInButton.on(\"click\",function(){\n            require(\"signInSystem\").show()\n        })\n\n        var welfaryButton = this.node.getChildByName(\"welfaryButton\")\n        welfaryButton.on(\"click\",function(){\n            require(\"welfarySys\").show()\n        })\n        require(\"welfarySys\").enterButtonNode = welfaryButton\n        cc.tween(welfaryButton)\n            .repeatForever(\n                cc.tween()\n                    .to(0.3,{angle: -45})\n                    .to(0.3,{angle: 0})\n                    .to(0.3,{angle: 45})\n                    .to(0.3,{angle: 0})\n                    .delay(1)\n            )\n            .start()\n        require(\"welfarySys\").setupUi()\n        \n        var addHeartButton = this.node.getChildByName(\"addButton_heart\")\n        addHeartButton.on(\"click\",function(){\n            require(\"addHeartSys\").show()\n        })\n\n        var addPhysicalPowerButton = this.node.getChildByName(\"addButton_phy\")\n        addPhysicalPowerButton.on(\"click\",function(){\n            require(\"addPhysicalPowerSys\").show()\n        })\n\n        this.setupSection(this.playerData.currentSection)\n    },\n\n    start () {\n\n    },\n\n    setupSection(givenSection, complete = function(){}) {\n        this.selectedLevel = null\n        \n        var sectionConfig = require(\"sectionConfig\")\n        var config = sectionConfig[givenSection]\n\n        this.node.getChildByName(\"sectionTitleLabel\").getComponent(cc.Label).string = config.sectionTitle\n        this.node.getChildByName(\"sectionDescripLabel\").getComponent(cc.Label).string = config.sectionDescrip\n        \n\n        var levels = config.levels\n        this.levelAresNodes = {}\n        for (var index in levels) {\n            var strForShow = parseInt(index) + 1\n            strForShow = strForShow.toString()\n            if (strForShow.length == 1) {\n                strForShow = \"0\" + strForShow\n            }\n\n            var node = cc.instantiate(this.levelNodePrefab)\n            var label = node.getComponent(cc.Label)\n            label.string = strForShow\n\n            node.x = (index % this.levelsHorNum) * (this.levelsHorDis + node.width) + this.levelsStartPosition.x\n            node.y = -Math.floor(index / this.levelsHorNum) * (this.levelsVerDis + node.width) + this.levelsStartPosition.y\n\n            var status = this.checkLevelStatus(levels[index])\n            switch(status) {\n                case 0:\n                    node.color = this.lockedLevelColor\n                    break\n                case 1:\n                    node.color = this.unlockedLevelColor\n                    break\n                case 2:\n                    node.color = this.currentLevelColor\n                    break\n            }\n            node.getComponent(\"levelAreaNodeMgr\").delegate = this\n            node.getComponent(\"levelAreaNodeMgr\").level = levels[index]\n            this.levelAresNodes[levels[index]] = node\n            cc.find(\"Canvas/levelsArea\").addChild(node)\n        }\n        var url = config.backgroundPath\n        var self = this\n        cc.loader.loadRes(url,cc.SpriteFrame,function(err,res){\n            self.node.getChildByName(\"sectionBg\").getComponent(cc.Sprite).spriteFrame = res\n            complete()\n        })\n\n        if (givenSection == this.playerData.currentSection) {\n            this.selectedLevel = this.playerData.currentLevel\n        }\n    },\n\n    checkSectionStatus(givenSection) {\n        var currentSection = this.playerData.currentSection\n        if (givenSection > currentSection) {\n            return 0 //locked\n        }\n        else if (givenSection < currentSection) {\n            return 1 //unlocked\n        }\n        else if (givenSection == currentSection) {\n            return 2 //current\n        }\n    },\n\n    checkLevelStatus(givenLevel) {\n        var sectionConfig = require(\"sectionConfig\")\n\n        var temp = function() {\n            for (var key in sectionConfig) {\n                var levels = sectionConfig[key].levels\n                for (var i in levels) {\n                    if (givenLevel == levels[i]) {\n                        return key\n                    }\n                }\n            }\n\n            return false\n        }\n\n        var belongedSection = temp()\n        if (belongedSection != false) {\n            belongedSection = parseInt(belongedSection)\n        }\n        else {\n            return false // no such level\n        }\n\n        var sectionCheckResult = this.checkSectionStatus(belongedSection)\n        switch(sectionCheckResult) {\n            case 0:\n                return 0 //locked \n            case 1: \n                return 1 //unlocked\n            case 2:\n                var currentLevel = this.playerData.currentLevel\n                if (currentLevel == givenLevel) {\n                    return 2 //current\n                }\n                \n                for (var index in require(\"sectionConfig\")[belongedSection].levels) {\n                    var oneLevel = require(\"sectionConfig\")[belongedSection].levels[index]\n                    if (oneLevel == givenLevel) {\n                        return 1\n                    }\n\n                    if (oneLevel == currentLevel) {\n                        return 0\n                    }\n                }\n        }\n    },\n\n\n    onClickChallengeButton() {\n        var gameMgr = require(\"gameMgr\")\n        this.challengeButton.getComponent(cc.Button).interactable = false\n        if (this.physicalPowerForChallengeCost == 0) {\n            gameMgr.enterLevelScene(this.selectedLevel)\n            return\n        }\n        \n        var temp = null\n        var commitBody = null\n        if (this.physicalPowerForChallengeCost != null) {\n            temp = this.playerData.physicalPower - this.physicalPowerForChallengeCost\n            if (temp < 0) {\n                return\n            }\n            var flagValue = this.playerData.physicalPowerCostedFlag\n            if(this.selectedLevel == this.playerData.currentLevel && this.playerData.physicalPowerCostedFlag == 0) {\n                flagValue = 1\n            }\n            commitBody = {\n                physicalPower: temp,\n                physicalPowerCostedFlag: flagValue\n            }\n        }\n        \n        if (this.heartForChallengeCost != null) {\n            temp = this.playerData.heart - this.heartForChallengeCost\n            if (temp < 0) {\n                return\n            }\n            commitBody = {\n                heart: temp\n            }\n        }\n        \n        var self = this\n        var successCallBack = function() {\n            if (self.physicalPowerForChallengeCost != null) {\n                self.playerData.physicalPower = temp\n                self.physicalPower = temp\n                self.playerData.physicalPowerCostedFlag = flagValue\n            }\n\n            if (self.heartForChallengeCost != null) {\n                self.playerData.heart = temp\n                self.heart = temp\n            }\n\n            gameMgr.enterLevelScene(self.selectedLevel)\n        }\n\n\n        require(\"dataMgr\").commitPlayerDataToServer(commitBody,successCallBack)\n    },\n\n\n    onAllRetryFailed() {\n        this.challengeButton.getComponent(cc.Button).interactable = true\n    },\n\n    onRefresh() {\n        this.heart = this.playerData.heart\n        this.physicalPower = this.playerData.physicalPower\n    },\n\n\n\n});\n"]}