{"version":3,"sources":["levelNodeMgr.js"],"names":["cc","Class","extends","Component","properties","status","get","_status","set","value","node","getComponent","Sprite","spriteFrame","graySpriteFrame","isRecommanded","levelNumLabelNode","Node","mailTagNode","selectedEffectNode","SpriteFrame","mailTagSendSpriteFrame","delegate","level","preChanllengeUIPrefab","Prefab","preChanllengeUIOpend","_isRecommanded","active","onLoad","tween","repeatForever","to","opacity","start","Label","string","toString","setupMailTag","onClick","openPreChanllengeUI","ui","instantiate","mgr","levelStatus","director","getScene","getChildByName","addChild","result","_checkLevelMailTagStatus","mailHasSend","mailTagWillShow","mailSysConfig","require","tag","conditions","index","oneElement","conditionType","conditionPara","currentConditionIndex","playerData","mailConditionIndex","log","levelId","dataMonitored","key","mailConfig","mailIds","Object","keys","indexOf"],"mappings":"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","file":"levelNodeMgr.js","sourceRoot":"../../../../../assets/scripts/mainScene","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        status: {\n            get() {\n                return this._status\n            },\n            set(value) {\n                this._status = value\n                if(value == 0 || value == 2) {                  \n                    this.node.getComponent(cc.Sprite).spriteFrame = this.graySpriteFrame\n                }\n                if (value == 2) {\n                    this.isRecommanded = true\n                }\n            }\n        }, //0 = locked, 1 = unlocked, 2 = current\n        levelNumLabelNode: cc.Node,\n        mailTagNode: cc.Node,\n        selectedEffectNode: cc.Node,\n        graySpriteFrame: cc.SpriteFrame,\n        mailTagSendSpriteFrame: cc.SpriteFrame,\n        delegate: null,\n        level: null,\n        preChanllengeUIPrefab: cc.Prefab,\n        preChanllengeUIOpend: false,\n        isRecommanded: {\n            get() {\n                return this._isRecommanded\n            },\n            set(value) {\n                this._isRecommanded = value\n                if (value == true) {\n                    this.selectedEffectNode.active = true\n                }\n            }\n        },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        cc.tween(this.selectedEffectNode)\n            .repeatForever(cc.tween().to(0.5,{opacity:0}).to(0.5,{opacity: 255}))\n            .start()\n        this.levelNumLabelNode.getComponent(cc.Label).string = this.level.toString()\n        this.setupMailTag()\n    },\n\n    start () {\n\n    },\n\n    onClick() {\n        if (this.status == 0) {\n            return\n        }\n        this.openPreChanllengeUI()\n    },\n\n    openPreChanllengeUI() {\n        if (this.preChanllengeUIOpend == true) {\n            return\n        }\n\n        var ui = cc.instantiate(this.preChanllengeUIPrefab)\n        var mgr = ui.getComponent(\"preChallengeUIMgr\")\n        mgr.level = this.level\n        mgr.levelStatus = this.status\n        mgr.delegate = this\n\n        cc.director.getScene().getChildByName(\"Canvas\").addChild(ui)\n        this.preChanllengeUIOpend = true\n    },\n\n    setupMailTag() {\n        var result = this._checkLevelMailTagStatus()\n        if (result != false) {\n            var mailHasSend = result[1]\n            var mailTagWillShow = result[0]\n            if (mailHasSend == true) {\n                this.mailTagNode.getComponent(cc.Sprite).spriteFrame = this.mailTagSendSpriteFrame\n            }\n            if (mailTagWillShow == true) {\n                this.mailTagNode.active = true\n            }\n        }\n    },\n\n    _checkLevelMailTagStatus() {\n        var mailSysConfig = require(\"mailSysConfig\")\n        var mailTagWillShow = false\n        var mailHasSend = false\n        for (var tag in mailSysConfig) {\n            var conditions = mailSysConfig[tag].conditions\n            for (var index in conditions) {\n                var oneElement = conditions[index]\n                var conditionType = oneElement.conditionType\n                var conditionPara = oneElement.conditionPara\n                \n                if (conditionType == 1) {\n                    if (conditionPara == this.level){\n                        mailTagWillShow = true\n                        var currentConditionIndex = require(\"dataMgr\").playerData.mailConditionIndex[tag]\n                        if (this.level == 2) {\n                            cc.log(index, currentConditionIndex)\n                        }\n                        \n                        if (index < currentConditionIndex || currentConditionIndex == -1){\n                            mailHasSend = true\n                        }\n                        \n                        return [mailTagWillShow,mailHasSend]\n                    }\n                }\n                else if (conditionType == 2) {\n                    if (conditionPara.levelId == this.level) {\n                        mailTagWillShow = true\n                    }\n                    var currentConditionIndex = require(\"dataMgr\").playerData.mailConditionIndex[tag]\n                    if (index < currentConditionIndex || currentConditionIndex == -1) {\n                        mailHasSend = true\n                    }\n\n                    return [mailTagWillShow,mailHasSend]\n                }\n            }\n        }\n        return false\n    },\n\n    dataMonitored(key,value) {\n        var mailConfig = require(\"mailConfig\")\n        var mailIds = Object.keys(mailConfig)\n        if (mailIds.indexOf(key) != -1) {\n            this.setupMailTag()\n        }\n    }\n    // update (dt) {},\n});\n"]}