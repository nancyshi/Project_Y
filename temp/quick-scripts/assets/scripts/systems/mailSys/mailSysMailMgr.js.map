{"version":3,"sources":["mailSysMailMgr.js"],"names":["cc","Class","extends","Component","properties","mailId","relatedMailSectionNode","Node","relatedMailSysMgr","mailOptionNodePrefab","Prefab","disOfContentAndOptionSection","disOfOptionNodes","headerHeight","footerHeight","onLoad","bg","node","getChildByName","width","winSize","height","on","setupContentSection","setupOptionSection","setupUiBg","start","close","destroy","mailConfig","require","mail","content","titleLabel","contentLabel","getComponent","Label","string","title","y","optionSection","options","playerData","mails","status","length","okOptionNode","instantiate","okLabelNode","okBgNode","self","onMailReaded","setOneMailReaded","addChild","index","oneOption","optionNode","labelNode","showText","bgNode","operationType","operationPara","bindFunction","givenNode","givenOperationType","givenOperationPara","indexOfOptions","mailSysGloableSendOneMail","tag","delay","selectedOptionIndex","selectedOption","color","active","Button","interactable","uibg","contentSection"],"mappings":"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","file":"mailSysMailMgr.js","sourceRoot":"../../../../../../assets/scripts/systems/mailSys","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        mailId: null,\n        relatedMailSectionNode: cc.Node,\n        relatedMailSysMgr: null,\n        mailOptionNodePrefab: cc.Prefab,\n        disOfContentAndOptionSection: 200,\n        disOfOptionNodes: 25,\n        headerHeight: 82,\n        footerHeight: 80\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var bg = this.node.getChildByName(\"bg\")\n        bg.width = cc.winSize.width\n        bg.height = cc.winSize.height\n        bg.on(\"touchstart\",function(){})\n\n        this.setupContentSection()\n        this.setupOptionSection()\n        this.setupUiBg()\n    },\n\n    start () {\n\n    },\n\n    close() {\n        this.node.destroy()\n    },\n\n    setupContentSection() {\n        var mailConfig = require(\"mailConfig\")\n        var mail = mailConfig[this.mailId]\n        var content = this.node.getChildByName(\"others\").getChildByName(\"contentSection\").getChildByName(\"view\").getChildByName(\"content\")\n        var titleLabel = content.getChildByName(\"titleLabel\")\n        var contentLabel = content.getChildByName(\"contentLabel\")\n\n        titleLabel.getComponent(cc.Label).string = mail.title\n        contentLabel.getComponent(cc.Label).string = mail.content\n\n        content.height = -contentLabel.y + contentLabel.height\n    },\n\n    setupOptionSection() {\n        var optionSection = this.node.getChildByName(\"others\").getChildByName(\"optionSection\")\n        var mailConfig = require(\"mailConfig\")\n        var mail = mailConfig[this.mailId]\n        var options = mail.options\n        mail = require(\"dataMgr\").playerData.mails[this.mailId]\n        if (mail.status == 0) {\n            //unreaded mail\n            if (options.length == 0) {\n                var okOptionNode = cc.instantiate(this.mailOptionNodePrefab)\n                var okLabelNode = okOptionNode.getChildByName(\"label\")\n                okLabelNode.getComponent(cc.Label).string = \"关闭\"\n                var okBgNode = okOptionNode.getChildByName(\"bg\")\n                okOptionNode.width = okBgNode.width\n                okOptionNode.height = okBgNode.height\n                optionSection.height += okOptionNode.height\n                var self = this\n                okOptionNode.on(\"click\",function(){\n                    var onMailReaded = function() {\n                        self.close()\n                    }\n                    self.relatedMailSysMgr.setOneMailReaded(self.mailId, -1, onMailReaded,self.relatedMailSectionNode)\n                })\n                okOptionNode.y = -(optionSection.height - okOptionNode.height)\n                optionSection.addChild(okOptionNode)\n                return\n            }\n\n            for (var index in options) {\n                var oneOption = options[index]\n                var optionNode = cc.instantiate(this.mailOptionNodePrefab)\n                var labelNode = optionNode.getChildByName(\"label\")\n                labelNode.getComponent(cc.Label).string = oneOption.showText\n                \n                var bgNode = optionNode.getChildByName(\"bg\")\n                bgNode.height = labelNode.height\n\n                optionNode.width = bgNode.width\n                optionNode.height = bgNode.height\n\n                if (index == 0) {\n                    optionSection.height += optionNode.height\n                }\n                else {\n                    optionSection.height += optionNode.height + this.disOfOptionNodes\n                }\n\n                optionNode.y = -(optionSection.height - optionNode.height)\n                var operationType = oneOption.operationType\n                var operationPara = oneOption.operationPara\n                var self = this\n                var bindFunction = function(givenNode,givenOperationType,givenOperationPara,indexOfOptions) {\n                    givenNode.on(\"click\",function(){\n                        //no matter what option be selected, this mail will be readed\n                        var onMailReaded = function() {\n                            if (givenOperationType == 1) {\n                                self.close()\n                            }\n                            else if (givenOperationType == 2) {\n                                // mailSys.sendOneMail(givenOperationPara.mailId, mail.tag, givenOperationPara.delay)\n                                require(\"systemsMgr\").mailSysGloableSendOneMail(givenOperationPara.mailId,mail.tag, function(){},givenOperationPara.delay)\n                                self.close()\n                            }\n                        }\n                        self.relatedMailSysMgr.setOneMailReaded(self.mailId,indexOfOptions,onMailReaded,self.relatedMailSectionNode)\n                    })\n                }\n                bindFunction(optionNode, operationType, operationPara, index)\n                optionSection.addChild(optionNode)\n            }\n        }\n\n        else if (mail.status == 1) {\n            //readed mail\n            if (mail.selectedOptionIndex != -1) {\n                var selectedOptionIndex = mail.selectedOptionIndex\n                var selectedOption = options[selectedOptionIndex]\n\n                var optionNode = cc.instantiate(this.mailOptionNodePrefab)\n                var labelNode = optionNode.getChildByName(\"label\")\n                labelNode.getComponent(cc.Label).string = selectedOption.showText\n                \n                labelNode.color = cc.color(255,255,255)\n                var bgNode = optionNode.getChildByName(\"bg_readed\")\n                bgNode.active = true\n                bgNode.height = labelNode.height\n\n                optionNode.width = bgNode.width\n                optionNode.height = bgNode.height\n                optionSection.height += optionNode.height\n                optionNode.getComponent(cc.Button).interactable = false\n                optionNode.y = -(optionSection.height - optionNode.height)\n                optionSection.addChild(optionNode)\n\n                var okOptionNode = cc.instantiate(this.mailOptionNodePrefab)\n                var okLabelNode = okOptionNode.getChildByName(\"label\")\n                okLabelNode.getComponent(cc.Label).string = \"关闭\"\n                var okBgNode = okOptionNode.getChildByName(\"bg\")\n                okOptionNode.width = okBgNode.width\n                okOptionNode.height = okBgNode.height\n                optionSection.height += okOptionNode.height + this.disOfOptionNodes\n                var self = this\n                okOptionNode.on(\"click\",function(){\n                    self.close()\n                })\n                okOptionNode.y = -(optionSection.height - okOptionNode.height)\n                optionSection.addChild(okOptionNode)\n            }\n\n            else {\n                var okOptionNode = cc.instantiate(this.mailOptionNodePrefab)\n                var okLabelNode = okOptionNode.getChildByName(\"label\")\n                okLabelNode.getComponent(cc.Label).string = \"关闭\"\n                var okBgNode = okOptionNode.getChildByName(\"bg\")\n                okOptionNode.width = okBgNode.width\n                okOptionNode.height = okBgNode.height\n                optionSection.height += okOptionNode.height\n                var self = this\n                okOptionNode.on(\"click\",function(){\n                    self.close()\n                })\n                okOptionNode.y = -(optionSection.height - okOptionNode.height)\n                optionSection.addChild(okOptionNode)\n            }\n        }\n        \n    },\n\n    setupUiBg() {\n        var uibg = this.node.getChildByName(\"others\").getChildByName(\"uibg\")\n        var contentSection = this.node.getChildByName(\"others\").getChildByName(\"contentSection\")\n        var optionSection = this.node.getChildByName(\"others\").getChildByName(\"optionSection\")\n\n        uibg.height = this.headerHeight + contentSection.height + this.disOfContentAndOptionSection + optionSection.height + this.footerHeight\n        contentSection.y = uibg.height/2 - this.headerHeight\n        optionSection.y = contentSection.y - contentSection.height - this.disOfContentAndOptionSection\n    }\n    // update (dt) {},\n});\n"]}