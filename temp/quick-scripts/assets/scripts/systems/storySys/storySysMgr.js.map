{"version":3,"sources":["storySysMgr.js"],"names":["cc","Class","extends","Component","properties","contentNode","Node","storyTextNodePrefab","Prefab","disBetweenStoryTextNodes","continueLabelNode","completeButtonNode","startDelayTime","storyId","storyTextNodes","status","get","_status","set","value","active","log","totalHeight","totalTextNodeNum","currentNum","textIds","onLoad","self","bg","node","getChildByName","width","winSize","height","monitoredNode","on","str","require","getTextByIdAndLanguageType","_showOneStoryText","completeStory","getComponent","Label","string","tween","repeatForever","to","opacity","start","showStory","storyConfig","key","toString","config","length","delay","call","closeSystem","instantiate","_forceUpdateRenderData","y","addChild","onWillOpend","givenStoryId"],"mappings":"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","file":"storySysMgr.js","sourceRoot":"../../../../../../assets/scripts/systems/storySys","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        contentNode: cc.Node,\n        storyTextNodePrefab: cc.Prefab,\n        disBetweenStoryTextNodes: 50,\n        continueLabelNode: cc.Node,\n        completeButtonNode: cc.Node,\n        startDelayTime: 1,\n        storyId: null,\n\n        storyTextNodes: [],\n        status: {\n            get() {\n                return this._status\n            },\n            set(value) {\n                this._status = value\n                // 1 = start showing a node\n                // 2 = showing complete , wating for tap to next\n                // 3 = all nodes showing complete , wating for click button to complete\n                switch(value) {\n                    case 1:\n                        this.continueLabelNode.active = false\n                        this.completeButtonNode.active = false\n                        break\n                    case 2:\n                        this.continueLabelNode.active = true\n                        this.completeButtonNode.active = false\n                        break\n                    case 3:\n                        this.continueLabelNode.active = false\n                        this.completeButtonNode.active = true\n                        break\n                    default:\n                        cc.log(\"STORYSYSMGR: WRONG STATUS VALUE PROVIDED\")\n                }\n            }\n        },\n        totalHeight: 0,\n        totalTextNodeNum: null,\n        currentNum: null,\n        textIds: null\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var self = this\n        var bg = this.node.getChildByName(\"bg\")\n        bg.width = cc.winSize.width\n        bg.height = cc.winSize.height\n        this.node.width = bg.width\n        this.node.height = bg.height\n        var monitoredNode = this.contentNode.getChildByName(\"tapMonitoredNode\")\n        monitoredNode.width = bg.width\n        monitoredNode.height = bg.height\n\n        monitoredNode.on(\"touchstart\",function(){\n            if (self.status == 2) {\n                self.currentNum += 1\n                var str = require(\"textConfig\").getTextByIdAndLanguageType(self.textIds[self.currentNum - 1])\n                self._showOneStoryText(str)\n            }\n        },this)\n        this.completeButtonNode.on(\"click\",function(){\n            if (self.status == 3) {\n                self.completeStory()\n            }\n        })\n        this.completeButtonNode.getChildByName(\"New Label\").getComponent(cc.Label).string = require(\"textConfig\").getTextByIdAndLanguageType(122)\n\n        cc.tween(this.continueLabelNode)\n            .repeatForever(cc.tween()\n                    .to(0.3, {opacity: 0})\n                    .to(0.3, {opacity: 255})    \n            )\n            .start()\n    },\n\n    start () {\n\n        this.showStory()\n    },\n\n    showStory() {\n        if (this.storyId == null) {\n            cc.log(\"NO STORY ID PROVIDED\")\n            return\n        }\n        var storyConfig = require(\"storyConfig\")\n        var key = \"story_\" + this.storyId.toString()\n        var config = storyConfig[key]\n        var textIds = config.textIds\n        this.textIds = textIds\n        this.totalTextNodeNum = textIds.length\n        \n        this.currentNum = 1\n        var str = require(\"textConfig\").getTextByIdAndLanguageType(textIds[0])\n        var self = this\n        cc.tween(this.node)\n            .delay(self.startDelayTime)\n            .call(function(){\n                self._showOneStoryText(str)\n            })\n            .start()\n    },\n\n    completeStory() {\n        require(\"systemsMgr\").closeSystem(\"storySys\",3)\n    },\n\n    _showOneStoryText(str) {\n        this.status = 1\n        var node = cc.instantiate(this.storyTextNodePrefab)\n        node.getComponent(cc.Label).string = str\n        node.getComponent(cc.Label)._forceUpdateRenderData()\n        node.y = -this.totalHeight\n\n        this.totalHeight += node.height + this.disBetweenStoryTextNodes\n        if (this.contentNode.height < this.totalHeight) {\n            this.contentNode.height = this.totalHeight\n        }\n        node.opacity = 0\n        this.contentNode.addChild(node)\n        var self = this\n        cc.tween(node)\n            .to(0.5,{opacity: 255})\n            .call(function(){\n                if (self.currentNum == self.totalTextNodeNum) {\n                    self.status = 3\n                }\n                else {\n                    self.status = 2\n                }\n            })\n            .start()\n    },\n\n    onWillOpend(givenStoryId) {\n        this.storyId = givenStoryId\n    }\n    // update (dt) {},\n});\n"]}