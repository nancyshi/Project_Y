{"version":3,"sources":["loginSceneMgr.js"],"names":["cc","Class","extends","Component","properties","dataMgr","loginMgr","networkMgr","isLogining","changeSceneAnimationTime","onLoad","node","on","onTouchStart","start","require","delegate","retryNode","find","tween","repeatForever","to","scale","login","onPlayerDataUpdated","initAds","getComponent","Label","string","index","children","self","temp","i","opacity","delay","call","loadReses","startHeartBeat","director","loadScene","active","loginType","platform","sys","WECHAT_GAME","LoginType","WE_CHAT_GAME","DEVICE_ID","event","_debugLogin","playerData","id","name","physicalPower","maxPhysicalPower","heart","maxHeart","currentSection","currentLevel","physicalPowerCostedFlag","onDestroy","off","onAllRetryFailed","loginInfo","loginInfoLabel","getChildByName"],"mappings":"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","file":"loginSceneMgr.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        dataMgr: null,\n        loginMgr: null,\n        networkMgr: null,\n        isLogining: false,\n        changeSceneAnimationTime: 2,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.node.on(\"touchstart\",this.onTouchStart,this)\n    },\n\n    start () {\n        this.dataMgr = require(\"dataMgr\")\n        this.loginMgr = require(\"loginMgr\")\n        this.networkMgr = require(\"networkMgr\")\n        this.networkMgr.delegate = this\n        var retryNode = cc.find(\"Canvas/retry\")\n        cc.tween(retryNode)\n            .repeatForever(\n                cc.tween()\n                    .to(0.5,{scale: 1.2})\n                    .to(0.5,{scale: 0.8})\n            )\n            .start()\n\n        this.login()\n        //this._debugLogin()\n    },\n\n    onPlayerDataUpdated() {\n        require(\"advertisMgr\").initAds()\n        cc.find(\"Canvas/loginInfo/textNode\").getComponent(cc.Label).string = \"登陆成功！\"\n        //animation \n        for (var index in this.node.children) {\n            var self = this\n\n            var temp = function(i) {\n                var node = self.node.children[i]\n                cc.tween(node)\n                    .to(self.changeSceneAnimationTime, {opacity: 0})\n                    .start()\n            }\n            temp(index)\n        }\n\n        cc.tween(this.node)\n            .delay(this.changeSceneAnimationTime)\n            .call(function(){\n                require(\"resMgr\").loadReses(function(){\n                    require(\"networkMgr\").startHeartBeat()\n                    cc.director.loadScene(\"mainScene\")\n                })\n            })\n            .start()\n    },\n\n    login() {\n        this.isLogining = true\n        var retryNode = cc.find(\"Canvas/retry\")\n        retryNode.active = false\n        cc.find(\"Canvas/loginInfo/textNode\").getComponent(cc.Label).string = \"登陆中，请稍候\"\n\n        var loginType = null\n        var platform = cc.sys.platform\n        if (platform == cc.sys.WECHAT_GAME) {\n            loginType = this.loginMgr.LoginType.WE_CHAT_GAME\n        }\n        else {\n            loginType = this.loginMgr.LoginType.DEVICE_ID\n        }\n\n        this.loginMgr.login(loginType)\n    },\n\n    onTouchStart(event) {\n        if (this.isLogining == false) {\n            this.login()\n        }\n    },\n    // update (dt) {},\n\n    _debugLogin() {\n        this.dataMgr.playerData = {\n            id: 100000001,\n            name: \"new Player\",\n            physicalPower: 10,\n            maxPhysicalPower: 10,\n            heart: 10,\n            maxHeart: 10,\n            currentSection: 1,\n            currentLevel: 2,\n            physicalPowerCostedFlag: 0\n        }\n        this.onPlayerDataUpdated()\n    },\n\n    onDestroy() {\n        this.node.off(\"touchstart\",this.onTouchStart,this)\n    },\n    onAllRetryFailed() {\n        var loginInfo = cc.find(\"Canvas/loginInfo\")\n        var loginInfoLabel = loginInfo.getChildByName(\"textNode\").getComponent(cc.Label)\n        loginInfoLabel.string = \"连接服务器失败，请点击重试\"\n        loginInfo.active = true\n        var retryNode = cc.find(\"Canvas/retry\")\n        retryNode.active = true\n        this.isLogining = false\n    }\n    \n});\n"]}