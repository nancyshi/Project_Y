{"version":3,"sources":["timerSystemsMgr.js"],"names":["TimerSystemsMgr","cc","Class","extends","Component","properties","signInSysTimer","get","_signInSysTimer","set","value","onTimerReach","timers","start","initSetup","push","require","playerData","signInRefreshDelta","lunch","schedule","timerUpdate","index","oneTimer","stop","unschedule","givenName","self","networkMgr","msgObj","makeMessageObj","message","playerId","id","successCallBack","xhr","response","responseText","JSON","parse","type","signInStatus","signInSys","opendNode","signInSysMgr","getComponent","setupUI","sendMessageByMsgObj","sharedTimerSystemsMgr","module","exports"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,kBAAkBC,GAAGC,KAAH,CAAS;AAC3BC,aAASF,GAAGG,SADe;;AAG3BC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,wBAAgB;AACZC,eADY,iBACN;AACF,uBAAO,KAAKC,eAAZ;AACH,aAHW;AAIZC,eAJY,eAIRC,KAJQ,EAID;AACP,qBAAKF,eAAL,GAAuBE,KAAvB;AACA,oBAAIA,SAAS,CAAb,EAAgB;AACZ,yBAAKC,YAAL,CAAkB,WAAlB;AACH;AACJ;AATW,SAhBR;;AA4BRC,gBAAQ;AA5BA,KAHe;;AAkC3B;;AAEA;;AAEAC,SAtC2B,mBAsClB,CAER,CAxC0B;AAyC3BC,aAzC2B,uBAyChB;AACP,aAAKF,MAAL,CAAYG,IAAZ,CAAiB,KAAKT,cAAtB;AACA,aAAKA,cAAL,GAAsBU,QAAQ,SAAR,EAAmBC,UAAnB,CAA8BC,kBAApD;AACH,KA5C0B;AA6C3BC,SA7C2B,mBA6CpB;AACH,aAAKC,QAAL,CAAc,KAAKC,WAAnB,EAAgC,CAAhC;AACH,KA/C0B;AAiD3BA,eAjD2B,yBAiDb;AACV,aAAK,IAAIC,KAAT,IAAkB,KAAKV,MAAvB,EAA+B;AAC3B,gBAAIW,WAAW,KAAKX,MAAL,CAAYU,KAAZ,CAAf;AACA,gBAAIC,WAAW,CAAf,EAAkB;AACdA,4BAAY,CAAZ;AACH;AACJ;AACJ,KAxD0B;AA0D3BC,QA1D2B,kBA0DrB;AACF,aAAKC,UAAL,CAAgB,KAAKJ,WAArB,EAAiC,IAAjC;AACH,KA5D0B;AA+D3BV,gBA/D2B,wBA+Dde,SA/Dc,EA+DH;AACpB,gBAAOA,SAAP;AACI,iBAAK,WAAL;AACI,oBAAIC,OAAO,IAAX;AACA,oBAAIC,aAAaZ,QAAQ,YAAR,CAAjB;AACA,oBAAIa,SAASD,WAAWE,cAAX,CAA0B,cAA1B,EAAyC,oBAAzC,CAAb;AACAD,uBAAOE,OAAP,CAAeC,QAAf,GAA0BhB,QAAQ,SAAR,EAAmBC,UAAnB,CAA8BgB,EAAxD;AACAJ,uBAAOK,eAAP,GAAyB,UAASC,GAAT,EAAc;AACnC,wBAAIC,WAAWD,IAAIE,YAAnB;AACAD,+BAAWE,KAAKC,KAAL,CAAWH,QAAX,CAAX;AACA,wBAAIA,SAASI,IAAT,IAAiB,SAArB,EAAgC;AAC5B,4BAAItB,qBAAqBkB,SAASlB,kBAAlC;AACAF,gCAAQ,SAAR,EAAmBC,UAAnB,CAA8BC,kBAA9B,GAAmDA,kBAAnD;AACAS,6BAAKrB,cAAL,GAAsBY,kBAAtB;AACAF,gCAAQ,SAAR,EAAmBC,UAAnB,CAA8BwB,YAA9B,GAA6C,CAA7C;AACA,4BAAIzB,QAAQ,YAAR,EAAsB0B,SAAtB,CAAgCC,SAAhC,IAA6C,IAAjD,EAAuD;AACnD,gCAAIC,eAAe5B,QAAQ,YAAR,EAAsB0B,SAAtB,CAAgCC,SAAhC,CAA0CE,YAA1C,CAAuD,cAAvD,CAAnB;AACAD,yCAAaE,OAAb;AACH;AACJ;AACJ,iBAbD;;AAeAlB,2BAAWmB,mBAAX,CAA+BlB,MAA/B;AACA;AAtBR;AAwBH;AAxF0B,CAAT,CAAtB;;AA4FA,IAAImB,wBAAwB,IAAIhD,eAAJ,EAA5B;AACAiD,OAAOC,OAAP,GAAiBF,qBAAjB","file":"timerSystemsMgr.js","sourceRoot":"../../../../../assets/scripts/libs","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar TimerSystemsMgr = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        signInSysTimer: {\n            get() {\n                return this._signInSysTimer\n            },\n            set(value) {\n                this._signInSysTimer = value\n                if (value <= 0) {\n                    this.onTimerReach(\"signInSys\")\n                }\n            }\n        },\n\n        timers: []\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n\n    },\n    initSetup(){\n        this.timers.push(this.signInSysTimer)\n        this.signInSysTimer = require(\"dataMgr\").playerData.signInRefreshDelta\n    },\n    lunch(){\n        this.schedule(this.timerUpdate, 1)\n    },\n\n    timerUpdate() {\n        for (var index in this.timers) {\n            var oneTimer = this.timers[index]\n            if (oneTimer > 0) {\n                oneTimer -= 1\n            }\n        }\n    },\n\n    stop(){\n        this.unschedule(this.timerUpdate,this)\n    },\n\n\n    onTimerReach(givenName) {\n        switch(givenName){\n            case \"signInSys\":\n                var self = this\n                var networkMgr = require(\"networkMgr\")\n                var msgObj = networkMgr.makeMessageObj(\"signInModule\",\"refreshMessageType\")\n                msgObj.message.playerId = require(\"dataMgr\").playerData.id\n                msgObj.successCallBack = function(xhr) {\n                    var response = xhr.responseText\n                    response = JSON.parse(response)\n                    if (response.type == \"success\") {\n                        var signInRefreshDelta = response.signInRefreshDelta\n                        require(\"dataMgr\").playerData.signInRefreshDelta = signInRefreshDelta\n                        self.signInSysTimer = signInRefreshDelta\n                        require(\"dataMgr\").playerData.signInStatus = 1\n                        if (require(\"systemsMgr\").signInSys.opendNode != null) {\n                            var signInSysMgr = require(\"systemsMgr\").signInSys.opendNode.getComponent(\"signInSysMgr\")\n                            signInSysMgr.setupUI()\n                        }\n                    }\n                }\n\n                networkMgr.sendMessageByMsgObj(msgObj)\n                break\n        }\n    }\n    \n});\n\nvar sharedTimerSystemsMgr = new TimerSystemsMgr()\nmodule.exports = sharedTimerSystemsMgr"]}