{"version":3,"sources":["gestureMgr.js"],"names":["cc","Class","extends","Component","properties","isDragEnable","isZoomEnable","zoomSpeed","maxZoomRatio","minZoomRatio","dragSpeed","camaraNode","Node","minBoundX","maxBoundX","minBoundY","maxBoundY","touches","default","visible","onLoad","node","on","event","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","touchEvent","push","length","delta","getDelta","tempX","x","tempY","y","cama","getComponent","Camera","canvas","find","tempCamaX","tempCamaY","camaMaxBoundX","width","zoomRatio","camaMinBoundX","camaMaxBoundY","height","camaMinBoundY","firstTouch","seceondTouch","firstTouchLocation","getLocation","seceondTouchLocation","distance","distanceOfTwoVector","preFirstTouchLocation","getPreviousLocation","preSeceondTouchLocation","preDistance","disDelta","tempZoomRatio","deleteTouchEventFromTouchesArry","tempIndex","index","oneTouchEvent","getID","splice","a","b","Math","pow","sqrt"],"mappings":"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","file":"gestureMgr.js","sourceRoot":"../../../../../assets/scripts/libs","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        isDragEnable: true,\n        isZoomEnable: true,\n\n        zoomSpeed: 0.00333,\n        maxZoomRatio: 1.2,\n        minZoomRatio: 0.3,\n\n        dragSpeed: 1,\n        camaraNode: cc.Node,\n        minBoundX: -960,\n        maxBoundX: 960,\n        minBoundY: -640,\n        maxBoundY: 640,\n\n        //logic properties\n        touches: {\n            default: [],\n            visible: false\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n      this.node.on(\"touchstart\",function(event){\n          this.onTouchStart(event)\n      },this)  \n      this.node.on(\"touchmove\",function(event){\n          this.onTouchMove(event)\n      },this) \n      this.node.on(\"touchend\",function(event){\n          this.onTouchEnd(event)\n      },this) \n      this.node.on(\"touchcancel\",function(event){\n          this.onTouchCancel(event)\n      },this) \n    },\n\n    // start () {\n\n    // },\n\n    // update (dt) {},\n    onTouchStart(event){\n        var touchEvent = event\n        this.touches.push(touchEvent)\n    },\n    onTouchMove(event){\n        if (this.isDragEnable == true && this.touches.length == 1) {\n            var delta = event.getDelta()\n            var tempX = delta.x * -1\n            var tempY = delta.y * -1\n    \n            tempX = tempX * this.dragSpeed\n            tempY = tempY * this.dragSpeed\n    \n            var cama = this.camaraNode.getComponent(cc.Camera)\n            var canvas = cc.find(\"Canvas\")\n    \n            var tempCamaX = this.camaraNode.x + tempX\n            var tempCamaY = this.camaraNode.y + tempY\n    \n            var camaMaxBoundX = tempCamaX + (canvas.width/2) * (1/cama.zoomRatio)\n            var camaMinBoundX = tempCamaX - (canvas.width/2) * (1/cama.zoomRatio)\n            var camaMaxBoundY = tempCamaY + (canvas.height/2) * (1/cama.zoomRatio)\n            var camaMinBoundY = tempCamaY - (canvas.height/2) * (1/cama.zoomRatio)\n            \n            if (camaMaxBoundX <= this.maxBoundX && camaMinBoundX >= this.minBoundX ) {\n                this.camaraNode.x = tempCamaX\n            }\n            if (camaMaxBoundY <= this.maxBoundY && camaMinBoundY >= this.minBoundY) {\n                this.camaraNode.y = tempCamaY\n            }\n        }\n\n        if(this.isZoomEnable == true && this.touches.length == 2) {\n            var firstTouch = this.touches[0]\n            var seceondTouch = this.touches[1]\n            var firstTouchLocation = firstTouch.getLocation()\n            var seceondTouchLocation = seceondTouch.getLocation()\n\n            var distance = this.distanceOfTwoVector(firstTouchLocation,seceondTouchLocation)\n            \n            var preFirstTouchLocation = firstTouch.getPreviousLocation()\n            var preSeceondTouchLocation = seceondTouch.getPreviousLocation()\n            var preDistance = this.distanceOfTwoVector(preFirstTouchLocation,preSeceondTouchLocation)\n\n            var disDelta = distance - preDistance\n\n            var cama = this.camaraNode.getComponent(cc.Camera)\n            var tempZoomRatio = cama.zoomRatio + this.zoomRatio * disDelta\n            \n            if (tempZoomRatio >= minZoomRatio && tempZoomRatio <= maxZoomRatio) {\n                cama.zoomRatio = tempZoomRatio\n            }\n        }\n    },\n    onTouchEnd(event) {\n        this.deleteTouchEventFromTouchesArry(event)\n    },\n    onTouchCancel(event){\n        this.deleteTouchEventFromTouchesArry(event)\n    },\n    deleteTouchEventFromTouchesArry(event) {\n        var tempIndex = null\n        for (var index in this.touches) {\n            var oneTouchEvent = this.touches[index]\n            if (oneTouchEvent.getID() == event.getID()) {\n                tempIndex = index\n                break\n            }\n        }\n        if (tempIndex != null) {\n            this.touches.splice(index,1)\n        }\n    },\n    distanceOfTwoVector(a,b) {\n        var distance = Math.pow((b.x - a.x),2) + Math.pow((b.y - a.y),2)\n        distance = Math.sqrt(distance)\n        return distance\n    }\n});\n"]}