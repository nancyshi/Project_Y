{"version":3,"sources":["advertisMgr.js"],"names":["AdvertisMgr","cc","Class","extends","Component","properties","videoAd","delegate","wechatAdId","onVideoAdEnd","onVideoAdNotEnd","defaultNoti","notificationSys","require","showNoti","onVideoAdLoadError","err","console","log","onVideoAdShowError","initAds","sys","platform","WECHAT_GAME","self","wx","createRewardedVideoAd","adUnitId","onLoad","onError","onClose","res","isEnded","os","OS_IOS","OS_ANDROID","sdkbox","PluginAdMob","setListener","adViewDidReceiveAd","name","adViewDidFailToReceiveAdWithError","msg","adViewWillPresentScreen","adViewDidDismissScreen","adViewWillDismissScreen","adViewWillLeaveApplication","init","cache","showVideoAd","load","then","show","catch","sharedAdvertisMgr","module","exports"],"mappings":"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","file":"advertisMgr.js","sourceRoot":"../../../../../assets/scripts/singleInstanceSystems","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar AdvertisMgr = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        videoAd: null,\n        delegate: null,\n\n        wechatAdId: \"xxxxx\",\n    },\n\n    onVideoAdEnd() {\n        if (this.delegate != null && typeof this.delegate.onVideoAdEnd == \"function\") {\n            this.delegate.onVideoAdEnd()\n        }\n    },\n    onVideoAdNotEnd(defaultNoti = true){\n        if (defaultNoti == true) {\n            var notificationSys = require(\"notificationMgr\")\n            notificationSys.showNoti(\"看完视频才能获得奖励哦~\")\n        }\n        if (this.delegate != null && typeof this.delegate.onVideoAdNotEnd == \"function\") {\n            this.delegate.onVideoAdNotEnd()\n        }\n    },\n    onVideoAdLoadError(err){\n        console.log(\"拉取广告失败\")\n        if (this.delegate != null && typeof this.delegate.onVideoAdLoadError == \"function\") {\n            this.delegate.onVideoAdLoadError(err)\n        }\n    },\n    onVideoAdShowError(err) {\n        if (this.delegate != null && typeof this.delegate.onVideoAdShowError == \"function\") {\n            this.delegate.onVideoAdShowError(err)\n        }\n    },\n    initAds(){\n        if (this.videoAd == null) {\n            if (cc.sys.platform == cc.sys.WECHAT_GAME) {\n                var self = this\n                this.videoAd = wx.createRewardedVideoAd({adUnitId: this.wechatAdId})\n                this.videoAd.onLoad(function(){\n                    console.log(\"拉取广告成功\")\n                })\n                this.videoAd.onError(function(err){\n                    self.onVideoAdLoadError(err)\n                })\n                this.videoAd.onClose(function(res){\n                    if (res && res.isEnded) {\n                        self.onVideoAdEnd()\n                    }\n                    else {\n                        self.onVideoAdNotEnd()\n                    }\n                })\n            }\n\n            else if (cc.sys.os == cc.sys.OS_IOS || cc.sys.os == cc.sys.OS_ANDROID) {\n                var self = this\n                cc.log(\"init\")\n                sdkbox.PluginAdMob.setListener({\n                    adViewDidReceiveAd: function(name){\n                        cc.log(\"receivedAd\")\n                    },\n\n                    adViewDidFailToReceiveAdWithError: function(name,msg){\n                        cc.log(\"didFailToReciveAd \", msg)\n                    },\n\n                    adViewWillPresentScreen: function(name) {\n                        cc.log(\"willPresentScreen\")\n                    },\n\n                    adViewDidDismissScreen: function(name) {\n                        cc.log(\"didDismissScreen\")\n                    },\n\n                    adViewWillDismissScreen: function(name) {\n                        cc.log(\"willDissmissScreen\")\n                    },\n\n                    adViewWillLeaveApplication: function(name) {\n                        cc.log(\"willLeaveApp\")\n                    }\n                })\n\n                sdkbox.PluginAdMob.init()\n\n                this.videoAd = sdkbox.PluginAdMob.cache(\"rewarded\")\n            }\n        }\n    },\n    showVideoAd() {\n\n        if (cc.sys.platform == cc.sys.WECHAT_GAME) {\n            var self = this\n            this.videoAd.load()\n            .then(function(){\n                self.videoAd.show()\n            })\n            .catch(function(err){\n                self.onVideoAdShowError(err)\n            })\n        }\n\n        else if (cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.OS_IOS) {\n            sdkbox.PluginAdMob.show(\"rewarded\")\n        }\n    }\n});\n\nvar sharedAdvertisMgr = new AdvertisMgr()\nsharedAdvertisMgr.initAds()\nmodule.exports = sharedAdvertisMgr"]}